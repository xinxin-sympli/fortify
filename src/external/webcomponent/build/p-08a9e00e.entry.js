import{r as t,c as e,h as r,g as i,H as s}from"./p-e5a4fcab.js";import{B as n,c as o,a,C as c}from"./p-0b41cd3e.js";import{l as h,g as u}from"./p-c8e5bca7.js";var l=/iPhone/i,f=/iPod/i,d=/iPad/i,p=/\biOS-universal(?:.+)Mac\b/i,y=/\bAndroid(?:.+)Mobile\b/i,w=/Android/i,g=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,b=/Silk/i,v=/Windows Phone/i,m=/\bWindows(?:.+)ARM\b/i,A=/BlackBerry/i,k=/BB10/i,S=/Opera Mini/i,B=/\b(CriOS|Chrome)(?:.+)Mobile/i,N=/Mobile(?:.+)Firefox\b/i,x=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function E(t,e,r,i){var s,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function U(t,e,r){return t instanceof Object==0?r:e in t?t[e]:r}function _(t,e=0,r=t.byteLength-e,i=!1){let s="";for(const n of new Uint8Array(t,e,r)){const t=n.toString(16).toUpperCase();1===t.length&&(s+="0"),s+=t,i&&(s+=" ")}return s.trim()}function I(t,e,r,i){return e instanceof ArrayBuffer==0?(t.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===e.byteLength?(t.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):i<0?(t.error="Wrong parameter: inputLength less than zero",!1):!(e.byteLength-r-i<0&&(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1))}function O(t,e){let r=0;if(1===t.length)return t[0];for(let i=t.length-1;i>=0;i--)r+=t[t.length-1-i]*Math.pow(2,e*i);return r}function C(t,e,r=-1){const i=r;let s=t,n=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(t<o){let t;if(i<0)t=new ArrayBuffer(a),n=a;else{if(i<a)return new ArrayBuffer(0);t=new ArrayBuffer(i),n=i}const r=new Uint8Array(t);for(let i=a-1;i>=0;i--){const t=Math.pow(2,i*e);r[n-i-1]=Math.floor(s/t),s-=r[n-i-1]*t}return t}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function R(...t){let e=0,r=0;for(const n of t)e+=n.byteLength;const i=new ArrayBuffer(e),s=new Uint8Array(i);for(const n of t)s.set(new Uint8Array(n),r),r+=n.byteLength;return i}function T(...t){let e=0,r=0;for(const n of t)e+=n.length;const i=new ArrayBuffer(e),s=new Uint8Array(i);for(const n of t)s.set(n,r),r+=n.length;return s}function j(){const t=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const e=0===t[0]&&0==(128&t[1]);(255===t[0]&&128&t[1]||e)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(e);for(let o=0;o<this.valueHex.byteLength;o++)r[o]=0;r[0]=128&t[0];const i=O(r,8),s=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(s);for(let o=0;o<this.valueHex.byteLength;o++)n[o]=t[o];return n[0]&=127,O(n,8)-i}function D(t,e){if(t.byteLength!==e.byteLength)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;s++)if(r[s]!==i[s])return!1;return!0}function W(t,e){const r=t.toString(10);if(e<r.length)return"";const i=e-r.length,s=new Array(i);for(let n=0;n<i;n++)s[n]="0";return s.join("").concat(r)}const P=[new Uint8Array([1])];class M{constructor(t={}){this.blockLength=U(t,"blockLength",0),this.error=U(t,"error",""),this.warnings=U(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}static blockName(){return"baseBlock"}toJSON(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:_(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}const V=t=>class extends t{constructor(t={}){super(t),this.isHexOnly=U(t,"isHexOnly",!1),this.valueHex="valueHex"in t?t.valueHex.slice(0):new ArrayBuffer(0)}static blockName(){return"hexBlock"}fromBER(t,e,r){return!1===I(this,t,e,r)?-1:0===new Uint8Array(t,e,r).length?(this.warnings.push("Zero buffer length"),e):(this.valueHex=t.slice(e,e+r),this.blockLength=r,e+r)}toBER(t=!1){return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===t?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.blockName=this.constructor.blockName(),t.isHexOnly=this.isHexOnly,t.valueHex=_(this.valueHex,0,this.valueHex.byteLength),t}};class $ extends(V(M)){constructor(t={}){super(),"idBlock"in t?(this.isHexOnly=U(t.idBlock,"isHexOnly",!1),this.valueHex=U(t.idBlock,"valueHex",new ArrayBuffer(0)),this.tagClass=U(t.idBlock,"tagClass",-1),this.tagNumber=U(t.idBlock,"tagNumber",-1),this.isConstructed=U(t.idBlock,"isConstructed",!1)):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}static blockName(){return"identificationBlock"}toBER(t=!1){let e,r,i=0;switch(this.tagClass){case 1:i|=0;break;case 2:i|=64;break;case 3:i|=128;break;case 4:i|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(i|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),r=new Uint8Array(e),!t){let t=this.tagNumber;t&=31,i|=t,r[0]=i}return e}if(!1===this.isHexOnly){const s=C(this.tagNumber,7),n=new Uint8Array(s),o=s.byteLength;if(e=new ArrayBuffer(o+1),r=new Uint8Array(e),r[0]=31|i,!t){for(let t=0;t<o-1;t++)r[t+1]=128|n[t];r[o]=n[o-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),r=new Uint8Array(e),r[0]=31|i,!1===t){const t=new Uint8Array(this.valueHex);for(let e=0;e<t.length-1;e++)r[e+1]=128|t[e];r[this.valueHex.byteLength]=t[t.length-1]}return e}fromBER(t,e,r){if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&i[0]),this.isHexOnly=!1;const s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let t=1;this.valueHex=new ArrayBuffer(255);let e=255,r=new Uint8Array(this.valueHex);for(;128&i[t];){if(r[t-1]=127&i[t],t++,t>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(t===e){e+=255;const t=new ArrayBuffer(e),i=new Uint8Array(t);for(let e=0;e<r.length;e++)i[e]=r[e];this.valueHex=new ArrayBuffer(e),r=new Uint8Array(this.valueHex)}}this.blockLength=t+1,r[t-1]=127&i[t];const s=new ArrayBuffer(t),n=new Uint8Array(s);for(let i=0;i<t;i++)n[i]=r[i];this.valueHex=new ArrayBuffer(t),r=new Uint8Array(this.valueHex),r.set(n),this.blockLength<=9?this.tagNumber=O(r,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return e+this.blockLength}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.blockName=this.constructor.blockName(),t.tagClass=this.tagClass,t.tagNumber=this.tagNumber,t.isConstructed=this.isConstructed,t}}class F extends M{constructor(t={}){super(),"lenBlock"in t?(this.isIndefiniteForm=U(t.lenBlock,"isIndefiniteForm",!1),this.longFormUsed=U(t.lenBlock,"longFormUsed",!1),this.length=U(t.lenBlock,"length",0)):(this.isIndefiniteForm=!1,this.longFormUsed=!1,this.length=0)}static blockName(){return"lengthBlock"}fromBER(t,e,r){if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],!0===this.isIndefiniteForm)return this.blockLength=1,e+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,e+this.blockLength;const s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const n=new Uint8Array(s);for(let o=0;o<s;o++)n[o]=i[o+1];return 0===n[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=O(n,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=s+1,e+this.blockLength}toBER(t=!1){let e,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===t&&(r=new Uint8Array(e),r[0]=128),e;if(!0===this.longFormUsed){const i=C(this.length,8);if(i.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength+1),!0===t)return e;const s=new Uint8Array(i);r=new Uint8Array(e),r[0]=128|i.byteLength;for(let t=0;t<i.byteLength;t++)r[t+1]=s[t];return e}return e=new ArrayBuffer(1),!1===t&&(r=new Uint8Array(e),r[0]=this.length),e}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.blockName=this.constructor.blockName(),t.isIndefiniteForm=this.isIndefiniteForm,t.longFormUsed=this.longFormUsed,t.length=this.length,t}}class z extends M{constructor(t={}){super(t)}static blockName(){return"valueBlock"}fromBER(t,e,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}toBER(t=!1){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}class H extends M{constructor(t={},e=z){super(t),"name"in t&&(this.name=t.name),"optional"in t&&(this.optional=t.optional),"primitiveSchema"in t&&(this.primitiveSchema=t.primitiveSchema),this.idBlock=new $(t),this.lenBlock=new F(t),this.valueBlock=new e(t)}static blockName(){return"BaseBlock"}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}toBER(t=!1){let e;const r=this.idBlock.toBER(t),i=this.valueBlock.toBER(!0);let s;if(this.lenBlock.length=i.byteLength,e=R(r,this.lenBlock.toBER(t)),s=!1===t?this.valueBlock.toBER(t):new ArrayBuffer(this.lenBlock.length),e=R(e,s),!0===this.lenBlock.isIndefiniteForm){const r=new ArrayBuffer(2);if(!1===t){const t=new Uint8Array(r);t[0]=0,t[1]=0}e=R(e,r)}return e}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.idBlock=this.idBlock.toJSON(),t.lenBlock=this.lenBlock.toJSON(),t.valueBlock=this.valueBlock.toJSON(),"name"in this&&(t.name=this.name),"optional"in this&&(t.optional=this.optional),"primitiveSchema"in this&&(t.primitiveSchema=this.primitiveSchema.toJSON()),t}}class J extends z{constructor(t={}){super(t),this.valueHex="valueHex"in t?t.valueHex.slice(0):new ArrayBuffer(0),this.isHexOnly=U(t,"isHexOnly",!0)}fromBER(t,e,r){if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);if(0===i.length)return this.warnings.push("Zero buffer length"),e;this.valueHex=new ArrayBuffer(i.length);const s=new Uint8Array(this.valueHex);for(let n=0;n<i.length;n++)s[n]=i[n];return this.blockLength=r,e+r}toBER(t=!1){return this.valueHex.slice(0)}static blockName(){return"PrimitiveValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.valueHex=_(this.valueHex,0,this.valueHex.byteLength),t.isHexOnly=this.isHexOnly,t}}class q extends H{constructor(t={}){super(t,J),this.idBlock.isConstructed=!1}static blockName(){return"PRIMITIVE"}}class L extends z{constructor(t={}){super(t),this.value=U(t,"value",[]),this.isIndefiniteForm=U(t,"isIndefiniteForm",!1)}fromBER(t,e,r){const i=e,s=r;if(!1===I(this,t,e,r))return-1;if(0===new Uint8Array(t,e,r).length)return this.warnings.push("Zero buffer length"),e;let n=e;for(;(!0===this.isIndefiniteForm?1:r)>0;){const e=Ft(t,n,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(n=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),!0===this.isIndefiniteForm&&e.result.constructor.blockName()===K.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===K.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=t.slice(i,i+s),n}toBER(t=!1){let e=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++)e=R(e,this.value[r].toBER(t));return e}static blockName(){return"ConstructedValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}t.isIndefiniteForm=this.isIndefiniteForm,t.value=[];for(let r=0;r<this.value.length;r++)t.value.push(this.value[r].toJSON());return t}}class G extends H{constructor(t={}){super(t,L),this.idBlock.isConstructed=!0}static blockName(){return"CONSTRUCTED"}fromBER(t,e,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}}class Z extends z{constructor(t={}){super(t)}fromBER(t,e,r){return e}toBER(t=!1){return new ArrayBuffer(0)}static blockName(){return"EndOfContentValueBlock"}}class K extends H{constructor(t={}){super(t,Z),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}static blockName(){return"EndOfContent"}}class Q extends z{constructor(t={}){super(t),this.value=U(t,"value",!1),this.isHexOnly=U(t,"isHexOnly",!1),"valueHex"in t?this.valueHex=t.valueHex.slice(0):(this.valueHex=new ArrayBuffer(1),!0===this.value&&(new Uint8Array(this.valueHex)[0]=255))}fromBER(t,e,r){if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(i.length);const s=new Uint8Array(this.valueHex);for(let n=0;n<i.length;n++)s[n]=i[n];return this.value=0!==j.call(this),this.blockLength=r,e+r}toBER(t=!1){return this.valueHex}static blockName(){return"BooleanValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.value=this.value,t.isHexOnly=this.isHexOnly,t.valueHex=_(this.valueHex,0,this.valueHex.byteLength),t}}class Y extends H{constructor(t={}){super(t,Q),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}static blockName(){return"Boolean"}}class X extends G{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}static blockName(){return"Sequence"}}class tt extends G{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}static blockName(){return"Set"}}class et extends H{constructor(t={}){super(t,M),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}static blockName(){return"Null"}fromBER(t,e,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,e+r>t.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):e+r}toBER(t=!1){const e=new ArrayBuffer(2);if(!0===t)return e;const r=new Uint8Array(e);return r[0]=5,r[1]=0,e}}class rt extends(V(L)){constructor(t={}){super(t),this.isConstructed=U(t,"isConstructed",!1)}fromBER(t,e,r){let i=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,i=L.prototype.fromBER.call(this,t,e,r),-1===i)return i;for(let t=0;t<this.value.length;t++){const e=this.value[t].constructor.blockName();if(e===K.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(e!==it.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(t,e,r),this.blockLength=r;return i}toBER(t=!1){if(!0===this.isConstructed)return L.prototype.toBER.call(this,t);let e=new ArrayBuffer(this.valueHex.byteLength);return!0===t||0===this.valueHex.byteLength||(e=this.valueHex.slice(0)),e}static blockName(){return"OctetStringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.isConstructed=this.isConstructed,t.isHexOnly=this.isHexOnly,t.valueHex=_(this.valueHex,0,this.valueHex.byteLength),t}}class it extends H{constructor(t={}){super(t,rt),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(t,e,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),e):super.fromBER(t,e,r)}static blockName(){return"OctetString"}isEqual(t){return t instanceof it!=0&&JSON.stringify(this)===JSON.stringify(t)}}class st extends(V(L)){constructor(t={}){super(t),this.unusedBits=U(t,"unusedBits",0),this.isConstructed=U(t,"isConstructed",!1),this.blockLength=this.valueHex.byteLength}fromBER(t,e,r){if(0===r)return e;let i=-1;if(!0===this.isConstructed){if(i=L.prototype.fromBER.call(this,t,e,r),-1===i)return i;for(let t=0;t<this.value.length;t++){const e=this.value[t].constructor.blockName();if(e===K.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(e!==nt.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[t].valueBlock.unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[t].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return i}if(!1===I(this,t,e,r))return-1;const s=new Uint8Array(t,e,r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(s.length-1);const n=new Uint8Array(this.valueHex);for(let o=0;o<r-1;o++)n[o]=s[o+1];return this.blockLength=s.length,e+r}toBER(t=!1){if(!0===this.isConstructed)return L.prototype.toBER.call(this,t);if(!0===t)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);const e=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),i=new Uint8Array(r);i[0]=this.unusedBits;for(let s=0;s<this.valueHex.byteLength;s++)i[s+1]=e[s];return r}static blockName(){return"BitStringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.unusedBits=this.unusedBits,t.isConstructed=this.isConstructed,t.isHexOnly=this.isHexOnly,t.valueHex=_(this.valueHex,0,this.valueHex.byteLength),t}}class nt extends H{constructor(t={}){super(t,st),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}static blockName(){return"BitString"}fromBER(t,e,r){return 0===r?e:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(t,e,r))}isEqual(t){return t instanceof nt!=0&&JSON.stringify(this)===JSON.stringify(t)}}class ot extends(V(z)){constructor(t={}){super(t),"value"in t&&(this.valueDec=t.value)}set valueHex(t){this._valueHex=t.slice(0),t.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,t.byteLength>0&&(this._valueDec=j.call(this)))}get valueHex(){return this._valueHex}set valueDec(t){this._valueDec=t,this.isHexOnly=!1,this._valueHex=function(t){const e=t<0?-1*t:t;let r=128;for(let i=1;i<8;i++){if(e<=r){if(t<0){const t=C(r-e,8,i);return new Uint8Array(t)[0]|=128,t}let s=C(e,8,i),n=new Uint8Array(s);if(128&n[0]){const t=s.slice(0),e=new Uint8Array(t);s=new ArrayBuffer(s.byteLength+1),n=new Uint8Array(s);for(let r=0;r<t.byteLength;r++)n[r+1]=e[r];n[0]=0}return s}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(t)}get valueDec(){return this._valueDec}fromDER(t,e,r,i=0){const s=this.fromBER(t,e,r);if(-1===s)return s;const n=new Uint8Array(this._valueHex);if(0===n[0]&&0!=(128&n[1])){const t=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(t).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=t.slice(0)}else if(0!==i&&this._valueHex.byteLength<i){i-this._valueHex.byteLength>1&&(i=this._valueHex.byteLength+1);const t=new ArrayBuffer(i);new Uint8Array(t).set(n,i-this._valueHex.byteLength),this._valueHex=t.slice(0)}return s}toDER(t=!1){const e=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&e[0]):{const t=new ArrayBuffer(this._valueHex.byteLength+1),r=new Uint8Array(t);r[0]=0,r.set(e,1),this._valueHex=t.slice(0)}break;case 0===e[0]&&0==(128&e[1]):{const t=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(t).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=t.slice(0)}}return this.toBER(t)}fromBER(t,e,r){const i=super.fromBER(t,e,r);return-1===i?i:(this.blockLength=r,e+r)}toBER(t=!1){return this.valueHex.slice(0)}static blockName(){return"IntegerValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.valueDec=this.valueDec,t}toString(){function t(t,e){const r=new Uint8Array([0]);let i=new Uint8Array(t),s=new Uint8Array(e),n=i.slice(0);const o=n.length-1;let a=s.slice(0);const c=a.length-1;let h=0,u=0;for(let l=c<o?o:c;l>=0;l--,u++){switch(!0){case u<a.length:h=n[o-u]+a[c-u]+r[0];break;default:h=n[o-u]+r[0]}switch(r[0]=h/10,!0){case u>=n.length:n=T(new Uint8Array([h%10]),n);break;default:n[o-u]=h%10}}return r[0]>0&&(n=T(r,n)),n.slice(0)}function e(t){if(t>=P.length)for(let e=P.length;e<=t;e++){const t=new Uint8Array([0]);let r=P[e-1].slice(0);for(let e=r.length-1;e>=0;e--){const i=new Uint8Array([(r[e]<<1)+t[0]]);t[0]=i[0]/10,r[e]=i[0]%10}t[0]>0&&(r=T(t,r)),P.push(r)}return P[t]}function r(t,e){let r=0,i=new Uint8Array(t),s=new Uint8Array(e),n=i.slice(0);const o=n.length-1;let a=s.slice(0);const c=a.length-1;let h,u=0;for(let l=c;l>=0;l--,u++)switch(h=n[o-u]-a[c-u]-r,!0){case h<0:r=1,n[o-u]=h+10;break;default:r=0,n[o-u]=h}if(r>0)for(let l=o-c+1;l>=0;l--,u++){if(h=n[o-u]-r,!(h<0)){r=0,n[o-u]=h;break}r=1,n[o-u]=h+10}return n.slice()}const i=8*this._valueHex.byteLength-1;let s,n=new Uint8Array(8*this._valueHex.byteLength/3),o=0;const a=new Uint8Array(this._valueHex);let c="",h=!1;for(let u=this._valueHex.byteLength-1;u>=0;u--){s=a[u];for(let a=0;a<8;a++){if(1==(1&s))switch(o){case i:n=r(e(o),n),c="-";break;default:n=t(n,e(o))}o++,s>>=1}}for(let u=0;u<n.length;u++)n[u]&&(h=!0),h&&(c+="0123456789".charAt(n[u]));return!1===h&&(c+="0123456789".charAt(0)),c}}class at extends H{constructor(t={}){super(t,ot),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}static blockName(){return"Integer"}isEqual(t){return t instanceof at?this.valueBlock.isHexOnly&&t.valueBlock.isHexOnly?D(this.valueBlock.valueHex,t.valueBlock.valueHex):this.valueBlock.isHexOnly===t.valueBlock.isHexOnly&&this.valueBlock.valueDec===t.valueBlock.valueDec:t instanceof ArrayBuffer&&D(this.valueBlock.valueHex,t)}convertToDER(){const t=new at({valueHex:this.valueBlock.valueHex});return t.valueBlock.toDER(),t}convertFromDER(){const t=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,e=new at({valueHex:this.valueBlock.valueHex});return e.valueBlock.fromDER(e.valueBlock.valueHex,0,e.valueBlock.valueHex.byteLength,t),e}}class ct extends at{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}static blockName(){return"Enumerated"}}class ht extends(V(M)){constructor(t={}){super(t),this.valueDec=U(t,"valueDec",-1),this.isFirstSid=U(t,"isFirstSid",!1)}static blockName(){return"sidBlock"}fromBER(t,e,r){if(0===r)return e;if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);this.valueHex=new ArrayBuffer(r);let s=new Uint8Array(this.valueHex);for(let a=0;a<r&&(s[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);const n=new ArrayBuffer(this.blockLength),o=new Uint8Array(n);for(let a=0;a<this.blockLength;a++)o[a]=s[a];return this.valueHex=n.slice(0),s=new Uint8Array(this.valueHex),0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===s[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=O(s,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}toBER(t=!1){let e,r;if(this.isHexOnly){if(!0===t)return new ArrayBuffer(this.valueHex.byteLength);const i=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),r=new Uint8Array(e);for(let t=0;t<this.blockLength-1;t++)r[t]=128|i[t];return r[this.blockLength-1]=i[this.blockLength-1],e}const i=C(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===t){const t=new Uint8Array(i);r=new Uint8Array(e);for(let e=0;e<i.byteLength-1;e++)r[e]=128|t[e];r[i.byteLength-1]=t[i.byteLength-1]}return e}toString(){let t="";if(!0===this.isHexOnly)t=_(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){let e=this.valueDec;this.valueDec<=39?t="0.":this.valueDec<=79?(t="1.",e-=40):(t="2.",e-=80),t+=e.toString()}else t=this.valueDec.toString();return t}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.valueDec=this.valueDec,t.isFirstSid=this.isFirstSid,t}}class ut extends z{constructor(t={}){super(t),this.fromString(U(t,"value",""))}fromBER(t,e,r){let i=e;for(;r>0;){const e=new ht;if(i=e.fromBER(t,i,r),-1===i)return this.blockLength=0,this.error=e.error,i;0===this.value.length&&(e.isFirstSid=!0),this.blockLength+=e.blockLength,r-=e.blockLength,this.value.push(e)}return i}toBER(t=!1){let e=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++){const i=this.value[r].toBER(t);if(0===i.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);e=R(e,i)}return e}fromString(t){this.value=[];let e=0,r=0,i="",s=!1;do{if(r=t.indexOf(".",e),i=-1===r?t.substr(e):t.substr(e,r-e),e=r+1,s){const t=this.value[0];let e=0;switch(t.valueDec){case 0:break;case 1:e=40;break;case 2:e=80;break;default:return this.value=[],!1}const r=parseInt(i,10);if(isNaN(r))return!0;t.valueDec=r+e,s=!1}else{const t=new ht;if(t.valueDec=parseInt(i,10),isNaN(t.valueDec))return!0;0===this.value.length&&(t.isFirstSid=!0,s=!0),this.value.push(t)}}while(-1!==r);return!0}toString(){let t="",e=!1;for(let r=0;r<this.value.length;r++){e=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(t+="."),e?(i=`{${i}}`,this.value[r].isFirstSid?t=`2.{${i} - 80}`:t+=i):t+=i}return t}static blockName(){return"ObjectIdentifierValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}t.value=this.toString(),t.sidArray=[];for(let r=0;r<this.value.length;r++)t.sidArray.push(this.value[r].toJSON());return t}}class lt extends H{constructor(t={}){super(t,ut),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}static blockName(){return"ObjectIdentifier"}}class ft extends(V(M)){constructor(t={}){super(t),this.isHexOnly=!0,this.value=""}static blockName(){return"Utf8StringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.value=this.value,t}}class dt extends H{constructor(t={}){super(t,ft),"value"in t&&this.fromString(t.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}static blockName(){return"Utf8String"}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(t));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push(`Error during "decodeURIComponent": ${e}, using raw string`)}}fromString(t){const e=unescape(encodeURIComponent(t)),r=e.length;this.valueBlock.valueHex=new ArrayBuffer(r);const i=new Uint8Array(this.valueBlock.valueHex);for(let s=0;s<r;s++)i[s]=e.charCodeAt(s);this.valueBlock.value=t}}class pt extends(V(M)){constructor(t={}){super(t),this.valueDec=U(t,"valueDec",-1)}static blockName(){return"relativeSidBlock"}fromBER(t,e,r){if(0===r)return e;if(!1===I(this,t,e,r))return-1;const i=new Uint8Array(t,e,r);this.valueHex=new ArrayBuffer(r);let s=new Uint8Array(this.valueHex);for(let a=0;a<r&&(s[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);const n=new ArrayBuffer(this.blockLength),o=new Uint8Array(n);for(let a=0;a<this.blockLength;a++)o[a]=s[a];return this.valueHex=n.slice(0),s=new Uint8Array(this.valueHex),0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===s[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=O(s,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}toBER(t=!1){let e,r;if(this.isHexOnly){if(!0===t)return new ArrayBuffer(this.valueHex.byteLength);const i=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),r=new Uint8Array(e);for(let t=0;t<this.blockLength-1;t++)r[t]=128|i[t];return r[this.blockLength-1]=i[this.blockLength-1],e}const i=C(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===t){const t=new Uint8Array(i);r=new Uint8Array(e);for(let e=0;e<i.byteLength-1;e++)r[e]=128|t[e];r[i.byteLength-1]=t[i.byteLength-1]}return e}toString(){let t="";return t=!0===this.isHexOnly?_(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString(),t}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.valueDec=this.valueDec,t}}class yt extends z{constructor(t={}){super(t),this.fromString(U(t,"value",""))}fromBER(t,e,r){let i=e;for(;r>0;){const e=new pt;if(i=e.fromBER(t,i,r),-1===i)return this.blockLength=0,this.error=e.error,i;this.blockLength+=e.blockLength,r-=e.blockLength,this.value.push(e)}return i}toBER(t=!1){let e=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++){const i=this.value[r].toBER(t);if(0===i.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);e=R(e,i)}return e}fromString(t){this.value=[];let e=0,r=0,i="";do{r=t.indexOf(".",e),i=-1===r?t.substr(e):t.substr(e,r-e),e=r+1;const s=new pt;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(-1!==r);return!0}toString(){let t="",e=!1;for(let r=0;r<this.value.length;r++){e=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(t+="."),e?(i=`{${i}}`,t+=i):t+=i}return t}static blockName(){return"RelativeObjectIdentifierValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}t.value=this.toString(),t.sidArray=[];for(let r=0;r<this.value.length;r++)t.sidArray.push(this.value[r].toJSON());return t}}class wt extends H{constructor(t={}){super(t,yt),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}static blockName(){return"RelativeObjectIdentifier"}}class gt extends(V(M)){constructor(t={}){super(t),this.isHexOnly=!0,this.value=""}static blockName(){return"BmpStringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.value=this.value,t}}class bt extends H{constructor(t={}){super(t,gt),"value"in t&&this.fromString(t.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}static blockName(){return"BmpString"}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){const e=t.slice(0),r=new Uint8Array(e);for(let i=0;i<r.length;i+=2){const t=r[i];r[i]=r[i+1],r[i+1]=t}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(e))}fromString(t){const e=t.length;this.valueBlock.valueHex=new ArrayBuffer(2*e);const r=new Uint8Array(this.valueBlock.valueHex);for(let i=0;i<e;i++){const e=C(t.charCodeAt(i),8),s=new Uint8Array(e);if(s.length>2)continue;const n=2-s.length;for(let t=s.length-1;t>=0;t--)r[2*i+t+n]=s[t]}this.valueBlock.value=t}}class vt extends(V(M)){constructor(t={}){super(t),this.isHexOnly=!0,this.value=""}static blockName(){return"UniversalStringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.value=this.value,t}}class mt extends H{constructor(t={}){super(t,vt),"value"in t&&this.fromString(t.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}static blockName(){return"UniversalString"}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){const e=t.slice(0),r=new Uint8Array(e);for(let i=0;i<r.length;i+=4)r[i]=r[i+3],r[i+1]=r[i+2],r[i+2]=0,r[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(e))}fromString(t){const e=t.length;this.valueBlock.valueHex=new ArrayBuffer(4*e);const r=new Uint8Array(this.valueBlock.valueHex);for(let i=0;i<e;i++){const e=C(t.charCodeAt(i),8),s=new Uint8Array(e);if(s.length>4)continue;const n=4-s.length;for(let t=s.length-1;t>=0;t--)r[4*i+t+n]=s[t]}this.valueBlock.value=t}}class At extends(V(M)){constructor(t={}){super(t),this.value="",this.isHexOnly=!0}static blockName(){return"SimpleStringValueBlock"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.value=this.value,t}}class kt extends H{constructor(t={}){super(t,At),"value"in t&&this.fromString(t.value)}static blockName(){return"SIMPLESTRING"}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(t))}fromString(t){const e=t.length;this.valueBlock.valueHex=new ArrayBuffer(e);const r=new Uint8Array(this.valueBlock.valueHex);for(let i=0;i<e;i++)r[i]=t.charCodeAt(i);this.valueBlock.value=t}}class St extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}static blockName(){return"NumericString"}}class Bt extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}static blockName(){return"PrintableString"}}class Nt extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}static blockName(){return"TeletexString"}}class xt extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}static blockName(){return"VideotexString"}}class Et extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}static blockName(){return"IA5String"}}class Ut extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}static blockName(){return"GraphicString"}}class _t extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}static blockName(){return"VisibleString"}}class It extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}static blockName(){return"GeneralString"}}class Ot extends kt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}static blockName(){return"CharacterString"}}class Ct extends _t{constructor(t={}){if(super(t),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,"value"in t){this.fromString(t.value),this.valueBlock.valueHex=new ArrayBuffer(t.value.length);const e=new Uint8Array(this.valueBlock.valueHex);for(let r=0;r<t.value.length;r++)e[r]=t.value.charCodeAt(r)}"valueDate"in t&&(this.fromDate(t.valueDate),this.valueBlock.valueHex=this.toBuffer()),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){this.fromString(String.fromCharCode.apply(null,new Uint8Array(t)))}toBuffer(){const t=this.toString(),e=new ArrayBuffer(t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return e}fromDate(t){this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(t){const e=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(t);if(null===e)return void(this.error="Wrong input string for convertion");const r=parseInt(e[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(e[2],10),this.day=parseInt(e[3],10),this.hour=parseInt(e[4],10),this.minute=parseInt(e[5],10),this.second=parseInt(e[6],10)}toString(){const t=new Array(7);return t[0]=W(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=W(this.month,2),t[2]=W(this.day,2),t[3]=W(this.hour,2),t[4]=W(this.minute,2),t[5]=W(this.second,2),t[6]="Z",t.join("")}static blockName(){return"UTCTime"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.year=this.year,t.month=this.month,t.day=this.day,t.hour=this.hour,t.minute=this.minute,t.second=this.second,t}}class Rt extends _t{constructor(t={}){if(super(t),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,this.millisecond=0,"value"in t){this.fromString(t.value),this.valueBlock.valueHex=new ArrayBuffer(t.value.length);const e=new Uint8Array(this.valueBlock.valueHex);for(let r=0;r<t.value.length;r++)e[r]=t.value.charCodeAt(r)}"valueDate"in t&&(this.fromDate(t.valueDate),this.valueBlock.valueHex=this.toBuffer()),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),i)}fromBuffer(t){this.fromString(String.fromCharCode.apply(null,new Uint8Array(t)))}toBuffer(){const t=this.toString(),e=new ArrayBuffer(t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return e}fromDate(t){this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds(),this.millisecond=t.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(t){let e,r=!1,i="",s="",n=0,o=0,a=0;if("Z"===t[t.length-1])i=t.substr(0,t.length-1),r=!0;else{const e=new Number(t[t.length-1]);if(isNaN(e.valueOf()))throw new Error("Wrong input string for convertion");i=t}if(r){if(-1!==i.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==i.indexOf("-"))throw new Error("Wrong input string for convertion")}else{let t=1,e=i.indexOf("+"),r="";if(-1===e&&(e=i.indexOf("-"),t=-1),-1!==e){if(r=i.substr(e+1),i=i.substr(0,e),2!==r.length&&4!==r.length)throw new Error("Wrong input string for convertion");let s=new Number(r.substr(0,2));if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");if(o=t*s,4===r.length){if(s=new Number(r.substr(2,2)),isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");a=t*s}}}let c=i.indexOf(".");if(-1===c&&(c=i.indexOf(",")),-1!==c){const t=new Number("0"+i.substr(c));if(isNaN(t.valueOf()))throw new Error("Wrong input string for convertion");n=t.valueOf(),s=i.substr(0,c)}else s=i;switch(!0){case 8===s.length:if(e=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for convertion");break;case 10===s.length:if(e=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let t=60*n;this.minute=Math.floor(t),t=60*(t-this.minute),this.second=Math.floor(t),t=1e3*(t-this.second),this.millisecond=Math.floor(t)}break;case 12===s.length:if(e=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let t=60*n;this.second=Math.floor(t),t=1e3*(t-this.second),this.millisecond=Math.floor(t)}break;case 14===s.length:e=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c&&(this.millisecond=Math.floor(1e3*n));break;default:throw new Error("Wrong input string for convertion")}const h=e.exec(s);if(null===h)throw new Error("Wrong input string for convertion");for(let u=1;u<h.length;u++)switch(u){case 1:this.year=parseInt(h[u],10);break;case 2:this.month=parseInt(h[u],10);break;case 3:this.day=parseInt(h[u],10);break;case 4:this.hour=parseInt(h[u],10)+o;break;case 5:this.minute=parseInt(h[u],10)+a;break;case 6:this.second=parseInt(h[u],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){const t=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=t.getUTCFullYear(),this.month=t.getUTCMonth(),this.day=t.getUTCDay(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds(),this.millisecond=t.getUTCMilliseconds()}}toString(){const t=[];return t.push(W(this.year,4)),t.push(W(this.month,2)),t.push(W(this.day,2)),t.push(W(this.hour,2)),t.push(W(this.minute,2)),t.push(W(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(W(this.millisecond,3))),t.push("Z"),t.join("")}static blockName(){return"GeneralizedTime"}toJSON(){let t={};try{t=super.toJSON()}catch(e){}return t.year=this.year,t.month=this.month,t.day=this.day,t.hour=this.hour,t.minute=this.minute,t.second=this.second,t.millisecond=this.millisecond,t}}class Tt extends dt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}static blockName(){return"DATE"}}class jt extends dt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}static blockName(){return"TimeOfDay"}}class Dt extends dt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}static blockName(){return"DateTime"}}class Wt extends dt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}static blockName(){return"Duration"}}class Pt extends dt{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}static blockName(){return"TIME"}}class Mt{constructor(t={}){this.value=U(t,"value",[]),this.optional=U(t,"optional",!1)}}class Vt{constructor(t={}){this.name=U(t,"name",""),this.optional=U(t,"optional",!1)}}class $t{constructor(t={}){this.name=U(t,"name",""),this.optional=U(t,"optional",!1),this.value=U(t,"value",new Vt),this.local=U(t,"local",!1)}}function Ft(t,e,r){const i=e;let s=new H({},Object);const n=new M;if(!1===I(n,t,e,r))return s.error=n.error,{offset:-1,result:s};if(0===new Uint8Array(t,e,r).length)return this.error="Zero buffer length",{offset:-1,result:s};let o=s.idBlock.fromBER(t,e,r);if(s.warnings.concat(s.idBlock.warnings),-1===o)return s.error=s.idBlock.error,{offset:-1,result:s};if(o=s.lenBlock.fromBER(t,e=o,r-=s.idBlock.blockLength),s.warnings.concat(s.lenBlock.warnings),-1===o)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=o,r-=s.lenBlock.blockLength,!1===s.idBlock.isConstructed&&!0===s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let a=H;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&!1===s.idBlock.isHexOnly)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(!0===s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};a=K;break;case 1:a=Y;break;case 2:a=at;break;case 3:a=nt;break;case 4:a=it;break;case 5:a=et;break;case 6:a=lt;break;case 10:a=ct;break;case 12:a=dt;break;case 13:a=wt;break;case 14:a=Pt;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:a=X;break;case 17:a=tt;break;case 18:a=St;break;case 19:a=Bt;break;case 20:a=Nt;break;case 21:a=xt;break;case 22:a=Et;break;case 23:a=Ct;break;case 24:a=Rt;break;case 25:a=Ut;break;case 26:a=_t;break;case 27:a=It;break;case 28:a=mt;break;case 29:a=Ot;break;case 30:a=bt;break;case 31:a=Tt;break;case 32:a=jt;break;case 33:a=Dt;break;case 34:a=Wt;break;default:{let i;i=!0===s.idBlock.isConstructed?new G:new q,i.idBlock=s.idBlock,i.lenBlock=s.lenBlock,i.warnings=s.warnings,s=i,o=s.fromBER(t,e,r)}}break;case 2:case 3:case 4:default:a=!0===s.idBlock.isConstructed?G:q}return s=function(t,e){if(t instanceof e)return t;const r=new e;return r.idBlock=t.idBlock,r.lenBlock=t.lenBlock,r.warnings=t.warnings,r.valueBeforeDecode=t.valueBeforeDecode.slice(0),r}(s,a),o=s.fromBER(t,e,!0===s.lenBlock.isIndefiniteForm?r:s.lenBlock.length),s.valueBeforeDecode=t.slice(i,i+s.blockLength),{offset:o,result:s}}function zt(t){if(0===t.byteLength){const t=new H({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return Ft(t,0,t.byteLength)}function Ht(t,e,r){if(r instanceof Mt){for(let i=0;i<r.value.length;i++)if(!0===Ht(t,e,r.value[i]).verified)return{verified:!0,result:t};{const t={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(t.name=r.name),t}}if(r instanceof Vt)return r.hasOwnProperty("name")&&(t[r.name]=e),{verified:!0,result:t};if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong root object"}};if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:t};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:t};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:t};if("isHexOnly"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:t};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=new Uint8Array(r.idBlock.valueHex),s=new Uint8Array(e.idBlock.valueHex);if(i.length!==s.length)return{verified:!1,result:t};for(let e=0;e<i.length;e++)if(i[e]!==s[1])return{verified:!1,result:t}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(t[r.name]=e)),!0===r.idBlock.isConstructed){let i=0,s={verified:!1},n=r.valueBlock.value.length;if(n>0&&r.valueBlock.value[0]instanceof $t&&(n=e.valueBlock.value.length),0===n)return{verified:!0,result:t};if(0===e.valueBlock.value.length&&0!==r.valueBlock.value.length){let e=!0;for(let t=0;t<r.valueBlock.value.length;t++)e=e&&(r.valueBlock.value[t].optional||!1);return!0===e?{verified:!0,result:t}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete t[r.name]),t.error="Inconsistent object length",{verified:!1,result:t})}for(let o=0;o<n;o++)if(o-i>=e.valueBlock.value.length){if(!1===r.valueBlock.value[o].optional){const e={verified:!1,result:t};return t.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete t[r.name],e.name=r.name)),e}}else if(r.valueBlock.value[0]instanceof $t){if(s=Ht(t,e.valueBlock.value[o],r.valueBlock.value[0].value),!1===s.verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete t[r.name]),s;i++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let i={};i="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?e:t,void 0===i[r.valueBlock.value[0].name]&&(i[r.valueBlock.value[0].name]=[]),i[r.valueBlock.value[0].name].push(e.valueBlock.value[o])}}else if(s=Ht(t,e.valueBlock.value[o-i],r.valueBlock.value[o]),!1===s.verified){if(!0!==r.valueBlock.value[o].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete t[r.name]),s;i++}if(!1===s.verified){const e={verified:!1,result:t};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete t[r.name],e.name=r.name)),e}return{verified:!0,result:t}}if("primitiveSchema"in r&&"valueHex"in e.valueBlock){const i=zt(e.valueBlock.valueHex);if(-1===i.offset){const e={verified:!1,result:i.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete t[r.name],e.name=r.name)),e}return Ht(t,i.result,r.primitiveSchema)}return{verified:!0,result:t}}const Jt=Object.freeze({__proto__:null,HexBlock:V,ValueBlock:z,BaseBlock:H,Primitive:q,Constructed:G,EndOfContent:K,Boolean:Y,Sequence:X,Set:tt,Null:et,OctetString:it,BitString:nt,Integer:at,Enumerated:ct,ObjectIdentifier:lt,Utf8String:dt,RelativeObjectIdentifier:wt,BmpString:bt,UniversalString:mt,NumericString:St,PrintableString:Bt,TeletexString:Nt,VideotexString:xt,IA5String:Et,GraphicString:Ut,VisibleString:_t,GeneralString:It,CharacterString:Ot,UTCTime:Ct,GeneralizedTime:Rt,DATE:Tt,TimeOfDay:jt,DateTime:Dt,Duration:Wt,TIME:Pt,Choice:Mt,Any:Vt,Repeated:$t,RawData:class{constructor(t={}){this.data=U(t,"data",new ArrayBuffer(0))}fromBER(t,e,r){return this.data=t.slice(e,r),e+r}toBER(t=!1){return this.data}},fromBER:zt,compareSchema:Ht,verifySchema:function(t,e){if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const r=zt(t);return-1===r.offset?{verified:!1,result:r.result}:Ht(r.result,r.result,e)},fromJSON:function(){}});var qt,Lt;!function(t){t[t.Sequence=0]="Sequence",t[t.Set=1]="Set",t[t.Choice=2]="Choice"}(qt||(qt={})),function(t){t[t.Any=1]="Any",t[t.Boolean=2]="Boolean",t[t.OctetString=3]="OctetString",t[t.BitString=4]="BitString",t[t.Integer=5]="Integer",t[t.Enumerated=6]="Enumerated",t[t.ObjectIdentifier=7]="ObjectIdentifier",t[t.Utf8String=8]="Utf8String",t[t.BmpString=9]="BmpString",t[t.UniversalString=10]="UniversalString",t[t.NumericString=11]="NumericString",t[t.PrintableString=12]="PrintableString",t[t.TeletexString=13]="TeletexString",t[t.VideotexString=14]="VideotexString",t[t.IA5String=15]="IA5String",t[t.GraphicString=16]="GraphicString",t[t.VisibleString=17]="VisibleString",t[t.GeneralString=18]="GeneralString",t[t.CharacterString=19]="CharacterString",t[t.UTCTime=20]="UTCTime",t[t.GeneralizedTime=21]="GeneralizedTime",t[t.DATE=22]="DATE",t[t.TimeOfDay=23]="TimeOfDay",t[t.DateTime=24]="DateTime",t[t.Duration=25]="Duration",t[t.TIME=26]="TIME",t[t.Null=27]="Null"}(Lt||(Lt={}));const Gt={fromASN:t=>t instanceof et?null:t.valueBeforeDecode,toASN:t=>{if(null===t)return new et;const e=zt(t);if(e.result.error)throw new Error(e.result.error);return e.result}},Zt={fromASN:t=>t.valueBlock.valueHex.byteLength>4?t.valueBlock.toString():t.valueBlock.valueDec,toASN:t=>new at({value:t})},Kt={fromASN:t=>t.valueBlock.valueDec,toASN:t=>new ct({value:t})},Qt={fromASN:t=>t.valueBlock.valueHex,toASN:t=>new at({valueHex:t})},Yt={fromASN:t=>t.valueBlock.valueHex,toASN:t=>new nt({valueHex:t})},Xt={fromASN:t=>t.valueBlock.toString(),toASN:t=>new lt({value:t})},te={fromASN:t=>t.valueBlock.value,toASN:t=>new Y({value:t})},ee={fromASN:t=>t.valueBlock.valueHex,toASN:t=>new it({valueHex:t})};function re(t){return{fromASN:t=>t.valueBlock.value,toASN:e=>new t({value:e})}}const ie=re(dt),se=re(bt),ne=re(mt),oe=re(St),ae=re(Bt),ce=re(Nt),he=re(xt),ue=re(Et),le=re(Ut),fe=re(_t),de=re(It),pe=re(Ot),ye={fromASN:t=>t.toDate(),toASN:t=>new Ct({valueDate:t})},we={fromASN:t=>t.toDate(),toASN:t=>new Rt({valueDate:t})},ge={fromASN:()=>null,toASN:()=>new et};function be(t){switch(t){case Lt.Any:return Gt;case Lt.BitString:return Yt;case Lt.BmpString:return se;case Lt.Boolean:return te;case Lt.CharacterString:return pe;case Lt.Enumerated:return Kt;case Lt.GeneralString:return de;case Lt.GeneralizedTime:return we;case Lt.GraphicString:return le;case Lt.IA5String:return ue;case Lt.Integer:return Zt;case Lt.Null:return ge;case Lt.NumericString:return oe;case Lt.ObjectIdentifier:return Xt;case Lt.OctetString:return ee;case Lt.PrintableString:return ae;case Lt.TeletexString:return ce;case Lt.UTCTime:return ye;case Lt.UniversalString:return ne;case Lt.Utf8String:return ie;case Lt.VideotexString:return he;case Lt.VisibleString:return fe;default:return null}}class ve{constructor(t,e=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),t)if("number"==typeof t)this.fromNumber(t);else{if(!n.isBufferSource(t))throw TypeError("Unsupported type of 'params' argument for BitString");this.unusedBits=e,this.value=n.toArrayBuffer(t)}}fromASN(t){if(!(t instanceof nt))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=t.valueBlock.unusedBits,this.value=t.valueBlock.valueHex,this}toASN(){return new nt({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(t){return new nt({name:t})}toNumber(){let t="";const e=new Uint8Array(this.value);for(const r of e)t+=r.toString(2).padStart(8,"0");return t=t.split("").reverse().join(""),this.unusedBits&&(t=t.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(t,2)}fromNumber(t){let e=t.toString(2);const r=e.length+7>>3;this.unusedBits=(r<<3)-e.length;const i=new Uint8Array(r);e=e.padStart(r<<3,"0").split("").reverse().join("");let s=0;for(;s<r;)i[s]=parseInt(e.slice(s<<3,8+(s<<3)),2),s++;this.value=i.buffer}}class me extends ArrayBuffer{constructor(t){if("number"==typeof t)super(t);else if(n.isBufferSource(t))super(t.byteLength),new Uint8Array(this).set(n.toUint8Array(t));else if(Array.isArray(t)){var e=new Uint8Array(t);super(e.length),new Uint8Array(this).set(e)}else super(0)}fromASN(t){if(!(t instanceof it))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return new me(t.valueBlock.valueHex)}toASN(){return new it({valueHex:this})}toSchema(t){return new it({name:t})}}function Ae(t){return t&&t.prototype?!(!t.prototype.toASN||!t.prototype.fromASN)||Ae(t.prototype):!!(t&&t.toASN&&t.fromASN)}function ke(t,e){if(!t||!e)return!1;if(t.byteLength!==e.byteLength)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<t.byteLength;s++)if(r[s]!==i[s])return!1;return!0}const Se=new class{constructor(){this.items=new WeakMap}has(t){return this.items.has(t)}get(t){var e,r,i,s;const n=this.items.get(t);if(!n)throw new Error(`Cannot get schema for '${null!==(s=null===(i=null===(r=null===(e=t)||void 0===e?void 0:e.prototype)||void 0===r?void 0:r.constructor)||void 0===i?void 0:i.name)&&void 0!==s?s:t}' target`);return n}cache(t){const e=this.get(t);e.schema||(e.schema=this.create(t,!0))}createDefault(t){const e={type:qt.Sequence,items:{}},r=this.findParentSchema(t);return r&&(Object.assign(e,r),e.items=Object.assign({},e.items,r.items)),e}create(t,e){const r=this.items.get(t)||this.createDefault(t),i=[];for(const s in r.items){const t=r.items[s],n=e?s:"";let o;if("number"==typeof t.type){const e=Lt[t.type],r=Jt[e];if(!r)throw new Error(`Cannot get ASN1 class by name '${e}'`);o=new r({name:n})}else o=Ae(t.type)?(new t.type).toSchema(n):new Vt({name:n});const a=!!t.optional||void 0!==t.defaultValue;if(t.repeated&&(o.name="",o=new("set"===t.repeated?tt:X)({name:"",value:[new $t({name:n,value:o})]})),null!=t.context)if(t.implicit)if("number"==typeof t.type||Ae(t.type))i.push(new(t.repeated?G:q)({name:n,optional:a,idBlock:{tagClass:3,tagNumber:t.context}}));else{this.cache(t.type);const e=!!t.repeated;let r=e?o:this.get(t.type).schema;r=r.valueBlock?r.valueBlock.value:r.value,i.push(new G({name:e?"":n,optional:a,idBlock:{tagClass:3,tagNumber:t.context},value:r}))}else i.push(new G({optional:a,idBlock:{tagClass:3,tagNumber:t.context},value:[o]}));else o.optional=a,i.push(o)}switch(r.type){case qt.Sequence:return new X({value:i,name:""});case qt.Set:return new tt({value:i,name:""});case qt.Choice:return new Mt({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(t,e){return this.items.set(t,e),this}findParentSchema(t){const e=t.__proto__;return e?this.items.get(e)||this.findParentSchema(e):null}},Be=t=>e=>{let r;Se.has(e)?r=Se.get(e):(r=Se.createDefault(e),Se.set(e,r)),Object.assign(r,t)},Ne=t=>(e,r)=>{let i;Se.has(e.constructor)?i=Se.get(e.constructor):(i=Se.createDefault(e.constructor),Se.set(e.constructor,i));const s=Object.assign({},t);if("number"==typeof s.type&&!s.converter){const i=be(t.type);if(!i)throw new Error(`Cannot get default converter for property '${r}' of ${e.constructor.name}`);s.converter=i}i.items[r]=s};class xe extends Error{constructor(){super(...arguments),this.schemas=[]}}class Ee{static parse(t,e){let r;if(t instanceof ArrayBuffer)r=t;else if(void 0!==typeof Buffer&&Buffer.isBuffer(t))r=new Uint8Array(t).buffer;else{if(!ArrayBuffer.isView(t))throw new TypeError("Wrong type of 'data' argument");r=t.buffer}const i=zt(r);if(i.result.error)throw new Error(i.result.error);return this.fromASN(i.result,e)}static fromASN(t,e){var r;try{if(Ae(e))return(new e).fromASN(t);const i=Se.get(e);Se.cache(e);let s=i.schema;if(t.constructor===G&&i.type!==qt.Choice){s=new G({idBlock:{tagClass:3,tagNumber:t.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const e in i.items)delete t[e]}const n=Ht(t,t,s);if(!n.verified)throw new xe(`Data does not match to ${e.name} ASN1 schema. ${n.result.error}`);const o=new e;if(function t(e){var r;if(e){const i=Object.getPrototypeOf(e);return(null===(r=null==i?void 0:i.prototype)||void 0===r?void 0:r.constructor)===Array||t(i)}return!1}(e)){if("number"==typeof i.itemType){const r=be(i.itemType);if(!r)throw new Error(`Cannot get default converter for array item of ${e.name} ASN1 schema`);return e.from(t.valueBlock.value,t=>r.fromASN(t))}return e.from(t.valueBlock.value,t=>this.fromASN(t,i.itemType))}for(const e in i.items){if(!t[e])continue;const s=i.items[e];if("number"==typeof s.type||Ae(s.type)){const i=null!==(r=s.converter)&&void 0!==r?r:Ae(s.type)?new s.type:null;if(!i)throw new Error("Converter is empty");if(s.repeated)if(s.implicit){const r=new("sequence"===s.repeated?X:tt);r.valueBlock=t[e].valueBlock;const n=zt(r.toBER(!1)).result.valueBlock.value;o[e]=Array.from(n,t=>i.fromASN(t))}else o[e]=Array.from(t[e],t=>i.fromASN(t));else{let r=t[e];if(s.implicit){let t;if(Ae(s.type))t=(new s.type).toSchema("");else{const e=Lt[s.type],r=Jt[e];if(!r)throw new Error(`Cannot get '${e}' class from asn1js module`);t=new r}t.valueBlock=r.valueBlock,r=zt(t.toBER(!1)).result}o[e]=i.fromASN(r)}}else o[e]=s.repeated?Array.from(t[e],t=>this.fromASN(t,s.type)):this.fromASN(t[e],s.type)}return o}catch(i){throw i instanceof xe&&i.schemas.push(e.name),i}}}class Ue{static serialize(t){return t instanceof H?t.toBER(!1):this.toASN(t).toBER(!1)}static toASN(t){if(t&&Ae(t.constructor))return t.toASN();const e=t.constructor,r=Se.get(e);Se.cache(e);let i,s=[];if(r.itemType)if("number"==typeof r.itemType){const i=be(r.itemType);if(!i)throw new Error(`Cannot get default converter for array item of ${e.name} ASN1 schema`);s=t.map(t=>i.toASN(t))}else s=t.map(t=>this.toAsnItem({type:r.itemType},"[]",e,t));else for(const n in r.items){const i=r.items[n],o=t[n];if(void 0===o||i.defaultValue===o||"object"==typeof i.defaultValue&&"object"==typeof o&&ke(this.serialize(i.defaultValue),this.serialize(o)))continue;let a=Ue.toAsnItem(i,n,e,o);if("number"==typeof i.context)if(i.implicit)if(i.repeated||"number"!=typeof i.type&&!Ae(i.type))s.push(new G({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:a.valueBlock.value}));else{const t={};t.valueHex=a.valueBlock.toBER(),s.push(new q(Object.assign({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context}},t)))}else s.push(new G({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:[a]}));else i.repeated?s=s.concat(a):s.push(a)}switch(r.type){case qt.Sequence:i=new X({value:s});break;case qt.Set:i=new tt({value:s});break;case qt.Choice:if(!s[0])throw new Error(`Schema '${e.name}' has wrong data. Choice cannot be empty.`);i=s[0]}return i}static toAsnItem(t,e,r,i){let s;if("number"==typeof t.type){const n=t.converter;if(!n)throw new Error(`Property '${e}' doesn't have converter for type ${Lt[t.type]} in schema '${r.name}'`);if(t.repeated){const e=Array.from(i,t=>n.toASN(t));s=new("sequence"===t.repeated?X:tt)({value:e})}else s=n.toASN(i)}else if(t.repeated){const e=Array.from(i,t=>this.toASN(t));s=new("sequence"===t.repeated?X:tt)({value:e})}else s=this.toASN(i);return s}}class _e extends Array{constructor(t=[]){if("number"==typeof t)super(t);else{super();for(const e of t)this.push(e)}}}class Ie{static serialize(t){return Ue.serialize(t)}static parse(t,e){return Ee.parse(t,e)}}o((function(t){(function(){var e,r,i,s,n,o,a;r={},null!==t&&t.exports?t.exports=r:this.ipaddr=r,a=function(t,e,r,i){var s,n;if(t.length!==e.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");for(s=0;i>0;){if((n=r-i)<0&&(n=0),t[s]>>n!=e[s]>>n)return!1;i-=r,s+=1}return!0},r.subnetMatch=function(t,e,r){var i,s,n,o,a;for(n in null==r&&(r="unicast"),e)for(!(o=e[n])[0]||o[0]instanceof Array||(o=[o]),i=0,s=o.length;i<s;i++)if(a=o[i],t.kind()===a[0].kind()&&t.match.apply(t,a))return n;return r},r.IPv4=function(){function t(t){var e,r,i;if(4!==t.length)throw new Error("ipaddr: ipv4 octet count should be 4");for(e=0,r=t.length;e<r;e++)if(!(0<=(i=t[e])&&i<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=t}return t.prototype.kind=function(){return"ipv4"},t.prototype.toString=function(){return this.octets.join(".")},t.prototype.toNormalizedString=function(){return this.toString()},t.prototype.toByteArray=function(){return this.octets.slice(0)},t.prototype.match=function(t,e){var r;if(void 0===e&&(t=(r=t)[0],e=r[1]),"ipv4"!==t.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return a(this.octets,t.octets,8,e)},t.prototype.SpecialRanges={unspecified:[[new t([0,0,0,0]),8]],broadcast:[[new t([255,255,255,255]),32]],multicast:[[new t([224,0,0,0]),4]],linkLocal:[[new t([169,254,0,0]),16]],loopback:[[new t([127,0,0,0]),8]],carrierGradeNat:[[new t([100,64,0,0]),10]],private:[[new t([10,0,0,0]),8],[new t([172,16,0,0]),12],[new t([192,168,0,0]),16]],reserved:[[new t([192,0,0,0]),24],[new t([192,0,2,0]),24],[new t([192,88,99,0]),24],[new t([198,51,100,0]),24],[new t([203,0,113,0]),24],[new t([240,0,0,0]),4]]},t.prototype.range=function(){return r.subnetMatch(this,this.SpecialRanges)},t.prototype.toIPv4MappedAddress=function(){return r.IPv6.parse("::ffff:"+this.toString())},t.prototype.prefixLengthFromSubnetMask=function(){var t,e,r,i,s,n,o;for(o={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},t=0,s=!1,e=r=3;r>=0;e=r+=-1){if(!((i=this.octets[e])in o))return null;if(n=o[i],s&&0!==n)return null;8!==n&&(s=!0),t+=n}return 32-t},t}(),i="(0?\\d+|0x[a-f0-9]+)",s={fourOctet:new RegExp("^"+i+"\\."+i+"\\."+i+"\\."+i+"$","i"),longValue:new RegExp("^"+i+"$","i")},r.IPv4.parser=function(t){var e,r,i,n;if(r=function(t){return"0"===t[0]&&"x"!==t[1]?parseInt(t,8):parseInt(t)},e=t.match(s.fourOctet))return function(){var t,i,s,n;for(n=[],t=0,i=(s=e.slice(1,6)).length;t<i;t++)n.push(r(s[t]));return n}();if(e=t.match(s.longValue)){if((n=r(e[1]))>4294967295||n<0)throw new Error("ipaddr: address outside defined range");return function(){var t,e;for(e=[],i=t=0;t<=24;i=t+=8)e.push(n>>i&255);return e}().reverse()}return null},r.IPv6=function(){function t(t,e){var r,i,s,n,o,a;if(16===t.length)for(this.parts=[],r=i=0;i<=14;r=i+=2)this.parts.push(t[r]<<8|t[r+1]);else{if(8!==t.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=t}for(s=0,n=(a=this.parts).length;s<n;s++)if(!(0<=(o=a[s])&&o<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");e&&(this.zoneId=e)}return t.prototype.kind=function(){return"ipv6"},t.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},t.prototype.toRFC5952String=function(){var t,e,r,i,s;for(i=/((^|:)(0(:|$)){2,})/g,s=this.toNormalizedString(),t=0,e=-1;r=i.exec(s);)r[0].length>e&&(t=r.index,e=r[0].length);return e<0?s:s.substring(0,t)+"::"+s.substring(t+e)},t.prototype.toByteArray=function(){var t,e,r,i,s;for(t=[],e=0,r=(s=this.parts).length;e<r;e++)t.push((i=s[e])>>8),t.push(255&i);return t},t.prototype.toNormalizedString=function(){var t,e;return t=function(){var t,e,r,i;for(i=[],t=0,e=(r=this.parts).length;t<e;t++)i.push(r[t].toString(16));return i}.call(this).join(":"),e="",this.zoneId&&(e="%"+this.zoneId),t+e},t.prototype.toFixedLengthString=function(){var t,e;return t=function(){var t,e,r,i;for(i=[],t=0,e=(r=this.parts).length;t<e;t++)i.push(r[t].toString(16).padStart(4,"0"));return i}.call(this).join(":"),e="",this.zoneId&&(e="%"+this.zoneId),t+e},t.prototype.match=function(t,e){var r;if(void 0===e&&(t=(r=t)[0],e=r[1]),"ipv6"!==t.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return a(this.parts,t.parts,16,e)},t.prototype.SpecialRanges={unspecified:[new t([0,0,0,0,0,0,0,0]),128],linkLocal:[new t([65152,0,0,0,0,0,0,0]),10],multicast:[new t([65280,0,0,0,0,0,0,0]),8],loopback:[new t([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new t([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new t([0,0,0,0,0,65535,0,0]),96],rfc6145:[new t([0,0,0,0,65535,0,0,0]),96],rfc6052:[new t([100,65435,0,0,0,0,0,0]),96],"6to4":[new t([8194,0,0,0,0,0,0,0]),16],teredo:[new t([8193,0,0,0,0,0,0,0]),32],reserved:[[new t([8193,3512,0,0,0,0,0,0]),32]]},t.prototype.range=function(){return r.subnetMatch(this,this.SpecialRanges)},t.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},t.prototype.toIPv4Address=function(){var t,e,i;if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");return i=this.parts.slice(-2),new r.IPv4([(t=i[0])>>8,255&t,(e=i[1])>>8,255&e])},t.prototype.prefixLengthFromSubnetMask=function(){var t,e,r,i,s,n,o;for(o={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},t=0,s=!1,e=r=7;r>=0;e=r+=-1){if(!((i=this.parts[e])in o))return null;if(n=o[i],s&&0!==n)return null;16!==n&&(s=!0),t+=n}return 128-t},t}(),n="(?:[0-9a-f]+::?)+",o={zoneIndex:new RegExp("%[0-9a-z]{1,}","i"),native:new RegExp("^(::)?("+n+")?([0-9a-f]+)?(::)?(%[0-9a-z]{1,})?$","i"),transitional:new RegExp("^((?:"+n+")|(?:::)(?:"+n+")?)"+i+"\\."+i+"\\."+i+"\\."+i+"(%[0-9a-z]{1,})?$","i")},e=function(t,e){var r,i,s,n,a;if(t.indexOf("::")!==t.lastIndexOf("::"))return null;for((a=(t.match(o.zoneIndex)||[])[0])&&(a=a.substring(1),t=t.replace(/%.+$/,"")),r=0,i=-1;(i=t.indexOf(":",i+1))>=0;)r++;if("::"===t.substr(0,2)&&r--,"::"===t.substr(-2,2)&&r--,r>e)return null;for(n=e-r,s=":";n--;)s+="0:";return":"===(t=t.replace("::",s))[0]&&(t=t.slice(1)),":"===t[t.length-1]&&(t=t.slice(0,-1)),{parts:e=function(){var e,r,i,s;for(s=[],e=0,r=(i=t.split(":")).length;e<r;e++)s.push(parseInt(i[e],16));return s}(),zoneId:a}},r.IPv6.parser=function(t){var r,i,s,n,a,c,h;if(o.native.test(t))return e(t,8);if((n=t.match(o.transitional))&&(h=n[6]||"",(r=e(n[1].slice(0,-1)+h,6)).parts)){for(i=0,s=(c=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])]).length;i<s;i++)if(!(0<=(a=c[i])&&a<=255))return null;return r.parts.push(c[0]<<8|c[1]),r.parts.push(c[2]<<8|c[3]),{parts:r.parts,zoneId:r.zoneId}}return null},r.IPv4.isIPv4=r.IPv6.isIPv6=function(t){return null!==this.parser(t)},r.IPv4.isValid=function(t){try{return new this(this.parser(t)),!0}catch(e){return!1}},r.IPv4.isValidFourPartDecimal=function(t){return!(!r.IPv4.isValid(t)||!t.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},r.IPv6.isValid=function(t){var e;if("string"==typeof t&&-1===t.indexOf(":"))return!1;try{return new this((e=this.parser(t)).parts,e.zoneId),!0}catch(r){return!1}},r.IPv4.parse=function(t){var e;if(null===(e=this.parser(t)))throw new Error("ipaddr: string is not formatted like ip address");return new this(e)},r.IPv6.parse=function(t){var e;if(null===(e=this.parser(t)).parts)throw new Error("ipaddr: string is not formatted like ip address");return new this(e.parts,e.zoneId)},r.IPv4.parseCIDR=function(t){var e,r,i;if((r=t.match(/^(.+)\/(\d+)$/))&&(e=parseInt(r[2]))>=0&&e<=32)return i=[this.parse(r[1]),e],Object.defineProperty(i,"toString",{value:function(){return this.join("/")}}),i;throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},r.IPv4.subnetMaskFromPrefixLength=function(t){var e,r,i;if((t=parseInt(t))<0||t>32)throw new Error("ipaddr: invalid IPv4 prefix length");for(i=[0,0,0,0],r=0,e=Math.floor(t/8);r<e;)i[r]=255,r++;return e<4&&(i[e]=Math.pow(2,t%8)-1<<8-t%8),new this(i)},r.IPv4.broadcastAddressFromCIDR=function(t){var e,r,i,s,n;try{for(i=(e=this.parseCIDR(t))[0].toByteArray(),n=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),s=[],r=0;r<4;)s.push(parseInt(i[r],10)|255^parseInt(n[r],10)),r++;return new this(s)}catch(o){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},r.IPv4.networkAddressFromCIDR=function(t){var e,r,i,s,n;try{for(i=(e=this.parseCIDR(t))[0].toByteArray(),n=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),s=[],r=0;r<4;)s.push(parseInt(i[r],10)&parseInt(n[r],10)),r++;return new this(s)}catch(o){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},r.IPv6.parseCIDR=function(t){var e,r,i;if((r=t.match(/^(.+)\/(\d+)$/))&&(e=parseInt(r[2]))>=0&&e<=128)return i=[this.parse(r[1]),e],Object.defineProperty(i,"toString",{value:function(){return this.join("/")}}),i;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},r.isValid=function(t){return r.IPv6.isValid(t)||r.IPv4.isValid(t)},r.parse=function(t){if(r.IPv6.isValid(t))return r.IPv6.parse(t);if(r.IPv4.isValid(t))return r.IPv4.parse(t);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},r.parseCIDR=function(t){try{return r.IPv6.parseCIDR(t)}catch(e){try{return r.IPv4.parseCIDR(t)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},r.fromByteArray=function(t){var e;if(4===(e=t.length))return new r.IPv4(t);if(16===e)return new r.IPv6(t);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},r.process=function(t){var e;return"ipv6"===(e=this.parse(t)).kind()&&e.isIPv4MappedAddress()?e.toIPv4Address():e}}).call(a)}));class Oe{static decodeIP(t){if(64===t.length&&0===parseInt(t,16))return"::/0";if(16!==t.length)return t;const e=parseInt(t.slice(8),16).toString(2).split("").reduce((t,e)=>t+ +e,0);let r=t.slice(0,8).replace(/(.{2})/g,t=>parseInt(t,16)+".");return r=r.slice(0,-1),`${r}/${e}`}static toString(t){if(4===t.byteLength||16===t.byteLength){const e=new Uint8Array(t);return(void 0)(Array.from(e)).toString()}return this.decodeIP(c.ToHex(t))}static fromString(t){const e=(void 0)(t);return new Uint8Array(e.toByteArray()).buffer}}let Ce=class{constructor(t={}){Object.assign(this,t)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};E([Ne({type:Lt.TeletexString})],Ce.prototype,"teletexString",void 0),E([Ne({type:Lt.PrintableString})],Ce.prototype,"printableString",void 0),E([Ne({type:Lt.UniversalString})],Ce.prototype,"universalString",void 0),E([Ne({type:Lt.Utf8String})],Ce.prototype,"utf8String",void 0),E([Ne({type:Lt.BmpString})],Ce.prototype,"bmpString",void 0),Ce=E([Be({type:qt.Choice})],Ce);let Re=class extends Ce{constructor(t={}){super(t),Object.assign(this,t)}toString(){return this.ia5String||(this.anyValue?c.ToHex(this.anyValue):super.toString())}};E([Ne({type:Lt.IA5String})],Re.prototype,"ia5String",void 0),E([Ne({type:Lt.Any})],Re.prototype,"anyValue",void 0),Re=E([Be({type:qt.Choice})],Re);class Te{constructor(t={}){this.type="",this.value=new Re,Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Te.prototype,"type",void 0),E([Ne({type:Re})],Te.prototype,"value",void 0);let je=class extends _e{};je=E([Be({type:qt.Set,itemType:Te})],je);let De=class extends _e{};De=E([Be({type:qt.Sequence,itemType:je})],De);let We=class extends De{};We=E([Be({type:qt.Sequence})],We);const Pe={fromASN:t=>Oe.toString(ee.fromASN(t)),toASN:t=>ee.toASN(Oe.fromString(t))};class Me{constructor(t={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Me.prototype,"typeId",void 0),E([Ne({type:Lt.Any,context:0})],Me.prototype,"value",void 0);class Ve{constructor(t={}){this.partyName=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:Ce,optional:!0,context:0,implicit:!0})],Ve.prototype,"nameAssigner",void 0),E([Ne({type:Ce,context:1,implicit:!0})],Ve.prototype,"partyName",void 0);let $e=class{constructor(t={}){Object.assign(this,t)}};E([Ne({type:Me,context:0,implicit:!0})],$e.prototype,"otherName",void 0),E([Ne({type:Lt.IA5String,context:1,implicit:!0})],$e.prototype,"rfc822Name",void 0),E([Ne({type:Lt.IA5String,context:2,implicit:!0})],$e.prototype,"dNSName",void 0),E([Ne({type:Lt.Any,context:3,implicit:!0})],$e.prototype,"x400Address",void 0),E([Ne({type:We,context:4,implicit:!1})],$e.prototype,"directoryName",void 0),E([Ne({type:Ve,context:5})],$e.prototype,"ediPartyName",void 0),E([Ne({type:Lt.IA5String,context:6,implicit:!0})],$e.prototype,"uniformResourceIdentifier",void 0),E([Ne({type:Lt.OctetString,context:7,implicit:!0,converter:Pe})],$e.prototype,"iPAddress",void 0),E([Ne({type:Lt.ObjectIdentifier,context:8,implicit:!0})],$e.prototype,"registeredID",void 0),$e=E([Be({type:qt.Choice})],$e);class Fe{constructor(t={}){this.accessMethod="",this.accessLocation=new $e,Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Fe.prototype,"accessMethod",void 0),E([Ne({type:$e})],Fe.prototype,"accessLocation",void 0);let ze=class extends _e{};ze=E([Be({type:qt.Sequence,itemType:Fe})],ze);class He{constructor(t={}){t&&Object.assign(this,t)}}E([Ne({type:class extends me{},context:0,optional:!0,implicit:!0})],He.prototype,"keyIdentifier",void 0),E([Ne({type:$e,context:1,optional:!0,implicit:!0,repeated:"sequence"})],He.prototype,"authorityCertIssuer",void 0),E([Ne({type:Lt.Integer,context:2,optional:!0,implicit:!0,converter:Qt})],He.prototype,"authorityCertSerialNumber",void 0);class Je{constructor(t={}){this.cA=!1,Object.assign(this,t)}}E([Ne({type:Lt.Boolean,defaultValue:!1})],Je.prototype,"cA",void 0),E([Ne({type:Lt.Integer,optional:!0})],Je.prototype,"pathLenConstraint",void 0);let qe=class extends _e{};qe=E([Be({type:qt.Sequence,itemType:$e})],qe);let Le=class extends qe{};Le=E([Be({type:qt.Sequence})],Le);let Ge=class{constructor(t={}){Object.assign(this,t)}};E([Ne({type:Lt.IA5String})],Ge.prototype,"ia5String",void 0),E([Ne({type:Lt.VisibleString})],Ge.prototype,"visibleString",void 0),E([Ne({type:Lt.BmpString})],Ge.prototype,"bmpString",void 0),E([Ne({type:Lt.Utf8String})],Ge.prototype,"utf8String",void 0),Ge=E([Be({type:qt.Choice})],Ge);class Ze{constructor(t={}){this.organization=new Ge,this.noticeNumbers=[],Object.assign(this,t)}}E([Ne({type:Ge})],Ze.prototype,"organization",void 0),E([Ne({type:Lt.Integer,repeated:"sequence"})],Ze.prototype,"noticeNumbers",void 0);class Ke{constructor(t={}){Object.assign(this,t)}}E([Ne({type:Ze,optional:!0})],Ke.prototype,"noticeRef",void 0),E([Ne({type:Ge,optional:!0})],Ke.prototype,"explicitText",void 0);let Qe=class{constructor(t={}){Object.assign(this,t)}};E([Ne({type:Lt.IA5String})],Qe.prototype,"cPSuri",void 0),E([Ne({type:Ke})],Qe.prototype,"userNotice",void 0),Qe=E([Be({type:qt.Choice})],Qe);class Ye{constructor(t={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Ye.prototype,"policyQualifierId",void 0),E([Ne({type:Lt.Any})],Ye.prototype,"qualifier",void 0);class Xe{constructor(t={}){this.policyIdentifier="",Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Xe.prototype,"policyIdentifier",void 0),E([Ne({type:Ye,repeated:"sequence",optional:!0})],Xe.prototype,"policyQualifiers",void 0);let tr=class extends _e{};var er;tr=E([Be({type:qt.Sequence,itemType:Xe})],tr),function(t){t[t.unused=1]="unused",t[t.keyCompromise=2]="keyCompromise",t[t.cACompromise=4]="cACompromise",t[t.affiliationChanged=8]="affiliationChanged",t[t.superseded=16]="superseded",t[t.cessationOfOperation=32]="cessationOfOperation",t[t.certificateHold=64]="certificateHold",t[t.privilegeWithdrawn=128]="privilegeWithdrawn",t[t.aACompromise=256]="aACompromise"}(er||(er={}));let rr=class{constructor(t={}){Object.assign(this,t)}};E([Ne({type:$e,context:0,repeated:"sequence",implicit:!0})],rr.prototype,"fullName",void 0),E([Ne({type:je,context:1,implicit:!0})],rr.prototype,"nameRelativeToCRLIssuer",void 0),rr=E([Be({type:qt.Choice})],rr);class ir{constructor(t={}){Object.assign(this,t)}}E([Ne({type:rr,context:0,optional:!0})],ir.prototype,"distributionPoint",void 0),E([Ne({type:class extends ve{toJSON(){const t=[],e=this.toNumber();return e&er.aACompromise&&t.push("aACompromise"),e&er.affiliationChanged&&t.push("affiliationChanged"),e&er.cACompromise&&t.push("cACompromise"),e&er.certificateHold&&t.push("certificateHold"),e&er.cessationOfOperation&&t.push("cessationOfOperation"),e&er.keyCompromise&&t.push("keyCompromise"),e&er.privilegeWithdrawn&&t.push("privilegeWithdrawn"),e&er.superseded&&t.push("superseded"),e&er.unused&&t.push("unused"),t}toString(){return`[${this.toJSON().join(", ")}]`}},context:1,optional:!0,implicit:!0})],ir.prototype,"reasons",void 0),E([Ne({type:$e,context:2,optional:!0,repeated:"sequence",implicit:!0})],ir.prototype,"cRLIssuer",void 0);let sr=class extends _e{};var nr;sr=E([Be({type:qt.Sequence,itemType:ir})],sr),function(t){t[t.unspecified=0]="unspecified",t[t.keyCompromise=1]="keyCompromise",t[t.cACompromise=2]="cACompromise",t[t.affiliationChanged=3]="affiliationChanged",t[t.superseded=4]="superseded",t[t.cessationOfOperation=5]="cessationOfOperation",t[t.certificateHold=6]="certificateHold",t[t.removeFromCRL=8]="removeFromCRL",t[t.privilegeWithdrawn=9]="privilegeWithdrawn",t[t.aACompromise=10]="aACompromise"}(nr||(nr={}));let or=class{constructor(t=nr.unspecified){this.reason=nr.unspecified,this.reason=t}};E([Ne({type:Lt.Enumerated})],or.prototype,"reason",void 0),or=E([Be({type:qt.Choice})],or);let ar=class extends _e{};ar=E([Be({type:qt.Sequence,itemType:Lt.ObjectIdentifier})],ar);let cr=class{constructor(t=new ArrayBuffer(0)){this.value=t}};E([Ne({type:Lt.Integer,converter:Qt})],cr.prototype,"value",void 0),cr=E([Be({type:qt.Choice})],cr);let hr=class{constructor(t){this.value=new Date,t&&(this.value=t)}};E([Ne({type:Lt.GeneralizedTime})],hr.prototype,"value",void 0),hr=E([Be({type:qt.Choice})],hr);let ur=class extends qe{};var lr;ur=E([Be({type:qt.Sequence})],ur),function(t){t[t.digitalSignature=1]="digitalSignature",t[t.nonRepudiation=2]="nonRepudiation",t[t.keyEncipherment=4]="keyEncipherment",t[t.dataEncipherment=8]="dataEncipherment",t[t.keyAgreement=16]="keyAgreement",t[t.keyCertSign=32]="keyCertSign",t[t.cRLSign=64]="cRLSign",t[t.encipherOnly=128]="encipherOnly",t[t.decipherOnly=256]="decipherOnly"}(lr||(lr={}));class fr extends ve{toJSON(){const t=this.toNumber(),e=[];return t&lr.cRLSign&&e.push("crlSign"),t&lr.dataEncipherment&&e.push("dataEncipherment"),t&lr.decipherOnly&&e.push("decipherOnly"),t&lr.digitalSignature&&e.push("digitalSignature"),t&lr.encipherOnly&&e.push("encipherOnly"),t&lr.keyAgreement&&e.push("keyAgreement"),t&lr.keyCertSign&&e.push("keyCertSign"),t&lr.keyEncipherment&&e.push("keyEncipherment"),t&lr.nonRepudiation&&e.push("nonRepudiation"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class dr{constructor(t={}){this.base=new $e,this.minimum=0,Object.assign(this,t)}}E([Ne({type:$e})],dr.prototype,"base",void 0),E([Ne({type:Lt.Integer,context:0,defaultValue:0,implicit:!0})],dr.prototype,"minimum",void 0),E([Ne({type:Lt.Integer,context:1,optional:!0,implicit:!0})],dr.prototype,"maximum",void 0);let pr=class extends _e{};pr=E([Be({type:qt.Sequence,itemType:dr})],pr);class yr{constructor(t={}){Object.assign(this,t)}}E([Ne({type:pr,context:0,optional:!0,implicit:!0})],yr.prototype,"permittedSubtrees",void 0),E([Ne({type:pr,context:1,optional:!0,implicit:!0})],yr.prototype,"excludedSubtrees",void 0);class wr{constructor(t={}){Object.assign(this,t)}}E([Ne({type:Lt.Integer,context:0,implicit:!0,optional:!0,converter:Qt})],wr.prototype,"requireExplicitPolicy",void 0),E([Ne({type:Lt.Integer,context:1,implicit:!0,optional:!0,converter:Qt})],wr.prototype,"inhibitPolicyMapping",void 0);class gr{constructor(t={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],gr.prototype,"issuerDomainPolicy",void 0),E([Ne({type:Lt.ObjectIdentifier})],gr.prototype,"subjectDomainPolicy",void 0);let br=class extends qe{};br=E([Be({type:qt.Sequence})],br);class vr{constructor(t={}){this.type="",this.values=[],Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],vr.prototype,"type",void 0),E([Ne({type:Lt.Any,repeated:"set"})],vr.prototype,"values",void 0);let mr=class extends _e{};mr=E([Be({type:qt.Sequence,itemType:vr})],mr);class Ar{constructor(t={}){this.algorithm="",Object.assign(this,t)}}E([Ne({type:Lt.ObjectIdentifier})],Ar.prototype,"algorithm",void 0),E([Ne({type:Lt.Any,optional:!0})],Ar.prototype,"parameters",void 0);class kr{constructor(t={}){this.algorithm=new Ar,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:Ar})],kr.prototype,"algorithm",void 0),E([Ne({type:Lt.BitString})],kr.prototype,"subjectPublicKey",void 0);let Sr=class{constructor(t){t&&("string"==typeof t||"number"==typeof t?this.utcTime=new Date(t):t instanceof Date?this.utcTime=t:Object.assign(this,t))}getTime(){const t=this.utcTime||this.generalTime;if(!t)throw new Error("Cannot get time from CHOICE object");return t}};E([Ne({type:Lt.UTCTime})],Sr.prototype,"utcTime",void 0),E([Ne({type:Lt.GeneralizedTime})],Sr.prototype,"generalTime",void 0),Sr=E([Be({type:qt.Choice})],Sr);class Br{constructor(t){this.notBefore=new Sr(new Date),this.notAfter=new Sr(new Date),t&&(this.notBefore=new Sr(t.notBefore),this.notAfter=new Sr(t.notAfter))}}E([Ne({type:Sr})],Br.prototype,"notBefore",void 0),E([Ne({type:Sr})],Br.prototype,"notAfter",void 0);class Nr{constructor(t={}){this.extnID="",this.critical=Nr.CRITICAL,this.extnValue=new me,Object.assign(this,t)}}Nr.CRITICAL=!1,E([Ne({type:Lt.ObjectIdentifier})],Nr.prototype,"extnID",void 0),E([Ne({type:Lt.Boolean,defaultValue:Nr.CRITICAL})],Nr.prototype,"critical",void 0),E([Ne({type:me})],Nr.prototype,"extnValue",void 0);let xr=class extends _e{};var Er,Ur;xr=E([Be({type:qt.Sequence,itemType:Nr})],xr),function(t){t[t.v1=0]="v1",t[t.v2=1]="v2",t[t.v3=2]="v3"}(Er||(Er={}));class _r{constructor(t={}){this.version=Er.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new Ar,this.issuer=new We,this.validity=new Br,this.subject=new We,this.subjectPublicKeyInfo=new kr,Object.assign(this,t)}}E([Ne({type:Lt.Integer,context:0,defaultValue:Er.v1})],_r.prototype,"version",void 0),E([Ne({type:Lt.Integer,converter:Qt})],_r.prototype,"serialNumber",void 0),E([Ne({type:Ar})],_r.prototype,"signature",void 0),E([Ne({type:We})],_r.prototype,"issuer",void 0),E([Ne({type:Br})],_r.prototype,"validity",void 0),E([Ne({type:We})],_r.prototype,"subject",void 0),E([Ne({type:kr})],_r.prototype,"subjectPublicKeyInfo",void 0),E([Ne({type:Lt.BitString,context:1,implicit:!0,optional:!0})],_r.prototype,"issuerUniqueID",void 0),E([Ne({type:Lt.BitString,context:2,implicit:!0,optional:!0})],_r.prototype,"subjectUniqueID",void 0),E([Ne({type:Nr,context:3,optional:!0,repeated:"sequence"})],_r.prototype,"extensions",void 0);class Ir{constructor(t={}){this.tbsCertificate=new _r,this.signatureAlgorithm=new Ar,this.signatureValue=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:_r})],Ir.prototype,"tbsCertificate",void 0),E([Ne({type:Ar})],Ir.prototype,"signatureAlgorithm",void 0),E([Ne({type:Lt.BitString})],Ir.prototype,"signatureValue",void 0);class Or{constructor(t={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Sr,Object.assign(this,t)}}E([Ne({type:Lt.Integer,converter:Qt})],Or.prototype,"userCertificate",void 0),E([Ne({type:Sr})],Or.prototype,"revocationDate",void 0),E([Ne({type:Nr,optional:!0,repeated:"sequence"})],Or.prototype,"crlEntryExtensions",void 0);class Cr{constructor(t={}){this.signature=new Ar,this.issuer=new We,this.thisUpdate=new Sr,Object.assign(this,t)}}E([Ne({type:Lt.Integer,optional:!0})],Cr.prototype,"version",void 0),E([Ne({type:Ar})],Cr.prototype,"signature",void 0),E([Ne({type:We})],Cr.prototype,"issuer",void 0),E([Ne({type:Sr})],Cr.prototype,"thisUpdate",void 0),E([Ne({type:Sr,optional:!0})],Cr.prototype,"nextUpdate",void 0),E([Ne({type:Or,repeated:"sequence",optional:!0})],Cr.prototype,"revokedCertificates",void 0),E([Ne({type:Nr,optional:!0,context:0,repeated:"sequence"})],Cr.prototype,"crlExtensions",void 0);class Rr{constructor(t={}){this.tbsCertList=new Cr,this.signatureAlgorithm=new Ar,this.signature=new ArrayBuffer(0),Object.assign(this,t)}}E([Ne({type:Cr})],Rr.prototype,"tbsCertList",void 0),E([Ne({type:Ar})],Rr.prototype,"signatureAlgorithm",void 0),E([Ne({type:Lt.BitString})],Rr.prototype,"signature",void 0);class Tr{constructor(...t){1===t.length?(this.asn=t[0],this.rawData=Ie.serialize(this.asn)):(this.asn=Ie.parse(t[0],t[1]),this.rawData=n.toArrayBuffer(t[0]))}}class jr extends Tr{constructor(t){switch(super(t,Nr),this.asn.extnID){case"2.5.29.15":this.value=Ee.parse(this.asn.extnValue,fr);break;default:this.value=this.asn.extnValue}}}class Dr extends Tr{constructor(t){super(t,Ir),this.parseExtensions()}parseExtensions(){const{tbsCertificate:t}=this.asn;t.extensions&&(this.extensions=t.extensions.map(t=>new jr(Ie.serialize(t))))}hasKeyUsage(t){if(!t||!t.length||!this.extensions.length)return!1;let e;for(let s=0;s<this.extensions.length;s+=1)if(this.extensions[s].value instanceof fr){e=this.extensions[s].value;break}if(!e)return!1;const r=e.toJSON(),i=[...t];for(let s=0;s<r.length&&i.length;s+=1){const t=i.indexOf(r[s]);-1!==t&&i.splice(t,1)}return!i.length}}!function(t){t.PROVIDERS_ADDED="providers:added",t.PROVIDERS_REMOVED="providers:removed",t.CLOSE="close",t.CONNECTION_PENDING="connection:pending",t.CONNECTION_RESOLVED="connection:resolved",t.CONNECTION_NOT_SUPPORTED="connection:not_supported",t.CONNECTION_REJECTED="connection:rejected",t.CHALLENGE_PENDING="challenge:pending",t.CHALLENGE_RESOLVED="challenge:resolved",t.CHALLENGE_REJECTED="challenge:rejected",t.DATA_CERTIFICATES_PENDING="data:certificates:pending",t.DATA_CERTIFICATES_RESOLVED="data:certificates:resolved",t.DATA_PROVIDERS_PENDING="data:providers:pending",t.DATA_PROVIDERS_RESOLVED="data:providers:resolved"}(Ur||(Ur={})),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value(t,e){return new Uint8Array(Array.prototype.slice.call(this,t,e))}});var Wr,Pr,Mr,Vr,$r,Fr=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},zr=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r};class Hr{constructor(t){Wr.set(this,void 0),Pr.set(this,void 0),Mr.set(this,function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var s=function(t){return function(e){return e.test(t)}}(r),n={apple:{phone:s(l)&&!s(v),ipod:s(f),tablet:!s(l)&&(s(d)||x(e))&&!s(v),universal:s(p),device:(s(l)||s(f)||s(d)||s(p)||x(e))&&!s(v)},amazon:{phone:s(g),tablet:!s(g)&&s(b),device:s(g)||s(b)},android:{phone:!s(v)&&s(g)||!s(v)&&s(y),tablet:!s(v)&&!s(g)&&!s(y)&&(s(b)||s(w)),device:!s(v)&&(s(g)||s(b)||s(y)||s(w))||s(/\bokhttp\b/i)},windows:{phone:s(v),tablet:s(m),device:s(v)||s(m)},other:{blackberry:s(A),blackberry10:s(k),opera:s(S),firefox:s(N),chrome:s(B),device:s(A)||s(k)||s(S)||s(N)||s(B)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}(window.navigator)),Vr.set(this,void 0),$r.set(this,""),this.options={logger:()=>{},filters:{}},t.logger&&(this.options.logger=t.logger),t.filters&&(this.options.filters=t.filters)}isConnectionSupported(){return!Fr(this,Mr).phone}getServer(){return Fr(this,Wr)}static async hasConnection(){try{return(await fetch("https://127.0.0.1:31337/.well-known/webcrypto-socket")).ok}catch(t){return!1}}async checkHasConnection(){return new Promise(t=>{const e=async()=>{await Hr.hasConnection()?t():zr(this,Vr,window.setTimeout(e,1e4))};e()})}async tryChallenge(){return await Fr(this,Wr).isLoggedIn()?null:Fr(this,Wr).challenge()}async login(){await Fr(this,Wr).login()}async connect(){if(await(async()=>{window.asmCrypto||(window.asmCrypto=await __sc_import_peculiar("./p-7660335d.js")),window.elliptic||(window.elliptic=(await __sc_import_peculiar("./p-4220f3e2.js")).default),await __sc_import_peculiar("./p-b47e72cc.js"),window.protobuf||await __sc_import_peculiar("./p-76e6ff9e.js"),window.WebcryptoSocket||await __sc_import_peculiar("./p-41e7be0b.js")})(),!Fr(this,Pr))try{zr(this,Pr,await WebcryptoSocket.BrowserStorage.create())}catch(t){zr(this,Pr,new WebcryptoSocket.MemoryStorage)}return new Promise((t,e)=>{Fr(this,Wr)&&t(),zr(this,Wr,new WebcryptoSocket.SocketProvider({storage:Fr(this,Pr)}).connect("127.0.0.1:31337").on("error",t=>{console.log(t),e()}).on("listening",async()=>{t()}).on("token",async t=>{t.added.length&&this.options.logger(Ur.PROVIDERS_ADDED,t.added),t.removed.length&&this.options.logger(Ur.PROVIDERS_REMOVED,t.removed)}).on("disconnect",()=>{console.log("disconnect")}).on("close",()=>{this.options.logger(Ur.CLOSE)}))})}disconnect(){Fr(this,Wr)&&(Fr(this,Wr).client.close(),zr(this,Wr,null)),Fr(this,Vr)&&(clearTimeout(Fr(this,Vr)),zr(this,Vr,null))}async start(){this.options.logger(Ur.CONNECTION_PENDING),this.isConnectionSupported()?(await Hr.hasConnection()||this.options.logger(Ur.CONNECTION_REJECTED),await this.checkHasConnection(),await this.connect(),await this.tryLogin()):this.options.logger(Ur.CONNECTION_NOT_SUPPORTED)}async tryLogin(){const t=await this.tryChallenge();if(t){zr(this,$r,t),this.options.logger(Ur.CHALLENGE_PENDING);try{await this.login(),zr(this,$r,void 0),this.options.logger(Ur.CHALLENGE_RESOLVED)}catch(e){return zr(this,$r,void 0),void this.options.logger(Ur.CHALLENGE_REJECTED)}}this.options.logger(Ur.CONNECTION_RESOLVED)}getChallenge(){return Fr(this,$r)}isProviderValid(t){const{filters:e}=this.options;return!(e&&e.onlyRemote&&!t.isRemovable)}async getProvidersInfo(){return(await Fr(this,Wr).info()).providers.filter(t=>this.isProviderValid(t))}async getProviderById(t){const e=await Fr(this,Wr).getCrypto(t);if(!(await e.isLoggedIn()))try{await e.login()}catch(r){return}return e}certificatePreFilter(t,e){if("x509"!==t.split("-")[0])return!1;return e.filter(e=>{const r=e.split("-");return"private"===r[0]&&r[2]===t.split("-")[2]})[0]||!1}async certificateFilter(t,e){const{filters:r}=this.options;if(!r.expired&&t.notAfter.getTime()<Date.now())return!1;if(r.subjectDNMatch){if("string"==typeof r.subjectDNMatch&&!t.subjectName.includes(r.subjectDNMatch))return!1;if(r.subjectDNMatch instanceof RegExp&&!r.subjectDNMatch.test(t.subjectName))return!1}if(r.issuerDNMatch){if("string"==typeof r.issuerDNMatch&&!t.issuerName.includes(r.issuerDNMatch))return!1;if(r.issuerDNMatch instanceof RegExp&&!r.issuerDNMatch.test(t.issuerName))return!1}if(r.keyUsage&&r.keyUsage.length){const r=await e.certStorage.exportCert("raw",t);if(!new Dr(r).hasKeyUsage(this.options.filters.keyUsage))return!1}return!0}async getCertificatesById(t){const e=await this.getProviderById(t);if(!e)return;const r=[],i=await e.keyStorage.keys(),s=await e.certStorage.keys();for(const o of s){const t=this.certificatePreFilter(o,i);if(!t)continue;let s;try{s=await e.certStorage.getItem(o)}catch(n){console.warn("Can't read certificate: "+o);continue}await this.certificateFilter(s,e)&&(s.id=o,s.subject=Hr.getSubjectIssuerValue(s.subjectName),s.issuer=Hr.getSubjectIssuerValue(s.issuerName),s.privateKeyId=t,r.push(s))}return r}async getCertificateBodyById(t,e){const r=await this.getProviderById(t);if(!r)return;const i=await r.certStorage.getItem(e),s=await r.certStorage.exportCert("raw",i);return c.ToBase64(s)}static getSubjectIssuerValue(t){const e={};return t.split(/, /g).forEach(t=>{const r=t.split("=");e[r[0]]=r[1]}),e}}Wr=new WeakMap,Pr=new WeakMap,Mr=new WeakMap,Vr=new WeakMap,$r=new WeakMap;var Jr,qr=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Lr{constructor(t){this.certificates=[],this.providers=[],Jr.set(this,void 0),function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,r)}(this,Jr,new Hr(t))}async start(){await qr(this,Jr).start()}async tryLogin(){await qr(this,Jr).tryLogin()}async getCertificateBodyById(t,e){return qr(this,Jr).getCertificateBodyById(t,e)}getServer(){return qr(this,Jr).getServer()}getChallenge(){return qr(this,Jr).getChallenge()}finish(){qr(this,Jr).disconnect(),this.certificates=[],this.providers=[]}selectCertificate(t){this.certificates=this.certificates.map(e=>{let r=!1;return e.id===t&&(r=!0),Object.assign(e,{selected:r}),e})}getSelectedCertificate(){return this.certificates.find(t=>t.selected)}async dataCertificates(){if(this.certificates=[],0!==this.providers.length){qr(this,Jr).options.logger(Ur.DATA_CERTIFICATES_PENDING);for(const t of this.providers){const e=await qr(this,Jr).getCertificatesById(t.id);e&&this.certificates.push(...e)}qr(this,Jr).options.logger(Ur.DATA_CERTIFICATES_RESOLVED)}}async dataProviders(){qr(this,Jr).options.logger(Ur.DATA_PROVIDERS_PENDING),this.providers=await qr(this,Jr).getProvidersInfo(),qr(this,Jr).options.logger(Ur.DATA_PROVIDERS_RESOLVED)}}Jr=new WeakMap;var Gr,Zr=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const Kr=class{constructor(r){t(this,r),Gr.set(this,void 0),this.filters={},this.action=Ur.CONNECTION_PENDING,this.tick=0,this.onLog=async(t,e)=>{this.debug&&console.log({type:t,body:e}),t!==Ur.PROVIDERS_ADDED&&t!==Ur.PROVIDERS_REMOVED?(this.action=t,t===Ur.CONNECTION_RESOLVED&&Zr(this,Gr).dataProviders(),t===Ur.DATA_PROVIDERS_RESOLVED&&Zr(this,Gr).dataCertificates()):await Zr(this,Gr).dataProviders()},this.onClickCancel=()=>{this.cancel.emit()},this.onClickContinue=()=>{const t=Zr(this,Gr).getSelectedCertificate();t&&this.continue.emit({certificateId:t.id,providerId:t.providerID,server:Zr(this,Gr).getServer(),privateKeyId:t.privateKeyId})},this.onClickUpdateCertificates=()=>{Zr(this,Gr).dataCertificates()},this.onClickTryAgain=()=>{Zr(this,Gr).tryLogin()},this.onClickCloseDetails=()=>{this.certificateBase64ForDetails=null},this.onClickCertificate=t=>{Zr(this,Gr).selectCertificate(t),this.tick+=1},this.onClickCertificateDetails=(t,e)=>{Zr(this,Gr).getCertificateBodyById(t,e).then(t=>{this.certificateBase64ForDetails=t})},this.cancel=e(this,"cancel",7),this.continue=e(this,"continue",7)}componentWillLoad(){h.setLocale(this.language)}async componentDidLoad(){(function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,r)})(this,Gr,new Lr({logger:this.onLog,filters:this.filters})),await Zr(this,Gr).start()}componentDidUnload(){Zr(this,Gr).finish()}static renderConnecting(){return r("peculiar-fortify-connecting",null)}static renderFortifyAuthorization(t){return r("peculiar-fortify-authorization",{pin:t})}static renderFortifyNotDetected(){return r("peculiar-fortify-not-detected",null)}static renderFortifyNotSupported(){return r("peculiar-fortify-not-supported",null)}renderChallengeNotApproved(){return r("peculiar-fortify-challenge-not-approved",{onCancel:this.onClickCancel,onTryAgain:this.onClickTryAgain})}renderCertificates(){const t=this.action===Ur.DATA_CERTIFICATES_PENDING;let e;return t||(e=Zr(this,Gr).getSelectedCertificate()),r("peculiar-fortify-certificates-list",{certificates:Zr(this,Gr).certificates,onCertificate:this.onClickCertificate,onCertificateDetails:this.onClickCertificateDetails,onUpdate:this.onClickUpdateCertificates,onCancel:this.onClickCancel,onContinue:this.onClickContinue,loading:t,allowContinue:e})}renderProvidersEmpty(){return r("peculiar-fortify-providers-empty",{onCancel:this.onClickCancel})}renderUnresolvedStatus(){return r("peculiar-fortify-layout",{type:"message",titleValue:"Someting went wrong for status",descriptionValue:this.action})}render(){let t=null;switch(this.action){case Ur.CONNECTION_PENDING:case Ur.CONNECTION_RESOLVED:case Ur.DATA_PROVIDERS_PENDING:t=Kr.renderConnecting();break;case Ur.CONNECTION_REJECTED:case Ur.CLOSE:t=Kr.renderFortifyNotDetected(),this.certificateBase64ForDetails=null;break;case Ur.CONNECTION_NOT_SUPPORTED:t=Kr.renderFortifyNotSupported();break;case Ur.CHALLENGE_PENDING:t=Kr.renderFortifyAuthorization(Zr(this,Gr).getChallenge());break;case Ur.CHALLENGE_REJECTED:t=this.renderChallengeNotApproved();break;case Ur.DATA_PROVIDERS_RESOLVED:0===Zr(this,Gr).providers.length&&(t=this.renderProvidersEmpty());break;case Ur.DATA_CERTIFICATES_PENDING:case Ur.DATA_CERTIFICATES_RESOLVED:t=this.renderCertificates();break;default:t=this.renderUnresolvedStatus()}return this.action===Ur.DATA_PROVIDERS_PENDING&&Zr(this,Gr).providers.length&&(t=this.renderCertificates()),r(s,null,r("peculiar-fortify-layout",null,this.certificateBase64ForDetails&&r("div",{class:"container_details peculiar_fill_light"},r("header",{class:"container_details_header peculiar_stroke_grey_3"},r("peculiar-fortify-typography",{type:"h4",align:"center",ellipsis:!0},u("details.title")),r("peculiar-fortify-button",{class:"container_details_button",onClick:this.onClickCloseDetails,"aria-label":"Close details",size:"small"},r("img",{slot:"icon",src:i("../assets/back_icon.svg"),alt:"Back"}),u("actions.back"))),r("div",{class:"container_details_content"},r("peculiar-certificate-viewer",{certificate:this.certificateBase64ForDetails,view:"mobile"}))),t))}static get assetsDirs(){return["../../assets"]}};Gr=new WeakMap,Kr.style="*{-webkit-box-sizing:border-box;box-sizing:border-box}.peculiar_stroke_dark{border-color:#40484f;border-color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_fill_dark{background-color:#40484f;background-color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_color_dark{color:#40484f;color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_stroke_light{border-color:#ffffff;border-color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_fill_light{background-color:#ffffff;background-color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_color_light{color:#ffffff;color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_stroke_grey_1{border-color:#FAF9F9;border-color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_fill_grey_1{background-color:#FAF9F9;background-color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_color_grey_1{color:#FAF9F9;color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_stroke_grey_2{border-color:#EEF4F7;border-color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_fill_grey_2{background-color:#EEF4F7;background-color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_color_grey_2{color:#EEF4F7;color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_stroke_grey_3{border-color:#E1E4E6;border-color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_fill_grey_3{background-color:#E1E4E6;background-color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_color_grey_3{color:#E1E4E6;color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_stroke_grey_4{border-color:#b6c3cc;border-color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_fill_grey_4{background-color:#b6c3cc;background-color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_color_grey_4{color:#b6c3cc;color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_stroke_grey_5{border-color:#6d7d87;border-color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_fill_grey_5{background-color:#6d7d87;background-color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_color_grey_5{color:#6d7d87;color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_stroke_secondary{border-color:#0abe65;border-color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_fill_secondary{background-color:#0abe65;background-color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_color_secondary{color:#0abe65;color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_stroke_primary{border-color:#0680ff;border-color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_fill_primary{background-color:#0680ff;background-color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_color_primary{color:#0680ff;color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_stroke_attention{border-color:#F7A831;border-color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_fill_attention{background-color:#F7A831;background-color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_color_attention{color:#F7A831;color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_h4{font-size:17px;line-height:1.4;font-weight:600;letter-spacing:0.188889px}.peculiar_h6{font-size:15px;line-height:20px;font-weight:600;letter-spacing:0.3px}.peculiar_h7{font-size:14px;line-height:1.35;font-weight:600;letter-spacing:0px}.peculiar_b1{font-size:15px;line-height:1.46;font-weight:400;letter-spacing:0.3px}.peculiar_b3{font-size:13px;line-height:1.5;font-weight:400;letter-spacing:0.03em}.peculiar_c1{font-size:11px;line-height:1.36;font-weight:400;letter-spacing:0.03em}peculiar-fortify-button+peculiar-fortify-button{margin-left:10px}:host{display:block}.container_details{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1}.container_details_header{border-bottom-width:1px;border-bottom-style:solid;padding:10px 100px;position:relative;height:45px}.container_details_button{position:absolute;top:50%;left:8px;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.container_details_content{height:calc(100% - 45px);overflow:auto}";export{Kr as peculiar_fortify_certificates}