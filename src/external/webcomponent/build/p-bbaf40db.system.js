var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function a(e){try{s(n.next(e))}catch(t){o(t)}}function u(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):i(e.value).then(a,u)}s((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(e){return function(t){return s([e,t])}}function s(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(u){a=[6,u];i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],a=0,u=o.length;a<u;a++,i++)n[i]=o[a];return n};System.register([],(function(){"use strict";return{execute:function(){var e=function(e,t,r){function n(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t)n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};if(t%2){i(Object(r),true).forEach((function(t){n(e,t,r[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(r))}else{i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}}return e}var a={};if(typeof self!=="undefined"){a=self}e.nativeCrypto=a["msCrypto"]||a.crypto||{};e.nativeSubtle=null;try{e.nativeSubtle=(e.nativeCrypto===null||e.nativeCrypto===void 0?void 0:e.nativeCrypto.subtle)||(e.nativeCrypto===null||e.nativeCrypto===void 0?void 0:e.nativeCrypto["webkitSubtle"])||null}catch(ro){console.warn("Cannot get subtle from crypto",ro)}function u(t){e.nativeCrypto=t;e.nativeSubtle=t.subtle}function s(e){if(typeof Buffer!=="undefined"&&Buffer.isBuffer(e)){return new Uint8Array(e)}else if(ArrayBuffer.isView(e)){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{return new Uint8Array(e)}}var c=function(){function e(){}e.ToString=function(e,t){if(t===void 0){t="utf8"}var r=s(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new Error("Unknown type of encoding '"+t+"'")}};e.FromString=function(e,t){if(t===void 0){t="utf8"}switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new Error("Unknown type of encoding '"+t+"'")}};e.ToBase64=function(e){var t=s(e);if(typeof btoa!=="undefined"){var r=this.ToString(t,"binary");return btoa(r)}else{return Buffer.from(t).toString("base64")}};e.FromBase64=function(e){e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,"");if(typeof atob!=="undefined"){return this.FromBinary(atob(e))}else{return new Uint8Array(Buffer.from(e,"base64")).buffer}};e.FromBase64Url=function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))};e.ToBase64Url=function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")};e.FromUtf8String=function(e){var t=unescape(encodeURIComponent(e));var r=new Uint8Array(t.length);for(var n=0;n<t.length;n++){r[n]=t.charCodeAt(n)}return r.buffer};e.ToUtf8String=function(e){var t=s(e);var r=String.fromCharCode.apply(null,t);var n=decodeURIComponent(escape(r));return n};e.FromBinary=function(e){var t=e.length;var r=new Uint8Array(t);for(var n=0;n<t;n++){r[n]=e.charCodeAt(n)}return r.buffer};e.ToBinary=function(e){var t=s(e);var r="";var n=t.length;for(var i=0;i<n;i++){r=r+String.fromCharCode(t[i])}return r};e.ToHex=function(e){var t=s(e);var r="";var n=[];var i=t.length;for(var o=0;o<i;o++){var a=t[o].toString(16);n.push(a.length===1?"0"+a:a)}return n.join(r)};e.FromHex=function(e){var t=new Uint8Array(e.length/2);for(var r=0;r<e.length;r=r+2){var n=e.slice(r,r+2);t[r/2]=parseInt(n,16)}return t.buffer};e.Base64Padding=function(e){var t=4-e.length%4;if(t<4){for(var r=0;r<t;r++){e+="="}}return e};return e}();var f=function(){function e(){}e.toArrayBuffer=function(e){var t=this.toUint8Array(e);if(t.byteOffset||t.length){return t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}return t.buffer};e.toUint8Array=function(e){if(typeof Buffer!=="undefined"&&Buffer.isBuffer(e)){return new Uint8Array(e)}if(ArrayBuffer.isView(e)){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(e instanceof ArrayBuffer){return new Uint8Array(e)}throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")};e.isBufferSource=function(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer};return e}();function l(e,t,r,n){var i=arguments.length,o=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)if(a=e[u])o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o;return i>3&&o&&Object.defineProperty(t,r,o),o}function h(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function a(e){try{s(n.next(e))}catch(t){o(t)}}function u(e){try{s(n["throw"](e))}catch(t){o(t)}}function s(e){e.done?r(e.value):i(e.value).then(a,u)}s((n=n.apply(e,t||[])).next())}))}function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function p(e,t){return t={exports:{}},e(t,t.exports),t.exports}function y(e){return new Date(e.getTime()+e.getTimezoneOffset()*6e4)}function g(e,t,r){if(e instanceof Object===false)return r;if(t in e)return e[t];return r}function d(e,t,r,n){if(t===void 0){t=0}if(r===void 0){r=e.byteLength-t}if(n===void 0){n=false}var i="";for(var o=0,a=new Uint8Array(e,t,r);o<a.length;o++){var u=a[o];var s=u.toString(16).toUpperCase();if(s.length===1)i+="0";i+=s;if(n)i+=" "}return i.trim()}function m(e,t,r,n){if(t instanceof ArrayBuffer===false){e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"';return false}if(t.byteLength===0){e.error="Wrong parameter: inputBuffer has zero length";return false}if(r<0){e.error="Wrong parameter: inputOffset less than zero";return false}if(n<0){e.error="Wrong parameter: inputLength less than zero";return false}if(t.byteLength-r-n<0){e.error="End of input reached before message was fully decoded (inconsistent offset and length values)";return false}return true}function w(e,t){var r=0;if(e.length===1)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function b(e,t,r){if(r===void 0){r=-1}var n=r;var i=e;var o=0;var a=Math.pow(2,t);for(var u=1;u<8;u++){if(e<a){var s=void 0;if(n<0){s=new ArrayBuffer(u);o=u}else{if(n<u)return new ArrayBuffer(0);s=new ArrayBuffer(n);o=n}var c=new Uint8Array(s);for(var f=u-1;f>=0;f--){var l=Math.pow(2,f*t);c[o-f-1]=Math.floor(i/l);i-=c[o-f-1]*l}return s}a*=Math.pow(2,t)}return new ArrayBuffer(0)}function k(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=0;var n=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];r+=a.byteLength}var u=new ArrayBuffer(r);var s=new Uint8Array(u);for(var c=0,f=e;c<f.length;c++){var a=f[c];s.set(new Uint8Array(a),n);n+=a.byteLength}return u}function B(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=0;var n=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];r+=a.length}var u=new ArrayBuffer(r);var s=new Uint8Array(u);for(var c=0,f=e;c<f.length;c++){var a=f[c];s.set(a,n);n+=a.length}return s}function A(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=e[0]===255&&e[1]&128;var r=e[0]===0&&(e[1]&128)===0;if(t||r)this.warnings.push("Needlessly long format")}var n=new ArrayBuffer(this.valueHex.byteLength);var i=new Uint8Array(n);for(var o=0;o<this.valueHex.byteLength;o++)i[o]=0;i[0]=e[0]&128;var a=w(i,8);var u=new ArrayBuffer(this.valueHex.byteLength);var s=new Uint8Array(u);for(var c=0;c<this.valueHex.byteLength;c++)s[c]=e[c];s[0]&=127;var f=w(s,8);return f-a}function S(e){var t=e<0?e*-1:e;var r=128;for(var n=1;n<8;n++){if(t<=r){if(e<0){var i=r-t;var o=b(i,8,n);var a=new Uint8Array(o);a[0]|=128;return o}var u=b(t,8,n);var s=new Uint8Array(u);if(s[0]&128){var c=u.slice(0);var f=new Uint8Array(c);u=new ArrayBuffer(u.byteLength+1);s=new Uint8Array(u);for(var l=0;l<c.byteLength;l++)s[l+1]=f[l];s[0]=0}return u}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function _(e,t){if(e.byteLength!==t.byteLength)return false;var r=new Uint8Array(e);var n=new Uint8Array(t);for(var i=0;i<r.length;i++){if(r[i]!==n[i])return false}return true}function x(e,t){var r=e.toString(10);if(t<r.length)return"";var n=t-r.length;var i=new Array(n);for(var o=0;o<n;o++)i[o]="0";var a=i.join("");return a.concat(r)}var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function E(e,t,r,n){if(t===void 0){t=false}if(r===void 0){r=false}if(n===void 0){n=false}var i=0;var o=0;var a=0;var u="";var s=t?N:C;if(n){var c=0;for(var f=0;f<e.length;f++){if(e.charCodeAt(f)!==0){c=f;break}}e=e.slice(c)}while(i<e.length){var l=e.charCodeAt(i++);if(i>=e.length)o=1;var h=e.charCodeAt(i++);if(i>=e.length)a=1;var v=e.charCodeAt(i++);var p=l>>2;var y=(l&3)<<4|h>>4;var g=(h&15)<<2|v>>6;var d=v&63;if(o===1){g=d=64}else{if(a===1){d=64}}if(r){if(g===64)u+=""+s.charAt(p)+s.charAt(y);else{if(d===64)u+=""+s.charAt(p)+s.charAt(y)+s.charAt(g);else u+=""+s.charAt(p)+s.charAt(y)+s.charAt(g)+s.charAt(d)}}else u+=""+s.charAt(p)+s.charAt(y)+s.charAt(g)+s.charAt(d)}return u}function K(e,t,r){if(t===void 0){t=false}if(r===void 0){r=false}var n=t?N:C;function i(e){for(var t=0;t<64;t++){if(n.charAt(t)===e)return t}return 64}function o(e){return e===64?0:e}var a=0;var u="";while(a<e.length){var s=i(e.charAt(a++));var c=a>=e.length?0:i(e.charAt(a++));var f=a>=e.length?0:i(e.charAt(a++));var l=a>=e.length?0:i(e.charAt(a++));var h=o(s)<<2|o(c)>>4;var v=(o(c)&15)<<4|o(f)>>2;var p=(o(f)&3)<<6|o(l);u+=String.fromCharCode(h);if(f!==64)u+=String.fromCharCode(v);if(l!==64)u+=String.fromCharCode(p)}if(r){var y=u.length;var g=-1;for(var d=y-1;d>=0;d--){if(u.charCodeAt(d)!==0){g=d;break}}if(g!==-1)u=u.slice(0,g+1);else u=""}return u}function U(e){var t="";var r=new Uint8Array(e);for(var n=0,i=r;n<i.length;n++){var o=i[n];t+=String.fromCharCode(o)}return t}function O(e){var t=e.length;var r=new ArrayBuffer(t);var n=new Uint8Array(r);for(var i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}var H=Math.log(2);function L(e){var t=Math.log(e)/H;var r=Math.floor(t);var n=Math.round(t);return r===n?r:n}function P(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];delete e[i]}}var I=Object.freeze({__proto__:null,getUTCDate:y,getParametersValue:g,bufferToHexCodes:d,checkBufferParams:m,utilFromBase:w,utilToBase:b,utilConcatBuf:k,utilConcatView:B,utilDecodeTC:A,utilEncodeTC:S,isEqualBuffer:_,padNumber:x,toBase64:E,fromBase64:K,arrayBufferToString:U,stringToArrayBuffer:O,nearestPowerOf2:L,clearProps:P});var T=p((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.fromBER=fe;t.compareSchema=le;t.verifySchema=he;t.fromJSON=ve;t.RawData=t.Repeated=t.Any=t.Choice=t.TIME=t.Duration=t.DateTime=t.TimeOfDay=t.DATE=t.GeneralizedTime=t.UTCTime=t.CharacterString=t.GeneralString=t.VisibleString=t.GraphicString=t.IA5String=t.VideotexString=t.TeletexString=t.PrintableString=t.NumericString=t.UniversalString=t.BmpString=t.RelativeObjectIdentifier=t.Utf8String=t.ObjectIdentifier=t.Enumerated=t.Integer=t.BitString=t.OctetString=t.Null=t.Set=t.Sequence=t.Boolean=t.EndOfContent=t.Constructed=t.Primitive=t.BaseBlock=t.ValueBlock=t.HexBlock=void 0;var r=[new Uint8Array([1])];var n="0123456789";var i=function(){function e(e){if(e===void 0){e={}}this.blockLength=(0,I.getParametersValue)(e,"blockLength",0);this.error=(0,I.getParametersValue)(e,"error","");this.warnings=(0,I.getParametersValue)(e,"warnings",[]);if("valueBeforeDecode"in e)this.valueBeforeDecode=e.valueBeforeDecode.slice(0);else this.valueBeforeDecode=new ArrayBuffer(0)}e.blockName=function(){return"baseBlock"};e.prototype.toJSON=function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:(0,I.bufferToHexCodes)(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}};return e}();var o=function(e){return function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.isHexOnly=(0,I.getParametersValue)(t,"isHexOnly",false);if("valueHex"in t)r.valueHex=t.valueHex.slice(0);else r.valueHex=new ArrayBuffer(0);return r}t.blockName=function(){return"hexBlock"};t.prototype.fromBER=function(e,t,r){if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);if(n.length===0){this.warnings.push("Zero buffer length");return t}this.valueHex=e.slice(t,t+r);this.blockLength=r;return t+r};t.prototype.toBER=function(e){if(e===void 0){e=false}if(this.isHexOnly!==true){this.error='Flag "isHexOnly" is not set, abort';return new ArrayBuffer(0)}if(e===true)return new ArrayBuffer(this.valueHex.byteLength);return this.valueHex.slice(0)};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.blockName=this.constructor.blockName();t.isHexOnly=this.isHexOnly;t.valueHex=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);return t};return t}(e)};t.HexBlock=o;var a=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this)||this;if("idBlock"in t){r.isHexOnly=(0,I.getParametersValue)(t.idBlock,"isHexOnly",false);r.valueHex=(0,I.getParametersValue)(t.idBlock,"valueHex",new ArrayBuffer(0));r.tagClass=(0,I.getParametersValue)(t.idBlock,"tagClass",-1);r.tagNumber=(0,I.getParametersValue)(t.idBlock,"tagNumber",-1);r.isConstructed=(0,I.getParametersValue)(t.idBlock,"isConstructed",false)}else{r.tagClass=-1;r.tagNumber=-1;r.isConstructed=false}return r}t.blockName=function(){return"identificationBlock"};t.prototype.toBER=function(e){if(e===void 0){e=false}var t=0;var r;var n;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:this.error="Unknown tag class";return new ArrayBuffer(0)}if(this.isConstructed)t|=32;if(this.tagNumber<31&&!this.isHexOnly){r=new ArrayBuffer(1);n=new Uint8Array(r);if(!e){var i=this.tagNumber;i&=31;t|=i;n[0]=t}return r}if(this.isHexOnly===false){var o=(0,I.utilToBase)(this.tagNumber,7);var a=new Uint8Array(o);var u=o.byteLength;r=new ArrayBuffer(u+1);n=new Uint8Array(r);n[0]=t|31;if(!e){for(var s=0;s<u-1;s++)n[s+1]=a[s]|128;n[u]=a[u-1]}return r}r=new ArrayBuffer(this.valueHex.byteLength+1);n=new Uint8Array(r);n[0]=t|31;if(e===false){var c=new Uint8Array(this.valueHex);for(var s=0;s<c.length-1;s++)n[s+1]=c[s]|128;n[this.valueHex.byteLength]=c[c.length-1]}return r};t.prototype.fromBER=function(e,t,r){if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);if(n.length===0){this.error="Zero buffer length";return-1}var i=n[0]&192;switch(i){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:this.error="Unknown tag class";return-1}this.isConstructed=(n[0]&32)===32;this.isHexOnly=false;var o=n[0]&31;if(o!==31){this.tagNumber=o;this.blockLength=1}else{var a=1;this.valueHex=new ArrayBuffer(255);var u=255;var s=new Uint8Array(this.valueHex);while(n[a]&128){s[a-1]=n[a]&127;a++;if(a>=n.length){this.error="End of input reached before message was fully decoded";return-1}if(a===u){u+=255;var c=new ArrayBuffer(u);var f=new Uint8Array(c);for(var l=0;l<s.length;l++)f[l]=s[l];this.valueHex=new ArrayBuffer(u);s=new Uint8Array(this.valueHex)}}this.blockLength=a+1;s[a-1]=n[a]&127;var h=new ArrayBuffer(a);var v=new Uint8Array(h);for(var l=0;l<a;l++)v[l]=s[l];this.valueHex=new ArrayBuffer(a);s=new Uint8Array(this.valueHex);s.set(v);if(this.blockLength<=9)this.tagNumber=(0,I.utilFromBase)(s,7);else{this.isHexOnly=true;this.warnings.push("Tag too long, represented as hex-coded")}}if(this.tagClass===1&&this.isConstructed){switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:this.error="Constructed encoding used for primitive type";return-1}}return t+this.blockLength};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.blockName=this.constructor.blockName();t.tagClass=this.tagClass;t.tagNumber=this.tagNumber;t.isConstructed=this.isConstructed;return t};return t}(o(i));var u=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this)||this;if("lenBlock"in t){r.isIndefiniteForm=(0,I.getParametersValue)(t.lenBlock,"isIndefiniteForm",false);r.longFormUsed=(0,I.getParametersValue)(t.lenBlock,"longFormUsed",false);r.length=(0,I.getParametersValue)(t.lenBlock,"length",0)}else{r.isIndefiniteForm=false;r.longFormUsed=false;r.length=0}return r}t.blockName=function(){return"lengthBlock"};t.prototype.fromBER=function(e,t,r){if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);if(n.length===0){this.error="Zero buffer length";return-1}if(n[0]===255){this.error="Length block 0xFF is reserved by standard";return-1}this.isIndefiniteForm=n[0]===128;if(this.isIndefiniteForm===true){this.blockLength=1;return t+this.blockLength}this.longFormUsed=!!(n[0]&128);if(this.longFormUsed===false){this.length=n[0];this.blockLength=1;return t+this.blockLength}var i=n[0]&127;if(i>8){this.error="Too big integer";return-1}if(i+1>n.length){this.error="End of input reached before message was fully decoded";return-1}var o=new Uint8Array(i);for(var a=0;a<i;a++)o[a]=n[a+1];if(o[i-1]===0)this.warnings.push("Needlessly long encoded length");this.length=(0,I.utilFromBase)(o,8);if(this.longFormUsed&&this.length<=127)this.warnings.push("Unneccesary usage of long length form");this.blockLength=i+1;return t+this.blockLength};t.prototype.toBER=function(e){if(e===void 0){e=false}var t;var r;if(this.length>127)this.longFormUsed=true;if(this.isIndefiniteForm){t=new ArrayBuffer(1);if(e===false){r=new Uint8Array(t);r[0]=128}return t}if(this.longFormUsed===true){var n=(0,I.utilToBase)(this.length,8);if(n.byteLength>127){this.error="Too big length";return new ArrayBuffer(0)}t=new ArrayBuffer(n.byteLength+1);if(e===true)return t;var i=new Uint8Array(n);r=new Uint8Array(t);r[0]=n.byteLength|128;for(var o=0;o<n.byteLength;o++)r[o+1]=i[o];return t}t=new ArrayBuffer(1);if(e===false){r=new Uint8Array(t);r[0]=this.length}return t};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.blockName=this.constructor.blockName();t.isIndefiniteForm=this.isIndefiniteForm;t.longFormUsed=this.longFormUsed;t.length=this.length;return t};return t}(i);var s=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}return e.call(this,t)||this}t.blockName=function(){return"valueBlock"};t.prototype.fromBER=function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')};t.prototype.toBER=function(e){if(e===void 0){e=false}throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')};return t}(i);t.ValueBlock=s;var c=function(e){__extends(t,e);function t(t,r){if(t===void 0){t={}}if(r===void 0){r=s}var n=e.call(this,t)||this;if("name"in t)n.name=t.name;if("optional"in t)n.optional=t.optional;if("primitiveSchema"in t)n.primitiveSchema=t.primitiveSchema;n.idBlock=new a(t);n.lenBlock=new u(t);n.valueBlock=new r(t);return n}t.blockName=function(){return"BaseBlock"};t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.toBER=function(e){if(e===void 0){e=false}var t;var r=this.idBlock.toBER(e);var n=this.valueBlock.toBER(true);this.lenBlock.length=n.byteLength;var i=this.lenBlock.toBER(e);t=(0,I.utilConcatBuf)(r,i);var o;if(e===false)o=this.valueBlock.toBER(e);else o=new ArrayBuffer(this.lenBlock.length);t=(0,I.utilConcatBuf)(t,o);if(this.lenBlock.isIndefiniteForm===true){var a=new ArrayBuffer(2);if(e===false){var u=new Uint8Array(a);u[0]=0;u[1]=0}t=(0,I.utilConcatBuf)(t,a)}return t};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.idBlock=this.idBlock.toJSON();t.lenBlock=this.lenBlock.toJSON();t.valueBlock=this.valueBlock.toJSON();if("name"in this)t.name=this.name;if("optional"in this)t.optional=this.optional;if("primitiveSchema"in this)t.primitiveSchema=this.primitiveSchema.toJSON();return t};return t}(i);t.BaseBlock=c;var f=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;if("valueHex"in t)r.valueHex=t.valueHex.slice(0);else r.valueHex=new ArrayBuffer(0);r.isHexOnly=(0,I.getParametersValue)(t,"isHexOnly",true);return r}t.prototype.fromBER=function(e,t,r){if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);if(n.length===0){this.warnings.push("Zero buffer length");return t}this.valueHex=new ArrayBuffer(n.length);var i=new Uint8Array(this.valueHex);for(var o=0;o<n.length;o++)i[o]=n[o];this.blockLength=r;return t+r};t.prototype.toBER=function(e){if(e===void 0){e=false}return this.valueHex.slice(0)};t.blockName=function(){return"PrimitiveValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.valueHex=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);t.isHexOnly=this.isHexOnly;return t};return t}(s);var l=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,f)||this;r.idBlock.isConstructed=false;return r}t.blockName=function(){return"PRIMITIVE"};return t}(c);t.Primitive=l;var h=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.value=(0,I.getParametersValue)(t,"value",[]);r.isIndefiniteForm=(0,I.getParametersValue)(t,"isIndefiniteForm",false);return r}t.prototype.fromBER=function(e,t,r){var n=t;var i=r;if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var o=new Uint8Array(e,t,r);if(o.length===0){this.warnings.push("Zero buffer length");return t}function a(e,t){if(e===true)return 1;return t}var u=t;while(a(this.isIndefiniteForm,r)>0){var s=ce(e,u,r);if(s.offset===-1){this.error=s.result.error;this.warnings.concat(s.result.warnings);return-1}u=s.offset;this.blockLength+=s.result.blockLength;r-=s.result.blockLength;this.value.push(s.result);if(this.isIndefiniteForm===true&&s.result.constructor.blockName()===y.blockName())break}if(this.isIndefiniteForm===true){if(this.value[this.value.length-1].constructor.blockName()===y.blockName())this.value.pop();else this.warnings.push("No EndOfContent block encoded")}this.valueBeforeDecode=e.slice(n,n+i);return u};t.prototype.toBER=function(e){if(e===void 0){e=false}var t=new ArrayBuffer(0);for(var r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);t=(0,I.utilConcatBuf)(t,n)}return t};t.blockName=function(){return"ConstructedValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(n){}t.isIndefiniteForm=this.isIndefiniteForm;t.value=[];for(var r=0;r<this.value.length;r++)t.value.push(this.value[r].toJSON());return t};return t}(s);var v=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,h)||this;r.idBlock.isConstructed=true;return r}t.blockName=function(){return"CONSTRUCTED"};t.prototype.fromBER=function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};return t}(c);t.Constructed=v;var p=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}return e.call(this,t)||this}t.prototype.fromBER=function(e,t,r){return t};t.prototype.toBER=function(e){if(e===void 0){e=false}return new ArrayBuffer(0)};t.blockName=function(){return"EndOfContentValueBlock"};return t}(s);var y=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,p)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=0;return r}t.blockName=function(){return"EndOfContent"};return t}(c);t.EndOfContent=y;var g=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.value=(0,I.getParametersValue)(t,"value",false);r.isHexOnly=(0,I.getParametersValue)(t,"isHexOnly",false);if("valueHex"in t)r.valueHex=t.valueHex.slice(0);else{r.valueHex=new ArrayBuffer(1);if(r.value===true){var n=new Uint8Array(r.valueHex);n[0]=255}}return r}t.prototype.fromBER=function(e,t,r){if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);if(r>1)this.warnings.push("Boolean value encoded in more then 1 octet");this.isHexOnly=true;this.valueHex=new ArrayBuffer(n.length);var i=new Uint8Array(this.valueHex);for(var o=0;o<n.length;o++)i[o]=n[o];if(I.utilDecodeTC.call(this)!==0)this.value=true;else this.value=false;this.blockLength=r;return t+r};t.prototype.toBER=function(e){if(e===void 0){e=false}return this.valueHex};t.blockName=function(){return"BooleanValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.value=this.value;t.isHexOnly=this.isHexOnly;t.valueHex=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);return t};return t}(s);var d=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,g)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=1;return r}t.blockName=function(){return"Boolean"};return t}(c);t.Boolean=d;var m=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=16;return r}t.blockName=function(){return"Sequence"};return t}(v);t.Sequence=m;var w=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=17;return r}t.blockName=function(){return"Set"};return t}(v);t.Set=w;var b=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,i)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=5;return r}t.blockName=function(){return"Null"};t.prototype.fromBER=function(e,t,r){if(this.lenBlock.length>0)this.warnings.push("Non-zero length of value block for Null type");if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;this.blockLength+=r;if(t+r>e.byteLength){this.error="End of input reached before message was fully decoded (inconsistent offset and length values)";return-1}return t+r};t.prototype.toBER=function(e){if(e===void 0){e=false}var t=new ArrayBuffer(2);if(e===true)return t;var r=new Uint8Array(t);r[0]=5;r[1]=0;return t};return t}(c);t.Null=b;var k=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.isConstructed=(0,I.getParametersValue)(t,"isConstructed",false);return r}t.prototype.fromBER=function(t,r,n){var i=0;if(this.isConstructed===true){this.isHexOnly=false;i=h.prototype.fromBER.call(this,t,r,n);if(i===-1)return i;for(var o=0;o<this.value.length;o++){var a=this.value[o].constructor.blockName();if(a===y.blockName()){if(this.isIndefiniteForm===true)break;else{this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only";return-1}}if(a!==B.blockName()){this.error="OCTET STRING may consists of OCTET STRINGs only";return-1}}}else{this.isHexOnly=true;i=e.prototype.fromBER.call(this,t,r,n);this.blockLength=n}return i};t.prototype.toBER=function(e){if(e===void 0){e=false}if(this.isConstructed===true)return h.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);if(e===true)return t;if(this.valueHex.byteLength===0)return t;t=this.valueHex.slice(0);return t};t.blockName=function(){return"OctetStringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.isConstructed=this.isConstructed;t.isHexOnly=this.isHexOnly;t.valueHex=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);return t};return t}(o(h));var B=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,k)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=4;return r}t.prototype.fromBER=function(t,r,n){this.valueBlock.isConstructed=this.idBlock.isConstructed;this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;if(n===0){if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;return r}return e.prototype.fromBER.call(this,t,r,n)};t.blockName=function(){return"OctetString"};t.prototype.isEqual=function(e){if(e instanceof t===false)return false;if(JSON.stringify(this)!==JSON.stringify(e))return false;return true};return t}(c);t.OctetString=B;var A=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.unusedBits=(0,I.getParametersValue)(t,"unusedBits",0);r.isConstructed=(0,I.getParametersValue)(t,"isConstructed",false);r.blockLength=r.valueHex.byteLength;return r}t.prototype.fromBER=function(e,t,r){if(r===0)return t;var n=-1;if(this.isConstructed===true){n=h.prototype.fromBER.call(this,e,t,r);if(n===-1)return n;for(var i=0;i<this.value.length;i++){var o=this.value[i].constructor.blockName();if(o===y.blockName()){if(this.isIndefiniteForm===true)break;else{this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only";return-1}}if(o!==S.blockName()){this.error="BIT STRING may consists of BIT STRINGs only";return-1}if(this.unusedBits>0&&this.value[i].valueBlock.unusedBits>0){this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only';return-1}this.unusedBits=this.value[i].valueBlock.unusedBits;if(this.unusedBits>7){this.error="Unused bits for BitString must be in range 0-7";return-1}}return n}if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var a=new Uint8Array(e,t,r);this.unusedBits=a[0];if(this.unusedBits>7){this.error="Unused bits for BitString must be in range 0-7";return-1}this.valueHex=new ArrayBuffer(a.length-1);var u=new Uint8Array(this.valueHex);for(var i=0;i<r-1;i++)u[i]=a[i+1];this.blockLength=a.length;return t+r};t.prototype.toBER=function(e){if(e===void 0){e=false}if(this.isConstructed===true)return h.prototype.toBER.call(this,e);if(e===true)return new ArrayBuffer(this.valueHex.byteLength+1);if(this.valueHex.byteLength===0)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex);var r=new ArrayBuffer(this.valueHex.byteLength+1);var n=new Uint8Array(r);n[0]=this.unusedBits;for(var i=0;i<this.valueHex.byteLength;i++)n[i+1]=t[i];return r};t.blockName=function(){return"BitStringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.unusedBits=this.unusedBits;t.isConstructed=this.isConstructed;t.isHexOnly=this.isHexOnly;t.valueHex=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);return t};return t}(o(h));var S=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,A)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=3;return r}t.blockName=function(){return"BitString"};t.prototype.fromBER=function(t,r,n){if(n===0)return r;this.valueBlock.isConstructed=this.idBlock.isConstructed;this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;return e.prototype.fromBER.call(this,t,r,n)};t.prototype.isEqual=function(e){if(e instanceof t===false)return false;if(JSON.stringify(this)!==JSON.stringify(e))return false;return true};return t}(c);t.BitString=S;var _=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;if("value"in t)r.valueDec=t.value;return r}Object.defineProperty(t.prototype,"valueHex",{get:function(){return this._valueHex},set:function(e){this._valueHex=e.slice(0);if(e.byteLength>=4){this.warnings.push("Too big Integer for decoding, hex only");this.isHexOnly=true;this._valueDec=0}else{this.isHexOnly=false;if(e.byteLength>0)this._valueDec=I.utilDecodeTC.call(this)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"valueDec",{get:function(){return this._valueDec},set:function(e){this._valueDec=e;this.isHexOnly=false;this._valueHex=(0,I.utilEncodeTC)(e)},enumerable:true,configurable:true});t.prototype.fromDER=function(e,t,r,n){if(n===void 0){n=0}var i=this.fromBER(e,t,r);if(i===-1)return i;var o=new Uint8Array(this._valueHex);if(o[0]===0&&(o[1]&128)!==0){var a=new ArrayBuffer(this._valueHex.byteLength-1);var u=new Uint8Array(a);u.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1));this._valueHex=a.slice(0)}else{if(n!==0){if(this._valueHex.byteLength<n){if(n-this._valueHex.byteLength>1)n=this._valueHex.byteLength+1;var a=new ArrayBuffer(n);var u=new Uint8Array(a);u.set(o,n-this._valueHex.byteLength);this._valueHex=a.slice(0)}}}return i};t.prototype.toDER=function(e){if(e===void 0){e=false}var t=new Uint8Array(this._valueHex);switch(true){case(t[0]&128)!==0:{var r=new ArrayBuffer(this._valueHex.byteLength+1);var n=new Uint8Array(r);n[0]=0;n.set(t,1);this._valueHex=r.slice(0)}break;case t[0]===0&&(t[1]&128)===0:{var r=new ArrayBuffer(this._valueHex.byteLength-1);var n=new Uint8Array(r);n.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1));this._valueHex=r.slice(0)}break}return this.toBER(e)};t.prototype.fromBER=function(t,r,n){var i=e.prototype.fromBER.call(this,t,r,n);if(i===-1)return i;this.blockLength=n;return r+n};t.prototype.toBER=function(e){if(e===void 0){e=false}return this.valueHex.slice(0)};t.blockName=function(){return"IntegerValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.valueDec=this.valueDec;return t};t.prototype.toString=function(){function e(e,t){var r=new Uint8Array([0]);var n=new Uint8Array(e);var i=new Uint8Array(t);var o=n.slice(0);var a=o.length-1;var u=i.slice(0);var s=u.length-1;var c=0;var f=s<a?a:s;var l=0;for(var h=f;h>=0;h--,l++){switch(true){case l<u.length:c=o[a-l]+u[s-l]+r[0];break;default:c=o[a-l]+r[0]}r[0]=c/10;switch(true){case l>=o.length:o=(0,I.utilConcatView)(new Uint8Array([c%10]),o);break;default:o[a-l]=c%10}}if(r[0]>0)o=(0,I.utilConcatView)(r,o);return o.slice(0)}function t(e){if(e>=r.length){for(var t=r.length;t<=e;t++){var n=new Uint8Array([0]);var i=r[t-1].slice(0);for(var o=i.length-1;o>=0;o--){var a=new Uint8Array([(i[o]<<1)+n[0]]);n[0]=a[0]/10;i[o]=a[0]%10}if(n[0]>0)i=(0,I.utilConcatView)(n,i);r.push(i)}}return r[e]}function i(e,t){var r=0;var n=new Uint8Array(e);var i=new Uint8Array(t);var o=n.slice(0);var a=o.length-1;var u=i.slice(0);var s=u.length-1;var c;var f=0;for(var l=s;l>=0;l--,f++){c=o[a-f]-u[s-f]-r;switch(true){case c<0:r=1;o[a-f]=c+10;break;default:r=0;o[a-f]=c}}if(r>0){for(var l=a-s+1;l>=0;l--,f++){c=o[a-f]-r;if(c<0){r=1;o[a-f]=c+10}else{r=0;o[a-f]=c;break}}}return o.slice()}var o=this._valueHex.byteLength*8-1;var a=new Uint8Array(this._valueHex.byteLength*8/3);var u=0;var s;var c=new Uint8Array(this._valueHex);var f="";var l=false;for(var h=this._valueHex.byteLength-1;h>=0;h--){s=c[h];for(var v=0;v<8;v++){if((s&1)===1){switch(u){case o:a=i(t(u),a);f="-";break;default:a=e(a,t(u))}}u++;s>>=1}}for(var v=0;v<a.length;v++){if(a[v])l=true;if(l)f+=n.charAt(a[v])}if(l===false)f+=n.charAt(0);return f};return t}(o(s));var x=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,_)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=2;return r}t.blockName=function(){return"Integer"};t.prototype.isEqual=function(e){if(e instanceof t){if(this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly)return(0,I.isEqualBuffer)(this.valueBlock.valueHex,e.valueBlock.valueHex);if(this.valueBlock.isHexOnly===e.valueBlock.isHexOnly)return this.valueBlock.valueDec===e.valueBlock.valueDec;return false}if(e instanceof ArrayBuffer)return(0,I.isEqualBuffer)(this.valueBlock.valueHex,e);return false};t.prototype.convertToDER=function(){var e=new t({valueHex:this.valueBlock.valueHex});e.valueBlock.toDER();return e};t.prototype.convertFromDER=function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength;var r=new t({valueHex:this.valueBlock.valueHex});r.valueBlock.fromDER(r.valueBlock.valueHex,0,r.valueBlock.valueHex.byteLength,e);return r};return t}(c);t.Integer=x;var C=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=10;return r}t.blockName=function(){return"Enumerated"};return t}(x);t.Enumerated=C;var N=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.valueDec=(0,I.getParametersValue)(t,"valueDec",-1);r.isFirstSid=(0,I.getParametersValue)(t,"isFirstSid",false);return r}t.blockName=function(){return"sidBlock"};t.prototype.fromBER=function(e,t,r){if(r===0)return t;if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);var i=new Uint8Array(this.valueHex);for(var o=0;o<r;o++){i[o]=n[o]&127;this.blockLength++;if((n[o]&128)===0)break}var a=new ArrayBuffer(this.blockLength);var u=new Uint8Array(a);for(var o=0;o<this.blockLength;o++)u[o]=i[o];this.valueHex=a.slice(0);i=new Uint8Array(this.valueHex);if((n[this.blockLength-1]&128)!==0){this.error="End of input reached before message was fully decoded";return-1}if(i[0]===0)this.warnings.push("Needlessly long format of SID encoding");if(this.blockLength<=8)this.valueDec=(0,I.utilFromBase)(i,7);else{this.isHexOnly=true;this.warnings.push("Too big SID for decoding, hex only")}return t+this.blockLength};t.prototype.toBER=function(e){if(e===void 0){e=false}var t;var r;if(this.isHexOnly){if(e===true)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength);r=new Uint8Array(t);for(var i=0;i<this.blockLength-1;i++)r[i]=n[i]|128;r[this.blockLength-1]=n[this.blockLength-1];return t}var o=(0,I.utilToBase)(this.valueDec,7);if(o.byteLength===0){this.error="Error during encoding SID value";return new ArrayBuffer(0)}t=new ArrayBuffer(o.byteLength);if(e===false){var a=new Uint8Array(o);r=new Uint8Array(t);for(var i=0;i<o.byteLength-1;i++)r[i]=a[i]|128;r[o.byteLength-1]=a[o.byteLength-1]}return t};t.prototype.toString=function(){var e="";if(this.isHexOnly===true)e=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);else{if(this.isFirstSid){var t=this.valueDec;if(this.valueDec<=39)e="0.";else{if(this.valueDec<=79){e="1.";t-=40}else{e="2.";t-=80}}e+=t.toString()}else e=this.valueDec.toString()}return e};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.valueDec=this.valueDec;t.isFirstSid=this.isFirstSid;return t};return t}(o(i));var E=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.fromString((0,I.getParametersValue)(t,"value",""));return r}t.prototype.fromBER=function(e,t,r){var n=t;while(r>0){var i=new N;n=i.fromBER(e,n,r);if(n===-1){this.blockLength=0;this.error=i.error;return n}if(this.value.length===0)i.isFirstSid=true;this.blockLength+=i.blockLength;r-=i.blockLength;this.value.push(i)}return n};t.prototype.toBER=function(e){if(e===void 0){e=false}var t=new ArrayBuffer(0);for(var r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(n.byteLength===0){this.error=this.value[r].error;return new ArrayBuffer(0)}t=(0,I.utilConcatBuf)(t,n)}return t};t.prototype.fromString=function(e){this.value=[];var t=0;var r=0;var n="";var i=false;do{r=e.indexOf(".",t);if(r===-1)n=e.substr(t);else n=e.substr(t,r-t);t=r+1;if(i){var o=this.value[0];var a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return false}var u=parseInt(n,10);if(isNaN(u))return true;o.valueDec=u+a;i=false}else{var o=new N;o.valueDec=parseInt(n,10);if(isNaN(o.valueDec))return true;if(this.value.length===0){o.isFirstSid=true;i=true}this.value.push(o)}}while(r!==-1);return true};t.prototype.toString=function(){var e="";var t=false;for(var r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();if(r!==0)e=e+".";if(t){n="{"+n+"}";if(this.value[r].isFirstSid)e="2.{"+n+" - 80}";else e+=n}else e+=n}return e};t.blockName=function(){return"ObjectIdentifierValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(n){}t.value=this.toString();t.sidArray=[];for(var r=0;r<this.value.length;r++)t.sidArray.push(this.value[r].toJSON());return t};return t}(s);var K=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,E)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=6;return r}t.blockName=function(){return"ObjectIdentifier"};return t}(c);t.ObjectIdentifier=K;var U=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.isHexOnly=true;r.value="";return r}t.blockName=function(){return"Utf8StringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.value=this.value;return t};return t}(o(i));var O=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,U)||this;if("value"in t)r.fromString(t.value);r.idBlock.tagClass=1;r.idBlock.tagNumber=12;return r}t.blockName=function(){return"Utf8String"};t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(t){this.warnings.push('Error during "decodeURIComponent": '+t+", using raw string")}};t.prototype.fromString=function(e){var t=unescape(encodeURIComponent(e));var r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);var n=new Uint8Array(this.valueBlock.valueHex);for(var i=0;i<r;i++)n[i]=t.charCodeAt(i);this.valueBlock.value=e};return t}(c);t.Utf8String=O;var H=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.valueDec=(0,I.getParametersValue)(t,"valueDec",-1);return r}t.blockName=function(){return"relativeSidBlock"};t.prototype.fromBER=function(e,t,r){if(r===0)return t;if((0,I.checkBufferParams)(this,e,t,r)===false)return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);var i=new Uint8Array(this.valueHex);for(var o=0;o<r;o++){i[o]=n[o]&127;this.blockLength++;if((n[o]&128)===0)break}var a=new ArrayBuffer(this.blockLength);var u=new Uint8Array(a);for(var o=0;o<this.blockLength;o++)u[o]=i[o];this.valueHex=a.slice(0);i=new Uint8Array(this.valueHex);if((n[this.blockLength-1]&128)!==0){this.error="End of input reached before message was fully decoded";return-1}if(i[0]===0)this.warnings.push("Needlessly long format of SID encoding");if(this.blockLength<=8)this.valueDec=(0,I.utilFromBase)(i,7);else{this.isHexOnly=true;this.warnings.push("Too big SID for decoding, hex only")}return t+this.blockLength};t.prototype.toBER=function(e){if(e===void 0){e=false}var t;var r;if(this.isHexOnly){if(e===true)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength);r=new Uint8Array(t);for(var i=0;i<this.blockLength-1;i++)r[i]=n[i]|128;r[this.blockLength-1]=n[this.blockLength-1];return t}var o=(0,I.utilToBase)(this.valueDec,7);if(o.byteLength===0){this.error="Error during encoding SID value";return new ArrayBuffer(0)}t=new ArrayBuffer(o.byteLength);if(e===false){var a=new Uint8Array(o);r=new Uint8Array(t);for(var i=0;i<o.byteLength-1;i++)r[i]=a[i]|128;r[o.byteLength-1]=a[o.byteLength-1]}return t};t.prototype.toString=function(){var e="";if(this.isHexOnly===true)e=(0,I.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);else{e=this.valueDec.toString()}return e};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.valueDec=this.valueDec;return t};return t}(o(i));var L=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.fromString((0,I.getParametersValue)(t,"value",""));return r}t.prototype.fromBER=function(e,t,r){var n=t;while(r>0){var i=new H;n=i.fromBER(e,n,r);if(n===-1){this.blockLength=0;this.error=i.error;return n}this.blockLength+=i.blockLength;r-=i.blockLength;this.value.push(i)}return n};t.prototype.toBER=function(e){if(e===void 0){e=false}var t=new ArrayBuffer(0);for(var r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(n.byteLength===0){this.error=this.value[r].error;return new ArrayBuffer(0)}t=(0,I.utilConcatBuf)(t,n)}return t};t.prototype.fromString=function(e){this.value=[];var t=0;var r=0;var n="";do{r=e.indexOf(".",t);if(r===-1)n=e.substr(t);else n=e.substr(t,r-t);t=r+1;var i=new H;i.valueDec=parseInt(n,10);if(isNaN(i.valueDec))return true;this.value.push(i)}while(r!==-1);return true};t.prototype.toString=function(){var e="";var t=false;for(var r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();if(r!==0)e=e+".";if(t){n="{"+n+"}";e+=n}else e+=n}return e};t.blockName=function(){return"RelativeObjectIdentifierValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(n){}t.value=this.toString();t.sidArray=[];for(var r=0;r<this.value.length;r++)t.sidArray.push(this.value[r].toJSON());return t};return t}(s);var P=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,L)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=13;return r}t.blockName=function(){return"RelativeObjectIdentifier"};return t}(c);t.RelativeObjectIdentifier=P;var T=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.isHexOnly=true;r.value="";return r}t.blockName=function(){return"BmpStringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.value=this.value;return t};return t}(o(i));var R=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,T)||this;if("value"in t)r.fromString(t.value);r.idBlock.tagClass=1;r.idBlock.tagNumber=30;return r}t.blockName=function(){return"BmpString"};t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){var t=e.slice(0);var r=new Uint8Array(t);for(var n=0;n<r.length;n+=2){var i=r[n];r[n]=r[n+1];r[n+1]=i}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))};t.prototype.fromString=function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t*2);var r=new Uint8Array(this.valueBlock.valueHex);for(var n=0;n<t;n++){var i=(0,I.utilToBase)(e.charCodeAt(n),8);var o=new Uint8Array(i);if(o.length>2)continue;var a=2-o.length;for(var u=o.length-1;u>=0;u--)r[n*2+u+a]=o[u]}this.valueBlock.value=e};return t}(c);t.BmpString=R;var D=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.isHexOnly=true;r.value="";return r}t.blockName=function(){return"UniversalStringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.value=this.value;return t};return t}(o(i));var j=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,D)||this;if("value"in t)r.fromString(t.value);r.idBlock.tagClass=1;r.idBlock.tagNumber=28;return r}t.blockName=function(){return"UniversalString"};t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){var t=e.slice(0);var r=new Uint8Array(t);for(var n=0;n<r.length;n+=4){r[n]=r[n+3];r[n+1]=r[n+2];r[n+2]=0;r[n+3]=0}this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))};t.prototype.fromString=function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t*4);var r=new Uint8Array(this.valueBlock.valueHex);for(var n=0;n<t;n++){var i=(0,I.utilToBase)(e.charCodeAt(n),8);var o=new Uint8Array(i);if(o.length>4)continue;var a=4-o.length;for(var u=o.length-1;u>=0;u--)r[n*4+u+a]=o[u]}this.valueBlock.value=e};return t}(c);t.UniversalString=j;var V=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.value="";r.isHexOnly=true;return r}t.blockName=function(){return"SimpleStringValueBlock"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.value=this.value;return t};return t}(o(i));var J=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t,V)||this;if("value"in t)r.fromString(t.value);return r}t.blockName=function(){return"SIMPLESTRING"};t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))};t.prototype.fromString=function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);var r=new Uint8Array(this.valueBlock.valueHex);for(var n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e};return t}(c);var M=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=18;return r}t.blockName=function(){return"NumericString"};return t}(J);t.NumericString=M;var F=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=19;return r}t.blockName=function(){return"PrintableString"};return t}(J);t.PrintableString=F;var z=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=20;return r}t.blockName=function(){return"TeletexString"};return t}(J);t.TeletexString=z;var G=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=21;return r}t.blockName=function(){return"VideotexString"};return t}(J);t.VideotexString=G;var q=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=22;return r}t.blockName=function(){return"IA5String"};return t}(J);t.IA5String=q;var W=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=25;return r}t.blockName=function(){return"GraphicString"};return t}(J);t.GraphicString=W;var Z=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=26;return r}t.blockName=function(){return"VisibleString"};return t}(J);t.VisibleString=Z;var $=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=27;return r}t.blockName=function(){return"GeneralString"};return t}(J);t.GeneralString=$;var X=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=29;return r}t.blockName=function(){return"CharacterString"};return t}(J);t.CharacterString=X;var Y=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.year=0;r.month=0;r.day=0;r.hour=0;r.minute=0;r.second=0;if("value"in t){r.fromString(t.value);r.valueBlock.valueHex=new ArrayBuffer(t.value.length);var n=new Uint8Array(r.valueBlock.valueHex);for(var i=0;i<t.value.length;i++)n[i]=t.value.charCodeAt(i)}if("valueDate"in t){r.fromDate(t.valueDate);r.valueBlock.valueHex=r.toBuffer()}r.idBlock.tagClass=1;r.idBlock.tagNumber=23;return r}t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))};t.prototype.toBuffer=function(){var e=this.toString();var t=new ArrayBuffer(e.length);var r=new Uint8Array(t);for(var n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t};t.prototype.fromDate=function(e){this.year=e.getUTCFullYear();this.month=e.getUTCMonth()+1;this.day=e.getUTCDate();this.hour=e.getUTCHours();this.minute=e.getUTCMinutes();this.second=e.getUTCSeconds()};t.prototype.toDate=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))};t.prototype.fromString=function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi;var r=t.exec(e);if(r===null){this.error="Wrong input string for convertion";return}var n=parseInt(r[1],10);if(n>=50)this.year=1900+n;else this.year=2e3+n;this.month=parseInt(r[2],10);this.day=parseInt(r[3],10);this.hour=parseInt(r[4],10);this.minute=parseInt(r[5],10);this.second=parseInt(r[6],10)};t.prototype.toString=function(){var e=new Array(7);e[0]=(0,I.padNumber)(this.year<2e3?this.year-1900:this.year-2e3,2);e[1]=(0,I.padNumber)(this.month,2);e[2]=(0,I.padNumber)(this.day,2);e[3]=(0,I.padNumber)(this.hour,2);e[4]=(0,I.padNumber)(this.minute,2);e[5]=(0,I.padNumber)(this.second,2);e[6]="Z";return e.join("")};t.blockName=function(){return"UTCTime"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.year=this.year;t.month=this.month;t.day=this.day;t.hour=this.hour;t.minute=this.minute;t.second=this.second;return t};return t}(Z);t.UTCTime=Y;var Q=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.year=0;r.month=0;r.day=0;r.hour=0;r.minute=0;r.second=0;r.millisecond=0;if("value"in t){r.fromString(t.value);r.valueBlock.valueHex=new ArrayBuffer(t.value.length);var n=new Uint8Array(r.valueBlock.valueHex);for(var i=0;i<t.value.length;i++)n[i]=t.value.charCodeAt(i)}if("valueDate"in t){r.fromDate(t.valueDate);r.valueBlock.valueHex=r.toBuffer()}r.idBlock.tagClass=1;r.idBlock.tagNumber=24;return r}t.prototype.fromBER=function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm===true?r:this.lenBlock.length);if(n===-1){this.error=this.valueBlock.error;return n}this.fromBuffer(this.valueBlock.valueHex);if(this.idBlock.error.length===0)this.blockLength+=this.idBlock.blockLength;if(this.lenBlock.error.length===0)this.blockLength+=this.lenBlock.blockLength;if(this.valueBlock.error.length===0)this.blockLength+=this.valueBlock.blockLength;return n};t.prototype.fromBuffer=function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))};t.prototype.toBuffer=function(){var e=this.toString();var t=new ArrayBuffer(e.length);var r=new Uint8Array(t);for(var n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t};t.prototype.fromDate=function(e){this.year=e.getUTCFullYear();this.month=e.getUTCMonth()+1;this.day=e.getUTCDate();this.hour=e.getUTCHours();this.minute=e.getUTCMinutes();this.second=e.getUTCSeconds();this.millisecond=e.getUTCMilliseconds()};t.prototype.toDate=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))};t.prototype.fromString=function(e){var t=false;var r="";var n="";var i=0;var o;var a=0;var u=0;if(e[e.length-1]==="Z"){r=e.substr(0,e.length-1);t=true}else{var s=new Number(e[e.length-1]);if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for convertion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for convertion")}else{var c=1;var f=r.indexOf("+");var l="";if(f===-1){f=r.indexOf("-");c=-1}if(f!==-1){l=r.substr(f+1);r=r.substr(0,f);if(l.length!==2&&l.length!==4)throw new Error("Wrong input string for convertion");var s=new Number(l.substr(0,2));if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");a=c*s;if(l.length===4){s=new Number(l.substr(2,2));if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");u=c*s}}}var h=r.indexOf(".");if(h===-1)h=r.indexOf(",");if(h!==-1){var v=new Number("0"+r.substr(h));if(isNaN(v.valueOf()))throw new Error("Wrong input string for convertion");i=v.valueOf();n=r.substr(0,h)}else n=r;switch(true){case n.length===8:o=/(\d{4})(\d{2})(\d{2})/gi;if(h!==-1)throw new Error("Wrong input string for convertion");break;case n.length===10:o=/(\d{4})(\d{2})(\d{2})(\d{2})/gi;if(h!==-1){var p=60*i;this.minute=Math.floor(p);p=60*(p-this.minute);this.second=Math.floor(p);p=1e3*(p-this.second);this.millisecond=Math.floor(p)}break;case n.length===12:o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi;if(h!==-1){var p=60*i;this.second=Math.floor(p);p=1e3*(p-this.second);this.millisecond=Math.floor(p)}break;case n.length===14:o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi;if(h!==-1){var p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for convertion")}var y=o.exec(n);if(y===null)throw new Error("Wrong input string for convertion");for(var g=1;g<y.length;g++){switch(g){case 1:this.year=parseInt(y[g],10);break;case 2:this.month=parseInt(y[g],10);break;case 3:this.day=parseInt(y[g],10);break;case 4:this.hour=parseInt(y[g],10)+a;break;case 5:this.minute=parseInt(y[g],10)+u;break;case 6:this.second=parseInt(y[g],10);break;default:throw new Error("Wrong input string for convertion")}}if(t===false){var d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear();this.month=d.getUTCMonth();this.day=d.getUTCDay();this.hour=d.getUTCHours();this.minute=d.getUTCMinutes();this.second=d.getUTCSeconds();this.millisecond=d.getUTCMilliseconds()}};t.prototype.toString=function(){var e=[];e.push((0,I.padNumber)(this.year,4));e.push((0,I.padNumber)(this.month,2));e.push((0,I.padNumber)(this.day,2));e.push((0,I.padNumber)(this.hour,2));e.push((0,I.padNumber)(this.minute,2));e.push((0,I.padNumber)(this.second,2));if(this.millisecond!==0){e.push(".");e.push((0,I.padNumber)(this.millisecond,3))}e.push("Z");return e.join("")};t.blockName=function(){return"GeneralizedTime"};t.prototype.toJSON=function(){var t={};try{t=e.prototype.toJSON.call(this)}catch(r){}t.year=this.year;t.month=this.month;t.day=this.day;t.hour=this.hour;t.minute=this.minute;t.second=this.second;t.millisecond=this.millisecond;return t};return t}(Z);t.GeneralizedTime=Q;var ee=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=31;return r}t.blockName=function(){return"DATE"};return t}(O);t.DATE=ee;var te=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=32;return r}t.blockName=function(){return"TimeOfDay"};return t}(O);t.TimeOfDay=te;var re=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=33;return r}t.blockName=function(){return"DateTime"};return t}(O);t.DateTime=re;var ne=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=34;return r}t.blockName=function(){return"Duration"};return t}(O);t.Duration=ne;var ie=function(e){__extends(t,e);function t(t){if(t===void 0){t={}}var r=e.call(this,t)||this;r.idBlock.tagClass=1;r.idBlock.tagNumber=14;return r}t.blockName=function(){return"TIME"};return t}(O);t.TIME=ie;var oe=function(){function e(e){if(e===void 0){e={}}this.value=(0,I.getParametersValue)(e,"value",[]);this.optional=(0,I.getParametersValue)(e,"optional",false)}return e}();t.Choice=oe;var ae=function(){function e(e){if(e===void 0){e={}}this.name=(0,I.getParametersValue)(e,"name","");this.optional=(0,I.getParametersValue)(e,"optional",false)}return e}();t.Any=ae;var ue=function(){function e(e){if(e===void 0){e={}}this.name=(0,I.getParametersValue)(e,"name","");this.optional=(0,I.getParametersValue)(e,"optional",false);this.value=(0,I.getParametersValue)(e,"value",new ae);this.local=(0,I.getParametersValue)(e,"local",false)}return e}();t.Repeated=ue;var se=function(){function e(e){if(e===void 0){e={}}this.data=(0,I.getParametersValue)(e,"data",new ArrayBuffer(0))}e.prototype.fromBER=function(e,t,r){this.data=e.slice(t,r);return t+r};e.prototype.toBER=function(e){if(e===void 0){e=false}return this.data};return e}();t.RawData=se;function ce(e,t,r){var n=t;function o(e,t){if(e instanceof t)return e;var r=new t;r.idBlock=e.idBlock;r.lenBlock=e.lenBlock;r.warnings=e.warnings;r.valueBeforeDecode=e.valueBeforeDecode.slice(0);return r}var a=new c({},Object);var u=new i;if((0,I.checkBufferParams)(u,e,t,r)===false){a.error=u.error;return{offset:-1,result:a}}var s=new Uint8Array(e,t,r);if(s.length===0){this.error="Zero buffer length";return{offset:-1,result:a}}var f=a.idBlock.fromBER(e,t,r);a.warnings.concat(a.idBlock.warnings);if(f===-1){a.error=a.idBlock.error;return{offset:-1,result:a}}t=f;r-=a.idBlock.blockLength;f=a.lenBlock.fromBER(e,t,r);a.warnings.concat(a.lenBlock.warnings);if(f===-1){a.error=a.lenBlock.error;return{offset:-1,result:a}}t=f;r-=a.lenBlock.blockLength;if(a.idBlock.isConstructed===false&&a.lenBlock.isIndefiniteForm===true){a.error="Indefinite length form used for primitive encoding form";return{offset:-1,result:a}}var h=c;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&a.idBlock.isHexOnly===false){a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard";return{offset:-1,result:a}}switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed===true&&a.lenBlock.length>0){a.error="Type [UNIVERSAL 0] is reserved";return{offset:-1,result:a}}h=y;break;case 1:h=d;break;case 2:h=x;break;case 3:h=S;break;case 4:h=B;break;case 5:h=b;break;case 6:h=K;break;case 10:h=C;break;case 12:h=O;break;case 13:h=P;break;case 14:h=ie;break;case 15:a.error="[UNIVERSAL 15] is reserved by ASN.1 standard";return{offset:-1,result:a};case 16:h=m;break;case 17:h=w;break;case 18:h=M;break;case 19:h=F;break;case 20:h=z;break;case 21:h=G;break;case 22:h=q;break;case 23:h=Y;break;case 24:h=Q;break;case 25:h=W;break;case 26:h=Z;break;case 27:h=$;break;case 28:h=j;break;case 29:h=X;break;case 30:h=R;break;case 31:h=ee;break;case 32:h=te;break;case 33:h=re;break;case 34:h=ne;break;default:{var p=void 0;if(a.idBlock.isConstructed===true)p=new v;else p=new l;p.idBlock=a.idBlock;p.lenBlock=a.lenBlock;p.warnings=a.warnings;a=p;f=a.fromBER(e,t,r)}}break;case 2:case 3:case 4:default:{if(a.idBlock.isConstructed===true)h=v;else h=l}}a=o(a,h);f=a.fromBER(e,t,a.lenBlock.isIndefiniteForm===true?r:a.lenBlock.length);a.valueBeforeDecode=e.slice(n,n+a.blockLength);return{offset:f,result:a}}function fe(e){if(e.byteLength===0){var t=new c({},Object);t.error="Input buffer has zero length";return{offset:-1,result:t}}return ce(e,0,e.byteLength)}function le(e,t,r){if(r instanceof oe){for(var n=0;n<r.value.length;n++){var i=le(e,t,r.value[n]);if(i.verified===true){return{verified:true,result:e}}}{var o={verified:false,result:{error:"Wrong values for Choice type"}};if(r.hasOwnProperty("name"))o.name=r.name;return o}}if(r instanceof ae){if(r.hasOwnProperty("name"))e[r.name]=t;return{verified:true,result:e}}if(e instanceof Object===false){return{verified:false,result:{error:"Wrong root object"}}}if(t instanceof Object===false){return{verified:false,result:{error:"Wrong ASN.1 data"}}}if(r instanceof Object===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if("idBlock"in r===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if("fromBER"in r.idBlock===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if("toBER"in r.idBlock===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}var a=r.idBlock.toBER(false);if(a.byteLength===0){return{verified:false,result:{error:"Error encoding idBlock for ASN.1 schema"}}}var u=r.idBlock.fromBER(a,0,a.byteLength);if(u===-1){return{verified:false,result:{error:"Error decoding idBlock for ASN.1 schema"}}}if(r.idBlock.hasOwnProperty("tagClass")===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if(r.idBlock.tagClass!==t.idBlock.tagClass){return{verified:false,result:e}}if(r.idBlock.hasOwnProperty("tagNumber")===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if(r.idBlock.tagNumber!==t.idBlock.tagNumber){return{verified:false,result:e}}if(r.idBlock.hasOwnProperty("isConstructed")===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if(r.idBlock.isConstructed!==t.idBlock.isConstructed){return{verified:false,result:e}}if("isHexOnly"in r.idBlock===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly){return{verified:false,result:e}}if(r.idBlock.isHexOnly===true){if("valueHex"in r.idBlock===false){return{verified:false,result:{error:"Wrong ASN.1 schema"}}}var s=new Uint8Array(r.idBlock.valueHex);var c=new Uint8Array(t.idBlock.valueHex);if(s.length!==c.length){return{verified:false,result:e}}for(var f=0;f<s.length;f++){if(s[f]!==c[1]){return{verified:false,result:e}}}}if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!=="")e[r.name]=t}if(r.idBlock.isConstructed===true){var l=0;var i={verified:false};var h=r.valueBlock.value.length;if(h>0){if(r.valueBlock.value[0]instanceof ue)h=t.valueBlock.value.length}if(h===0){return{verified:true,result:e}}if(t.valueBlock.value.length===0&&r.valueBlock.value.length!==0){var v=true;for(var f=0;f<r.valueBlock.value.length;f++)v=v&&(r.valueBlock.value[f].optional||false);if(v===true){return{verified:true,result:e}}if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!=="")delete e[r.name]}e.error="Inconsistent object length";return{verified:false,result:e}}for(var f=0;f<h;f++){if(f-l>=t.valueBlock.value.length){if(r.valueBlock.value[f].optional===false){var o={verified:false,result:e};e.error="Inconsistent length between ASN.1 data and schema";if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!==""){delete e[r.name];o.name=r.name}}return o}}else{if(r.valueBlock.value[0]instanceof ue){i=le(e,t.valueBlock.value[f],r.valueBlock.value[0].value);if(i.verified===false){if(r.valueBlock.value[0].optional===true)l++;else{if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!=="")delete e[r.name]}return i}}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var p={};if("local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local===true)p=t;else p=e;if(typeof p[r.valueBlock.value[0].name]==="undefined")p[r.valueBlock.value[0].name]=[];p[r.valueBlock.value[0].name].push(t.valueBlock.value[f])}}else{i=le(e,t.valueBlock.value[f-l],r.valueBlock.value[f]);if(i.verified===false){if(r.valueBlock.value[f].optional===true)l++;else{if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!=="")delete e[r.name]}return i}}}}}if(i.verified===false){var o={verified:false,result:e};if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!==""){delete e[r.name];o.name=r.name}}return o}return{verified:true,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var y=fe(t.valueBlock.valueHex);if(y.offset===-1){var o={verified:false,result:y.result};if(r.hasOwnProperty("name")){r.name=r.name.replace(/^\s+|\s+$/g,"");if(r.name!==""){delete e[r.name];o.name=r.name}}return o}return le(e,y.result,r.primitiveSchema)}return{verified:true,result:e}}function he(e,t){if(t instanceof Object===false){return{verified:false,result:{error:"Wrong ASN.1 schema type"}}}var r=fe(e);if(r.offset===-1){return{verified:false,result:r.result}}return le(r.result,r.result,t)}function ve(e){}}));var R=v(T);var D=T.fromBER;var j=T.compareSchema;var V=T.verifySchema;var J=T.fromJSON;var M=T.RawData;var F=T.Repeated;var z=T.Any;var G=T.Choice;var q=T.TIME;var W=T.Duration;var Z=T.DateTime;var $=T.TimeOfDay;var X=T.DATE;var Y=T.GeneralizedTime;var Q=T.UTCTime;var ee=T.CharacterString;var te=T.GeneralString;var re=T.VisibleString;var ne=T.GraphicString;var ie=T.IA5String;var oe=T.VideotexString;var ae=T.TeletexString;var ue=T.PrintableString;var se=T.NumericString;var ce=T.UniversalString;var fe=T.BmpString;var le=T.RelativeObjectIdentifier;var he=T.Utf8String;var ve=T.ObjectIdentifier;var pe=T.Enumerated;var ye=T.Integer;var ge=T.BitString;var de=T.OctetString;var me=T.Null;var we=T.Set;var be=T.Sequence;var ke=T.Boolean;var Be=T.EndOfContent;var Ae=T.Constructed;var Se=T.Primitive;var _e=T.BaseBlock;var xe=T.ValueBlock;var Ce=T.HexBlock;var Ne=Object.freeze({__proto__:null,default:R,__moduleExports:T,fromBER:D,compareSchema:j,verifySchema:V,fromJSON:J,RawData:M,Repeated:F,Any:z,Choice:G,TIME:q,Duration:W,DateTime:Z,TimeOfDay:$,DATE:X,GeneralizedTime:Y,UTCTime:Q,CharacterString:ee,GeneralString:te,VisibleString:re,GraphicString:ne,IA5String:ie,VideotexString:oe,TeletexString:ae,PrintableString:ue,NumericString:se,UniversalString:ce,BmpString:fe,RelativeObjectIdentifier:le,Utf8String:he,ObjectIdentifier:ve,Enumerated:pe,Integer:ye,BitString:ge,OctetString:de,Null:me,Set:we,Sequence:be,Boolean:ke,EndOfContent:Be,Constructed:Ae,Primitive:Se,BaseBlock:_e,ValueBlock:xe,HexBlock:Ce});var Ee={fromASN:function(e){return e instanceof me?null:e.valueBeforeDecode},toASN:function(e){if(e===null){return new me}var t=D(e);if(t.result.error){throw new Error(t.result.error)}return t.result}};var Ke={fromASN:function(e){return!e.valueBlock.valueDec&&e.valueBlock.valueHex.byteLength>0?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new ye({value:e})}};var Ue={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new pe({value:e})}};var Oe={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new ye({valueHex:e})}};var He={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new ge({valueHex:e})}};var Le={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new ve({value:e})}};var Pe={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new ke({value:e})}};var Ie={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new de({valueHex:e})}};function Te(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var Re=Te(he);var De=Te(fe);var je=Te(ce);var Ve=Te(se);var Je=Te(ue);var Me=Te(ae);var Fe=Te(oe);var ze=Te(ie);var Ge=Te(ne);var qe=Te(re);var We=Te(te);var Ze=Te(ee);var $e={fromASN:function(e){return e.toDate()},toASN:function(e){return new Q({valueDate:e})}};var Xe={fromASN:function(e){return e.toDate()},toASN:function(e){return new Y({valueDate:e})}};var Ye={fromASN:function(e){return null},toASN:function(e){return new me}};var Qe=Object.freeze({__proto__:null,AsnAnyConverter:Ee,AsnIntegerConverter:Ke,AsnEnumeratedConverter:Ue,AsnIntegerArrayBufferConverter:Oe,AsnBitStringConverter:He,AsnObjectIdentifierConverter:Le,AsnBooleanConverter:Pe,AsnOctetStringConverter:Ie,AsnUtf8StringConverter:Re,AsnBmpStringConverter:De,AsnUniversalStringConverter:je,AsnNumericStringConverter:Ve,AsnPrintableStringConverter:Je,AsnTeletexStringConverter:Me,AsnVideotexStringConverter:Fe,AsnIA5StringConverter:ze,AsnGraphicStringConverter:Ge,AsnVisibleStringConverter:qe,AsnGeneralStringConverter:We,AsnCharacterStringConverter:Ze,AsnUTCTimeConverter:$e,AsnGeneralizedTimeConverter:Xe,AsnNullConverter:Ye});var et;(function(e){e[e["Sequence"]=0]="Sequence";e[e["Set"]=1]="Set";e[e["Choice"]=2]="Choice"})(et||(et={}));var tt;(function(e){e[e["Any"]=1]="Any";e[e["Boolean"]=2]="Boolean";e[e["OctetString"]=3]="OctetString";e[e["BitString"]=4]="BitString";e[e["Integer"]=5]="Integer";e[e["Enumerated"]=6]="Enumerated";e[e["ObjectIdentifier"]=7]="ObjectIdentifier";e[e["Utf8String"]=8]="Utf8String";e[e["BmpString"]=9]="BmpString";e[e["UniversalString"]=10]="UniversalString";e[e["NumericString"]=11]="NumericString";e[e["PrintableString"]=12]="PrintableString";e[e["TeletexString"]=13]="TeletexString";e[e["VideotexString"]=14]="VideotexString";e[e["IA5String"]=15]="IA5String";e[e["GraphicString"]=16]="GraphicString";e[e["VisibleString"]=17]="VisibleString";e[e["GeneralString"]=18]="GeneralString";e[e["CharacterString"]=19]="CharacterString";e[e["UTCTime"]=20]="UTCTime";e[e["GeneralizedTime"]=21]="GeneralizedTime";e[e["DATE"]=22]="DATE";e[e["TimeOfDay"]=23]="TimeOfDay";e[e["DateTime"]=24]="DateTime";e[e["Duration"]=25]="Duration";e[e["TIME"]=26]="TIME";e[e["Null"]=27]="Null"})(tt||(tt={}));function rt(e){if(e&&e.prototype){if(e.prototype.toASN&&e.prototype.fromASN){return true}else{return rt(e.prototype)}}else{return!!(e&&e.toASN&&e.fromASN)}}function nt(e){var t;if(e){var r=Object.getPrototypeOf(e);if(((t=r===null||r===void 0?void 0:r.prototype)===null||t===void 0?void 0:t.constructor)===Array){return true}return nt(r)}return false}function it(e,t){if(!(e&&t)){return false}if(e.byteLength!==t.byteLength){return false}var r=new Uint8Array(e);var n=new Uint8Array(t);for(var i=0;i<e.byteLength;i++){if(r[i]!==n[i]){return false}}return true}var ot=function(){function e(){this.items=new WeakMap}e.prototype.has=function(e){return this.items.has(e)};e.prototype.get=function(e){var t,r,n,i;var o=this.items.get(e);if(!o){throw new Error("Cannot get schema for '"+((i=(n=(r=(t=e)===null||t===void 0?void 0:t.prototype)===null||r===void 0?void 0:r.constructor)===null||n===void 0?void 0:n.name)!==null&&i!==void 0?i:e)+"' target")}return o};e.prototype.cache=function(e){var t=this.get(e);if(!t.schema){t.schema=this.create(e,true)}};e.prototype.createDefault=function(e){var t={type:et.Sequence,items:{}};var r=this.findParentSchema(e);if(r){Object.assign(t,r);t.items=Object.assign({},t.items,r.items)}return t};e.prototype.create=function(e,t){var r=this.items.get(e)||this.createDefault(e);var n=[];for(var i in r.items){var o=r.items[i];var a=t?i:"";var u=void 0;if(typeof o.type==="number"){var s=tt[o.type];var c=Ne[s];if(!c){throw new Error("Cannot get ASN1 class by name '"+s+"'")}u=new c({name:a})}else if(rt(o.type)){var f=new o.type;u=f.toSchema(a)}else{u=new z({name:a})}var l=!!o.optional||o.defaultValue!==undefined;if(o.repeated){u.name="";var h=o.repeated==="set"?we:be;u=new h({name:"",value:[new F({name:a,value:u})]})}if(o.context!==null&&o.context!==undefined){if(o.implicit){if(typeof o.type==="number"||rt(o.type)){var h=o.repeated?Ae:Se;n.push(new h({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);var v=!!o.repeated;var p=!v?this.get(o.type).schema:u;p=p.valueBlock?p.valueBlock.value:p.value;n.push(new Ae({name:!v?a:"",optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:p}))}}else{n.push(new Ae({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[u]}))}}else{u.optional=l;n.push(u)}}switch(r.type){case et.Sequence:return new be({value:n,name:""});case et.Set:return new we({value:n,name:""});case et.Choice:return new G({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}};e.prototype.set=function(e,t){this.items.set(e,t);return this};e.prototype.findParentSchema=function(e){var t=e.__proto__;if(t){var r=this.items.get(t);return r||this.findParentSchema(t)}return null};return e}();var at=new ot;var ut=function(e){return function(t){var r;if(!at.has(t)){r=at.createDefault(t);at.set(t,r)}else{r=at.get(t)}Object.assign(r,e)}};var st=function(e){return function(t,r){var n;if(!at.has(t.constructor)){n=at.createDefault(t.constructor);at.set(t.constructor,n)}else{n=at.get(t.constructor)}var i=Object.assign({},e);if(typeof i.type==="number"&&!i.converter){var o="Asn"+tt[e.type]+"Converter";var a=Qe[o];if(!a){throw new Error("Cannot get '"+o+"' for property '"+r+"' of "+t.constructor.name)}i.converter=a}n.items[r]=i}};var ct=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.schemas=[];return t}return t}(Error);var ft=function(){function e(){}e.parse=function(e,t){var r;if(e instanceof ArrayBuffer){r=e}else if(typeof Buffer!==undefined&&Buffer.isBuffer(e)){r=new Uint8Array(e).buffer}else if(ArrayBuffer.isView(e)){r=e.buffer}else{throw new TypeError("Wrong type of 'data' argument")}var n=D(r);if(n.result.error){throw new Error(n.result.error)}var i=this.fromASN(n.result,t);return i};e.fromASN=function(e,t){var r=this;var n;try{if(rt(t)){var i=new t;return i.fromASN(e)}var o=at.get(t);at.cache(t);var a=o.schema;if(e.constructor===Ae&&o.type!==et.Choice){a=new Ae({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(var u in o.items){delete e[u]}}var s=j(e,e,a);if(!s.verified){throw new ct("Data does not match to "+t.name+" ASN1 schema. "+s.result.error)}var c=new t;if(nt(t)){return t.from(e.valueBlock.value,(function(e){return r.fromASN(e,o.itemType)}))}var f=function(t){if(!e[t]){return"continue"}var i=o.items[t];if(typeof i.type==="number"||rt(i.type)){var a=(n=i.converter)!==null&&n!==void 0?n:rt(i.type)?new i.type:null;if(!a){throw new Error("Converter is empty")}if(i.repeated){if(i.implicit){var u=i.repeated==="sequence"?be:we;var s=new u;s.valueBlock=e[t].valueBlock;var f=D(s.toBER(false)).result.valueBlock.value;c[t]=Array.from(f,(function(e){return a.fromASN(e)}))}else{c[t]=Array.from(e[t],(function(e){return a.fromASN(e)}))}}else{var f=e[t];if(i.implicit){var s=void 0;if(rt(i.type)){s=(new i.type).toSchema("")}else{var h=tt[i.type];var v=Ne[h];if(!v){throw new Error("Cannot get '"+h+"' class from asn1js module")}s=new v}s.valueBlock=f.valueBlock;f=D(s.toBER(false)).result}c[t]=a.fromASN(f)}}else{if(i.repeated){c[t]=Array.from(e[t],(function(e){return r.fromASN(e,i.type)}))}else{c[t]=l.fromASN(e[t],i.type)}}};var l=this;for(var u in o.items){f(u)}return c}catch(h){if(h instanceof ct){h.schemas.push(t.name)}throw h}};return e}();var lt=function(){function e(){}e.serialize=function(e){if(e instanceof _e){return e.toBER(false)}return this.toASN(e).toBER(false)};e.toASN=function(t){var r=this;if(t&&rt(t.constructor)){return t.toASN()}var n=t.constructor;var i=at.get(n);at.cache(n);var o=[];if(i.itemType){o=t.map((function(e){return r.toAsnItem({type:i.itemType},"[]",n,e)}))}else{for(var a in i.items){var u=i.items[a];var s=t[a];if(s===undefined||u.defaultValue===s||typeof u.defaultValue==="object"&&typeof s==="object"&&it(this.serialize(u.defaultValue),this.serialize(s))){continue}var c=e.toAsnItem(u,a,n,s);if(typeof u.context==="number"){if(u.implicit){if(!u.repeated&&(typeof u.type==="number"||rt(u.type))){var f={};f.valueHex=c.valueBlock.toBER();o.push(new Se(Object.assign({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context}},f)))}else{o.push(new Ae({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context},value:c.valueBlock.value}))}}else{o.push(new Ae({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context},value:[c]}))}}else if(u.repeated){o=o.concat(c)}else{o.push(c)}}}var l;switch(i.type){case et.Sequence:l=new be({value:o});break;case et.Set:l=new we({value:o});break;case et.Choice:if(!o[0]){throw new Error("Schema '"+n.name+"' has wrong data. Choice cannot be empty.")}l=o[0];break}return l};e.toAsnItem=function(e,t,r,n){var i=this;var o;if(typeof e.type==="number"){var a=e.converter;if(!a){throw new Error("Property '"+t+"' doesn't have converter for type "+tt[e.type]+" in schema '"+r.name+"'")}if(e.repeated){var u=Array.from(n,(function(e){return a.toASN(e)}));var s=e.repeated==="sequence"?be:we;o=new s({value:u})}else{o=a.toASN(n)}}else{if(e.repeated){var u=Array.from(n,(function(e){return i.toASN(e)}));var s=e.repeated==="sequence"?be:we;o=new s({value:u})}else{o=this.toASN(n)}}return o};return e}();var ht=function(e){__extends(t,e);function t(t,r){var n=e.call(this,r?t+". See the inner exception for more details.":t)||this;n.message=t;n.innerError=r;return n}return t}(Error);var vt=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this,r,n)||this;i.schema=t;return i}return t}(ht);var pt=function(e){__extends(t,e);function t(t,r,n){return e.call(this,t,"JSON doesn't match to '"+t.target.name+"' schema. "+r,n)||this}return t}(vt);var yt=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ht);var gt=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this,"Cannot serialize by '"+t+"' schema. "+r,n)||this;i.schemaName=t;return i}return t}(ht);var dt=function(e){__extends(t,e);function t(t,r,n){if(n===void 0){n={}}var i=e.call(this,t,"Some keys doesn't match to schema")||this;i.keys=r;i.errors=n;return i}return t}(pt);var mt;(function(e){e[e["Any"]=0]="Any";e[e["Boolean"]=1]="Boolean";e[e["Number"]=2]="Number";e[e["String"]=3]="String"})(mt||(mt={}));function wt(e,t){switch(t){case mt.Boolean:return typeof e==="boolean";case mt.Number:return typeof e==="number";case mt.String:return typeof e==="string"}return true}function bt(e,t){if(!wt(e,t)){throw new TypeError("Value must be "+mt[t])}}function kt(e){if(e&&e.prototype){if(e.prototype.toJSON&&e.prototype.fromJSON){return true}else{return kt(e.prototype)}}else{return!!(e&&e.toJSON&&e.fromJSON)}}var Bt=function(){function e(){this.items=new Map}e.prototype.has=function(e){return this.items.has(e)||!!this.findParentSchema(e)};e.prototype.get=function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t){throw new Error("Cannot get schema for current target")}return t};e.prototype.create=function(e){var t={names:{}};var r=this.findParentSchema(e);if(r){Object.assign(t,r);t.names={};for(var n in r.names){t.names[n]=Object.assign({},r.names[n])}}t.target=e;return t};e.prototype.set=function(e,t){this.items.set(e,t);return this};e.prototype.findParentSchema=function(e){var t=e.__proto__;if(t){var r=this.items.get(t);return r||this.findParentSchema(t)}return null};return e}();var At="default";var St=new Bt;var _t=function(){function e(e){this.pattern=new RegExp(e)}e.prototype.validate=function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if(typeof e!=="string"){throw new yt("Incoming value must be string")}if(!t.exec(e)){throw new yt("Value doesn't match to pattern '"+t.toString()+"'")}};return e}();var xt=function(){function e(e,t){if(e===void 0){e=Number.MIN_VALUE}if(t===void 0){t=Number.MAX_VALUE}this.min=e;this.max=t}e.prototype.validate=function(e){bt(e,mt.Number);if(!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min;var r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new yt("Value doesn't match to diapason ["+t+","+r+"]")}};return e}();var Ct=function(){function e(e,t){if(e===void 0){e=Number.MIN_VALUE}if(t===void 0){t=Number.MAX_VALUE}this.min=e;this.max=t}e.prototype.validate=function(e){bt(e,mt.Number);if(!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min;var r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new yt("Value doesn't match to diapason ("+t+","+r+")")}};return e}();var Nt=function(){function e(e,t,r){this.length=e;this.minLength=t;this.maxLength=r}e.prototype.validate=function(e){if(this.length!==undefined){if(e.length!==this.length){throw new yt("Value length must be exactly "+this.length+".")}return}if(this.minLength!==undefined){if(e.length<this.minLength){throw new yt("Value length must be more than "+this.minLength+".")}}if(this.maxLength!==undefined){if(e.length>this.maxLength){throw new yt("Value length must be less than "+this.maxLength+".")}}};return e}();var Et=function(){function e(e){this.enumeration=e}e.prototype.validate=function(e){bt(e,mt.String);if(!this.enumeration.includes(e)){throw new yt("Value must be one of "+this.enumeration.map((function(e){return"'"+e+"'"})).join(", "))}};return e}();var Kt=function(){function e(){}e.checkValues=function(e,t){var r=Array.isArray(e)?e:[e];for(var n=0,i=r;n<i.length;n++){var o=i[n];for(var a=0,u=t.validations;a<u.length;a++){var s=u[a];if(s instanceof Nt&&t.repeated){s.validate(e)}else{s.validate(o)}}}};e.checkTypes=function(e,t){if(t.repeated&&!Array.isArray(e)){throw new TypeError("Value must be Array")}if(typeof t.type==="number"){var r=Array.isArray(e)?e:[e];for(var n=0,i=r;n<i.length;n++){var o=i[n];bt(o,t.type)}}};e.getSchemaByName=function(e,t){if(t===void 0){t=At}return o(o({},e.names[At]),e.names[t])};return e}();var Ut=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.serialize=function(e,t,r,n){var i=this.toJSON(e,t);return JSON.stringify(i,r,n)};t.toJSON=function(e,t){var r=this;if(t===void 0){t={}}var n;var i=t.targetSchema;var o=t.schemaName||At;if(kt(e)){return e.toJSON()}if(Array.isArray(e)){n=[];for(var a=0,u=e;a<u.length;a++){var s=u[a];n.push(this.toJSON(s,t))}}else if(typeof e==="object"){if(i&&!St.has(i)){throw new ht("Cannot get schema for `targetSchema` param")}i=i||e.constructor;if(St.has(i)){var c=St.get(i);n={};var f=this.getSchemaByName(c,o);var l=function(t){try{var a=f[t];var u=e[t];var s=void 0;if(a.optional&&u===undefined||a.defaultValue!==undefined&&u===a.defaultValue){return"continue"}if(!a.optional&&u===undefined){throw new gt(i.name,"Property '"+t+"' is required.")}if(typeof a.type==="number"){if(a.converter){if(a.repeated){s=u.map((function(t){return a.converter.toJSON(t,e)}))}else{s=a.converter.toJSON(u,e)}}else{s=u}}else{if(a.repeated){s=u.map((function(e){return r.toJSON(e,{schemaName:o})}))}else{s=h.toJSON(u,{schemaName:o})}}h.checkTypes(s,a);h.checkValues(s,a);n[a.name||t]=s}catch(l){if(l instanceof gt){throw l}else{throw new gt(c.target.name,"Property '"+t+"' is wrong. "+l.message,l)}}};var h=this;for(var v in f){l(v)}}else{n={};for(var v in e){n[v]=this.toJSON(e[v],{schemaName:o})}}}else{n=e}return n};return t}(Kt);var Ot=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.parse=function(e,t){var r=JSON.parse(e);return this.fromJSON(r,t)};t.fromJSON=function(e,r){var n=this;var i=r.targetSchema;var a=r.schemaName||At;var u=new i;if(kt(u)){return u.fromJSON(e)}var s=St.get(i);var c=this.getSchemaByName(s,a);var f={};if(r.strictProperty&&!Array.isArray(e)){t.checkStrictProperty(e,c,s)}var l=function(t){try{var i=c[t];var l=i.name||t;var v=e[l];if(v===undefined&&(i.optional||i.defaultValue!==undefined)){return"continue"}if(!i.optional&&v===undefined){throw new pt(s,"Property '"+l+"' is required.")}h.checkTypes(v,i);h.checkValues(v,i);if(typeof i.type==="number"){if(i.converter){if(i.repeated){u[t]=v.map((function(e){return i.converter.fromJSON(e,u)}))}else{u[t]=i.converter.fromJSON(v,u)}}else{u[t]=v}}else{var p=o(o({},r),{},{targetSchema:i.type,schemaName:a});if(i.repeated){u[t]=v.map((function(e){return n.fromJSON(e,p)}))}else{u[t]=h.fromJSON(v,p)}}}catch(y){if(!(y instanceof pt)){y=new pt(s,"Property '"+t+"' is wrong. "+y.message,y)}if(r.strictAllKeys){f[t]=y}else{throw y}}};var h=this;for(var v in c){l(v)}var p=Object.keys(f);if(p.length){throw new dt(s,p,f)}return u};t.checkStrictProperty=function(e,t,r){var n=Object.keys(e);var i=Object.keys(t);var o=[];for(var a=0,u=n;a<u.length;a++){var s=u[a];if(i.indexOf(s)===-1){o.push(s)}}if(o.length){throw new dt(r,o)}};return t}(Kt);function Ht(e){var t=[];if(e.pattern){t.push(new _t(e.pattern))}if(e.type===mt.Number||e.type===mt.Any){if(e.minInclusive!==undefined||e.maxInclusive!==undefined){t.push(new xt(e.minInclusive,e.maxInclusive))}if(e.minExclusive!==undefined||e.maxExclusive!==undefined){t.push(new Ct(e.minExclusive,e.maxExclusive))}if(e.enumeration!==undefined){t.push(new Et(e.enumeration))}}if(e.type===mt.String||e.repeated||e.type===mt.Any){if(e.length!==undefined||e.minLength!==undefined||e.maxLength!==undefined){t.push(new Nt(e.length,e.minLength,e.maxLength))}}return t}var Lt=function(e){if(e===void 0){e={}}return function(t,r){var n="Cannot set type for "+r+" property of "+t.constructor.name+" schema";var i;if(!St.has(t.constructor)){i=St.create(t.constructor);St.set(t.constructor,i)}else{i=St.get(t.constructor);if(i.target!==t.constructor){i=St.create(t.constructor);St.set(t.constructor,i)}}var o={type:mt.Any,validations:[]};var a=Object.assign(o,e);a.validations=Ht(a);if(typeof a.type!=="number"){if(!St.has(a.type)&&!kt(a.type)){throw new Error(n+". Assigning type doesn't have schema.")}}var u;if(Array.isArray(e.schema)){u=e.schema}else{u=[e.schema||At]}for(var s=0,c=u;s<c.length;s++){var f=c[s];if(!i.names[f]){i.names[f]={}}var l=i.names[f];l[r]=a}}};var Pt=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Error);var It=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Pt);var Tt=function(e){__extends(t,e);function t(t){return e.call(this,"Unsupported operation: "+(t?""+t:""))||this}return t}(Pt);var Rt=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Pt);var Dt=function(e){__extends(t,e);function t(t){return e.call(this,t+": Missing required property")||this}return t}(Pt);function jt(e){return typeof e==="object"&&"kty"in e}var Vt=function(){function e(){}e.prototype.digest=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkDigest.apply(this,e);return[2,this.onDigest.apply(this,e)]}))}))};e.prototype.checkDigest=function(e,t){this.checkAlgorithmName(e)};e.prototype.onDigest=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("digest")}))}))};e.prototype.generateKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkGenerateKey.apply(this,e);return[2,this.onGenerateKey.apply(this,e)]}))}))};e.prototype.checkGenerateKey=function(e,t,r){this.checkAlgorithmName(e);this.checkGenerateKeyParams(e);if(!(r&&r.length)){throw new TypeError("Usages cannot be empty when creating a key.")}var n;if(Array.isArray(this.usages)){n=this.usages}else{n=this.usages.privateKey.concat(this.usages.publicKey)}this.checkKeyUsages(r,n)};e.prototype.checkGenerateKeyParams=function(e){};e.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("generateKey")}))}))};e.prototype.sign=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkSign.apply(this,e);return[2,this.onSign.apply(this,e)]}))}))};e.prototype.checkSign=function(e,t,r){this.checkAlgorithmName(e);this.checkAlgorithmParams(e);this.checkCryptoKey(t,"sign")};e.prototype.onSign=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("sign")}))}))};e.prototype.verify=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkVerify.apply(this,e);return[2,this.onVerify.apply(this,e)]}))}))};e.prototype.checkVerify=function(e,t,r,n){this.checkAlgorithmName(e);this.checkAlgorithmParams(e);this.checkCryptoKey(t,"verify")};e.prototype.onVerify=function(e,t,r,n){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("verify")}))}))};e.prototype.encrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkEncrypt.apply(this,e);return[2,this.onEncrypt.apply(this,e)]}))}))};e.prototype.checkEncrypt=function(e,t,r,n){if(n===void 0){n={}}this.checkAlgorithmName(e);this.checkAlgorithmParams(e);this.checkCryptoKey(t,n.keyUsage?"encrypt":void 0)};e.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("encrypt")}))}))};e.prototype.decrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkDecrypt.apply(this,e);return[2,this.onDecrypt.apply(this,e)]}))}))};e.prototype.checkDecrypt=function(e,t,r,n){if(n===void 0){n={}}this.checkAlgorithmName(e);this.checkAlgorithmParams(e);this.checkCryptoKey(t,n.keyUsage?"decrypt":void 0)};e.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("decrypt")}))}))};e.prototype.deriveBits=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkDeriveBits.apply(this,e);return[2,this.onDeriveBits.apply(this,e)]}))}))};e.prototype.checkDeriveBits=function(e,t,r,n){if(n===void 0){n={}}this.checkAlgorithmName(e);this.checkAlgorithmParams(e);this.checkCryptoKey(t,n.keyUsage?"deriveBits":void 0);if(r%8!==0){throw new Rt("length: Is not multiple of 8")}};e.prototype.onDeriveBits=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("deriveBits")}))}))};e.prototype.exportKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkExportKey.apply(this,e);return[2,this.onExportKey.apply(this,e)]}))}))};e.prototype.checkExportKey=function(e,t){this.checkKeyFormat(e);this.checkCryptoKey(t);if(!t.extractable){throw new Pt("key: Is not extractable")}};e.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("exportKey")}))}))};e.prototype.importKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.checkImportKey.apply(this,e);return[2,this.onImportKey.apply(this,e)]}))}))};e.prototype.checkImportKey=function(e,t,r,n,i){this.checkKeyFormat(e);this.checkKeyData(e,t);this.checkAlgorithmName(r);this.checkImportParams(r);if(Array.isArray(this.usages)){this.checkKeyUsages(i,this.usages)}};e.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Tt("importKey")}))}))};e.prototype.checkAlgorithmName=function(e){if(e.name.toLowerCase()!==this.name.toLowerCase()){throw new It("Unrecognized name")}};e.prototype.checkAlgorithmParams=function(e){};e.prototype.checkDerivedKeyParams=function(e){};e.prototype.checkKeyUsages=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(t.indexOf(i)===-1){throw new TypeError("Cannot create a key using the specified key usages")}}};e.prototype.checkCryptoKey=function(e,t){this.checkAlgorithmName(e.algorithm);if(t&&e.usages.indexOf(t)===-1){throw new Pt("key does not match that of operation")}};e.prototype.checkRequiredProperty=function(e,t){if(!(t in e)){throw new Dt(t)}};e.prototype.checkHashAlgorithm=function(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.toLowerCase()===e.name.toLowerCase()){return}}throw new Rt("hash: Must be one of "+t.join(", "))};e.prototype.checkImportParams=function(e){};e.prototype.checkKeyFormat=function(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}};e.prototype.checkKeyData=function(e,t){if(!t){throw new TypeError("keyData: Cannot be empty on empty on key importing")}if(e==="jwk"){if(!jt(t)){throw new TypeError("keyData: Is not JsonWebToken")}}else if(!f.isBufferSource(t)){throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}};e.prototype.prepareData=function(e){return f.toArrayBuffer(e)};return e}();var Jt=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"length");if(typeof e.length!=="number"){throw new TypeError("length: Is not of type Number")}switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}};t.prototype.checkDerivedKeyParams=function(e){this.checkGenerateKeyParams(e)};return t}(Vt);var Mt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="AES-CBC";t.usages=["encrypt","decrypt","wrapKey","unwrapKey"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"iv");if(!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv))){throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'")}if(e.iv.byteLength!==16){throw new TypeError("iv: Must have length 16 bytes")}};return t}(Jt);var Ft=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="AES-CTR";t.usages=["encrypt","decrypt","wrapKey","unwrapKey"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"counter");if(!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter))){throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'")}if(e.counter.byteLength!==16){throw new TypeError("iv: Must have length 16 bytes")}this.checkRequiredProperty(e,"length");if(typeof e.length!=="number"){throw new TypeError("length: Is not a Number")}if(e.length<1){throw new Rt("length: Must be more than 0")}};return t}(Jt);var zt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="AES-ECB";t.usages=["encrypt","decrypt","wrapKey","unwrapKey"];return t}return t}(Jt);var Gt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="AES-GCM";t.usages=["encrypt","decrypt","wrapKey","unwrapKey"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"iv");if(!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv))){throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'")}if(e.iv.byteLength<1){throw new Rt("iv: Must have length more than 0 and less than 2^64 - 1")}if(!("tagLength"in e)){e.tagLength=128}switch(e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new Rt("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}};return t}(Jt);var qt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="AES-KW";t.usages=["wrapKey","unwrapKey"];return t}return t}(Jt);var Wt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.usages=["encrypt","decrypt","wrapKey","unwrapKey"];return t}t.prototype.checkAlgorithmParams=function(e){if(this.ivSize){this.checkRequiredProperty(e,"iv");if(!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv))){throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'")}if(e.iv.byteLength!==this.ivSize){throw new TypeError("iv: Must have length "+this.ivSize+" bytes")}}};t.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"length");if(typeof e.length!=="number"){throw new TypeError("length: Is not of type Number")}if(e.length!==this.keySizeBits){throw new Rt("algorith.length: Must be "+this.keySizeBits)}};t.prototype.checkDerivedKeyParams=function(e){this.checkGenerateKeyParams(e)};return t}(Vt);var Zt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"];return t}t.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms);this.checkRequiredProperty(e,"publicExponent");if(!(e.publicExponent&&e.publicExponent instanceof Uint8Array)){throw new TypeError("publicExponent: Missing or not a Uint8Array")}var t=c.ToBase64(e.publicExponent);if(!(t==="Aw=="||t==="AQAB")){throw new TypeError("publicExponent: Must be [3] or [1,0,1]")}this.checkRequiredProperty(e,"modulusLength");switch(e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}};t.prototype.checkImportParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms)};return t}(Vt);var $t=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="RSASSA-PKCS1-v1_5";t.usages={privateKey:["sign"],publicKey:["verify"]};return t}return t}(Zt);var Xt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="RSA-PSS";t.usages={privateKey:["sign"],publicKey:["verify"]};return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"saltLength");if(typeof e.saltLength!=="number"){throw new TypeError("saltLength: Is not a Number")}if(e.saltLength<1){throw new RangeError("saltLength: Must be more than 0")}};return t}(Zt);var Yt=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="RSA-OAEP";t.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]};return t}t.prototype.checkAlgorithmParams=function(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label))){throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}};return t}(Zt);var Qt=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"namedCurve");this.checkNamedCurve(e.namedCurve)};t.prototype.checkNamedCurve=function(e){for(var t=0,r=this.namedCurves;t<r.length;t++){var n=r[t];if(n.toLowerCase()===e.toLowerCase()){return}}throw new Rt("namedCurve: Must be one of "+this.namedCurves.join(", "))};return t}(Vt);var er=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="ECDSA";t.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"];t.usages={privateKey:["sign"],publicKey:["verify"]};t.namedCurves=["P-256","P-384","P-521","K-256"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms)};return t}(Qt);var tr=["secret","private","public"];var rr=function(){function e(){}e.create=function(e,t,r,n){var i=new this;i.algorithm=e;i.type=t;i.extractable=r;i.usages=n;return i};e.isKeyType=function(e){return tr.indexOf(e)!==-1};return e}();var nr=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="ECDH";t.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]};t.namedCurves=["P-256","P-384","P-521","K-256"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"public");if(!(e.public instanceof rr)){throw new TypeError("public: Is not a CryptoKey")}if(e.public.type!=="public"){throw new Rt("public: Is not a public key")}if(e.public.algorithm.name!==this.name){throw new Rt("public: Is not "+this.name+" key")}};return t}(Qt);var ir=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="HMAC";t.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"];t.usages=["sign","verify"];return t}t.prototype.getDefaultLength=function(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error("Unknown algorithm name '"+e+"'")}};t.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms);if("length"in e){if(typeof e.length!=="number"){throw new TypeError("length: Is not a Number")}if(e.length<1){throw new RangeError("length: Number is out of range")}}};t.prototype.checkImportParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms)};return t}(Vt);var or=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="PBKDF2";t.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"];t.usages=["deriveBits","deriveKey"];return t}t.prototype.checkAlgorithmParams=function(e){this.checkRequiredProperty(e,"hash");this.checkHashAlgorithm(e.hash,this.hashAlgorithms);this.checkRequiredProperty(e,"salt");if(!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt))){throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'")}this.checkRequiredProperty(e,"iterations");if(typeof e.iterations!=="number"){throw new TypeError("iterations: Is not a Number")}if(e.iterations<1){throw new TypeError("iterations: Is less than 1")}};t.prototype.checkImportKey=function(t,r,n,i,o){e.prototype.checkImportKey.call(this,t,r,n,i,o);if(i){throw new SyntaxError("extractable: Must be False")}};return t}(Vt);var ar=function(){function e(){}return e}();var ur=function(){function e(){this.items={}}e.prototype.get=function(e){return this.items[e.toLowerCase()]||null};e.prototype.set=function(e){this.items[e.name.toLowerCase()]=e};e.prototype.removeAt=function(e){var t=this.get(e.toLowerCase());if(t){delete this.items[e]}return t};e.prototype.has=function(e){return!!this.get(e)};Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.items).length},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"algorithms",{get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()},enumerable:true,configurable:true});return e}();var sr=function(){function e(){this.providers=new ur}e.isHashedAlgorithm=function(e){return e&&typeof e==="object"&&"name"in e&&"hash"in e?true:false};e.prototype.digest=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,o,a;return __generator(this,(function(u){switch(u.label){case 0:this.checkRequiredArguments(e,2,"digest");t=e[0],r=e[1];n=this.prepareAlgorithm(t);i=f.toArrayBuffer(r);o=this.getProvider(n.name);return[4,o.digest(n,i)];case 1:a=u.sent();return[2,a]}}))}))};e.prototype.generateKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u;return __generator(this,(function(s){switch(s.label){case 0:this.checkRequiredArguments(e,3,"generateKey");t=e[0],r=e[1],n=e[2];i=this.prepareAlgorithm(t);a=this.getProvider(i.name);return[4,a.generateKey(o(o({},i),{},{name:a.name}),r,n)];case 1:u=s.sent();return[2,u]}}))}))};e.prototype.sign=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s;return __generator(this,(function(c){switch(c.label){case 0:this.checkRequiredArguments(e,3,"sign");t=e[0],r=e[1],n=e[2];this.checkCryptoKey(r);i=this.prepareAlgorithm(t);a=f.toArrayBuffer(n);u=this.getProvider(i.name);return[4,u.sign(o(o({},i),{},{name:u.name}),r,a)];case 1:s=c.sent();return[2,s]}}))}))};e.prototype.verify=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s,c,l;return __generator(this,(function(h){switch(h.label){case 0:this.checkRequiredArguments(e,4,"verify");t=e[0],r=e[1],n=e[2],i=e[3];this.checkCryptoKey(r);a=this.prepareAlgorithm(t);u=f.toArrayBuffer(i);s=f.toArrayBuffer(n);c=this.getProvider(a.name);return[4,c.verify(o(o({},a),{},{name:c.name}),r,s,u)];case 1:l=h.sent();return[2,l]}}))}))};e.prototype.encrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s;return __generator(this,(function(c){switch(c.label){case 0:this.checkRequiredArguments(e,3,"encrypt");t=e[0],r=e[1],n=e[2];this.checkCryptoKey(r);i=this.prepareAlgorithm(t);a=f.toArrayBuffer(n);u=this.getProvider(i.name);return[4,u.encrypt(o(o({},i),{},{name:u.name}),r,a,{keyUsage:true})];case 1:s=c.sent();return[2,s]}}))}))};e.prototype.decrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s;return __generator(this,(function(c){switch(c.label){case 0:this.checkRequiredArguments(e,3,"decrypt");t=e[0],r=e[1],n=e[2];this.checkCryptoKey(r);i=this.prepareAlgorithm(t);a=f.toArrayBuffer(n);u=this.getProvider(i.name);return[4,u.decrypt(o(o({},i),{},{name:u.name}),r,a,{keyUsage:true})];case 1:s=c.sent();return[2,s]}}))}))};e.prototype.deriveBits=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u;return __generator(this,(function(s){switch(s.label){case 0:this.checkRequiredArguments(e,3,"deriveBits");t=e[0],r=e[1],n=e[2];this.checkCryptoKey(r);i=this.prepareAlgorithm(t);a=this.getProvider(i.name);return[4,a.deriveBits(o(o({},i),{},{name:a.name}),r,n,{keyUsage:true})];case 1:u=s.sent();return[2,u]}}))}))};e.prototype.deriveKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s,c,f,l;return __generator(this,(function(h){switch(h.label){case 0:this.checkRequiredArguments(e,5,"deriveKey");t=e[0],r=e[1],n=e[2],i=e[3],a=e[4];u=this.prepareAlgorithm(n);s=this.getProvider(u.name);s.checkDerivedKeyParams(u);c=this.prepareAlgorithm(t);f=this.getProvider(c.name);f.checkCryptoKey(r,"deriveKey");return[4,f.deriveBits(o(o({},c),{},{name:f.name}),r,n.length,{keyUsage:false})];case 1:l=h.sent();return[2,this.importKey("raw",l,n,i,a)]}}))}))};e.prototype.exportKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i;return __generator(this,(function(o){switch(o.label){case 0:this.checkRequiredArguments(e,2,"exportKey");t=e[0],r=e[1];this.checkCryptoKey(r);n=this.getProvider(r.algorithm.name);return[4,n.exportKey(t,r)];case 1:i=o.sent();return[2,i]}}))}))};e.prototype.importKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t,r,n,i,a,u,s,c;return __generator(this,(function(l){this.checkRequiredArguments(e,5,"importKey");t=e[0],r=e[1],n=e[2],i=e[3],a=e[4];u=this.prepareAlgorithm(n);s=this.getProvider(u.name);if(["pkcs8","spki","raw"].indexOf(t)!==-1){c=f.toArrayBuffer(r);return[2,s.importKey(t,c,o(o({},u),{},{name:s.name}),i,a)]}else{if(!r.kty){throw new TypeError("keyData: Is not JSON")}}return[2,s.importKey(t,r,o(o({},u),{},{name:s.name}),i,a)]}))}))};e.prototype.wrapKey=function(e,t,r,n){return h(this,void 0,void 0,(function(){var i,a,u,s,l;return __generator(this,(function(h){switch(h.label){case 0:return[4,this.exportKey(e,t)];case 1:i=h.sent();if(e==="jwk"){a=JSON.stringify(i);i=c.FromUtf8String(a)}u=this.prepareAlgorithm(n);s=f.toArrayBuffer(i);l=this.getProvider(u.name);return[2,l.encrypt(o(o({},u),{},{name:l.name}),r,s,{keyUsage:false})]}}))}))};e.prototype.unwrapKey=function(e,t,r,n,i,a,u){return h(this,void 0,void 0,(function(){var s,l,h,v,p;return __generator(this,(function(y){switch(y.label){case 0:s=this.prepareAlgorithm(n);l=f.toArrayBuffer(t);h=this.getProvider(s.name);return[4,h.decrypt(o(o({},s),{},{name:h.name}),r,l,{keyUsage:false})];case 1:v=y.sent();if(e==="jwk"){try{v=JSON.parse(c.ToUtf8String(v))}catch(g){p=new TypeError("wrappedKey: Is not a JSON");p.internal=g;throw p}}return[2,this.importKey(e,v,i,a,u)]}}))}))};e.prototype.checkRequiredArguments=function(e,t,r){if(e.length!==t){throw new TypeError("Failed to execute '"+r+"' on 'SubtleCrypto': "+t+" arguments required, but only "+e.length+" present")}};e.prototype.prepareAlgorithm=function(t){if(typeof t==="string"){return{name:t}}if(e.isHashedAlgorithm(t)){var r=o({},t);r.hash=this.prepareAlgorithm(t.hash);return r}return o({},t)};e.prototype.getProvider=function(e){var t=this.providers.get(e);if(!t){throw new It("Unrecognized name")}return t};e.prototype.checkCryptoKey=function(e){if(!(e instanceof rr)){throw new TypeError("Key is not of type 'CryptoKey'")}};return e}();var cr=function(){function e(e){if(e){this.value=e}}return e}();l([st({type:tt.ObjectIdentifier})],cr.prototype,"value",void 0);cr=l([ut({type:et.Choice})],cr);var fr=function(){function e(e){Object.assign(this,e)}return e}();l([st({type:tt.ObjectIdentifier})],fr.prototype,"algorithm",void 0);l([st({type:tt.Any,optional:true})],fr.prototype,"parameters",void 0);var lr=function(){function e(){this.version=0;this.privateKeyAlgorithm=new fr;this.privateKey=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer})],lr.prototype,"version",void 0);l([st({type:fr})],lr.prototype,"privateKeyAlgorithm",void 0);l([st({type:tt.OctetString})],lr.prototype,"privateKey",void 0);l([st({type:tt.Any,optional:true})],lr.prototype,"attributes",void 0);var hr=function(){function e(){this.publicKeyAlgorithm=new fr;this.publicKey=new ArrayBuffer(0)}return e}();l([st({type:fr})],hr.prototype,"publicKeyAlgorithm",void 0);l([st({type:tt.BitString})],hr.prototype,"publicKey",void 0);var vr={fromJSON:function(e){return c.FromBase64Url(e)},toJSON:function(e){return c.ToBase64Url(new Uint8Array(e))}};var pr={fromASN:function(e){var t=e.valueBlock.valueHex;return!new Uint8Array(t)[0]?e.valueBlock.valueHex.slice(1):e.valueBlock.valueHex},toASN:function(e){var t=new Uint8Array(e)[0]>127?Buffer.concat([Buffer.from([0]),Buffer.from(e)]):Buffer.from(e);return new ye({valueHex:new Uint8Array(t).buffer})}};var yr=function(){function e(){this.version=0;this.modulus=new ArrayBuffer(0);this.publicExponent=new ArrayBuffer(0);this.privateExponent=new ArrayBuffer(0);this.prime1=new ArrayBuffer(0);this.prime2=new ArrayBuffer(0);this.exponent1=new ArrayBuffer(0);this.exponent2=new ArrayBuffer(0);this.coefficient=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer,converter:Ke})],yr.prototype,"version",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"n",converter:vr})],yr.prototype,"modulus",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"e",converter:vr})],yr.prototype,"publicExponent",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"d",converter:vr})],yr.prototype,"privateExponent",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"p",converter:vr})],yr.prototype,"prime1",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"q",converter:vr})],yr.prototype,"prime2",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"dp",converter:vr})],yr.prototype,"exponent1",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"dq",converter:vr})],yr.prototype,"exponent2",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"qi",converter:vr})],yr.prototype,"coefficient",void 0);l([st({type:tt.Any,optional:true})],yr.prototype,"otherPrimeInfos",void 0);var gr=function(){function e(){this.modulus=new ArrayBuffer(0);this.publicExponent=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer,converter:pr}),Lt({name:"n",converter:vr})],gr.prototype,"modulus",void 0);l([st({type:tt.Integer,converter:pr}),Lt({name:"e",converter:vr})],gr.prototype,"publicExponent",void 0);var dr=function(){function e(e){this.value=new ArrayBuffer(0);if(e){this.value=e}}e.prototype.toJSON=function(){var e=new Uint8Array(this.value);if(e[0]!==4){throw new Pt("Wrong ECPoint. Current version supports only Uncompressed (0x04) point")}e=new Uint8Array(this.value.slice(1));var t=e.length/2;var r=0;var n={x:c.ToBase64Url(e.buffer.slice(r,r+t)),y:c.ToBase64Url(e.buffer.slice(r+t,r+t+t))};return n};e.prototype.fromJSON=function(e){if(!("x"in e)){throw new Error("x: Missing required property")}if(!("y"in e)){throw new Error("y: Missing required property")}var t=c.FromBase64Url(e.x);var r=c.FromBase64Url(e.y);var n=Buffer.concat([new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r)]);this.value=new Uint8Array(n).buffer;return this};return e}();l([st({type:tt.OctetString})],dr.prototype,"value",void 0);dr=l([ut({type:et.Choice})],dr);var mr=function(){function e(){this.version=1;this.privateKey=new ArrayBuffer(0)}e.prototype.fromJSON=function(e){if(!("d"in e)){throw new Error("d: Missing required property")}this.privateKey=c.FromBase64Url(e.d);if("x"in e){var t=new dr;t.fromJSON(e);this.publicKey=lt.toASN(t).valueBlock.valueHex}return this};e.prototype.toJSON=function(){var e={};e.d=c.ToBase64Url(this.privateKey);if(this.publicKey){Object.assign(e,new dr(this.publicKey).toJSON())}return e};return e}();l([st({type:tt.Integer,converter:Ke})],mr.prototype,"version",void 0);l([st({type:tt.OctetString})],mr.prototype,"privateKey",void 0);l([st({context:0,type:tt.Any,optional:true})],mr.prototype,"parameters",void 0);l([st({context:1,type:tt.BitString,optional:true})],mr.prototype,"publicKey",void 0);var wr={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return t[0]===0?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);r.set(t,1);return new ye({valueHex:r.buffer})}return new ye({valueHex:e})}};var br=function(){function e(){this.r=new ArrayBuffer(0);this.s=new ArrayBuffer(0)}e.fromWebCryptoSignature=function(e){var t=f.toUint8Array(e);var r=t.byteLength/2;var n=new this;n.r=n.removePadding(t.slice(0,r));n.s=n.removePadding(t.slice(r,r*2));return n};e.prototype.toWebCryptoSignature=function(e){e=this.getPointSize();var t=this.addPadding(e,f.toUint8Array(this.r));var r=this.addPadding(e,f.toUint8Array(this.s));var n=new Uint8Array(t.byteLength+r.byteLength);n.set(t,0);n.set(r,t.length);return n.buffer};e.prototype.getPointSize=function(){var e=Math.max(this.r.byteLength,this.s.byteLength);switch(e){case 31:case 32:return 32;case 47:case 48:return 48;case 65:case 66:return 66}throw new Error("Unsupported EC point size")};e.prototype.addPadding=function(e,t){var r=new Uint8Array(e);var n=f.toUint8Array(t);r.set(n,e-n.length);return r};e.prototype.removePadding=function(e){var t=f.toUint8Array(e);for(var r=0;r<t.length;r++){if(!t[r]){continue}return t.slice(r)}return new Uint8Array(0)};return e}();l([st({type:tt.Integer,converter:wr})],br.prototype,"r",void 0);l([st({type:tt.Integer,converter:wr})],br.prototype,"s",void 0);var kr=function(){var e=function(){function e(e){if(e){this.value=e}}return e}();l([st({type:tt.ObjectIdentifier})],e.prototype,"value",void 0);e=l([ut({type:et.Choice})],e);return e}();var Br=function(){var e=function(){function e(e){Object.assign(this,e)}return e}();l([st({type:tt.ObjectIdentifier})],e.prototype,"algorithm",void 0);l([st({type:tt.Any,optional:true})],e.prototype,"parameters",void 0);return e}();var Ar=function(){var e=function(){function e(){this.version=0;this.privateKeyAlgorithm=new Br;this.privateKey=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer})],e.prototype,"version",void 0);l([st({type:Br})],e.prototype,"privateKeyAlgorithm",void 0);l([st({type:tt.OctetString})],e.prototype,"privateKey",void 0);l([st({type:tt.Any,optional:true})],e.prototype,"attributes",void 0);return e}();var Sr=function(){var e=function(){function e(){this.publicKeyAlgorithm=new Br;this.publicKey=new ArrayBuffer(0)}return e}();l([st({type:Br})],e.prototype,"publicKeyAlgorithm",void 0);l([st({type:tt.BitString})],e.prototype,"publicKey",void 0);return e}();var _r={fromJSON:function(e){return c.FromBase64Url(e)},toJSON:function(e){return c.ToBase64Url(new Uint8Array(e))}};var xr;(function(e){e["Unknown"]="Unknown";e["IE"]="Internet Explorer";e["Safari"]="Safari";e["Edge"]="Edge";e["Chrome"]="Chrome";e["Firefox"]="Firefox Mozilla";e["Mobile"]="Mobile"})(xr||(xr={}));function Cr(){var e={name:xr.Unknown,version:"0"};if(typeof self==="undefined"){return e}var t=self.navigator.userAgent;var r;if(r=/edge\/([\d\.]+)/i.exec(t)){e.name=xr.Edge;e.version=r[1]}else if(/msie/i.test(t)){e.name=xr.IE;e.version=/msie ([\d\.]+)/i.exec(t)[1]}else if(/Trident/i.test(t)){e.name=xr.IE;e.version=/rv:([\d\.]+)/i.exec(t)[1]}else if(/chrome/i.test(t)){e.name=xr.Chrome;e.version=/chrome\/([\d\.]+)/i.exec(t)[1]}else if(/firefox/i.test(t)){e.name=xr.Firefox;e.version=/firefox\/([\d\.]+)/i.exec(t)[1]}else if(/mobile/i.test(t)){e.name=xr.Mobile;e.version=/mobile\/([\w]+)/i.exec(t)[1]}else if(/safari/i.test(t)){e.name=xr.Safari;e.version=/version\/([\d\.]+)/i.exec(t)[1]}return e}function Nr(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=new Uint8Array(e.map((function(e){return e.length})).reduce((function(e,t){return e+t})));var n=0;e.forEach((function(e,t){for(var i=0;i<e.length;i++){r[n+i]=e[i]}n+=e.length}));return r}var Er={fromASN:function(e){var t=e.valueBlock.valueHex;return!new Uint8Array(t)[0]?e.valueBlock.valueHex.slice(1):e.valueBlock.valueHex},toASN:function(e){var t=new Uint8Array(e)[0]>127?Nr(new Uint8Array([0]),new Uint8Array(e)):new Uint8Array(e);return new ye({valueHex:new Uint8Array(t).buffer})}};var Kr=function(){var e=function(){function e(){this.version=0;this.modulus=new ArrayBuffer(0);this.publicExponent=new ArrayBuffer(0);this.privateExponent=new ArrayBuffer(0);this.prime1=new ArrayBuffer(0);this.prime2=new ArrayBuffer(0);this.exponent1=new ArrayBuffer(0);this.exponent2=new ArrayBuffer(0);this.coefficient=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer,converter:Ke})],e.prototype,"version",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"n",converter:_r})],e.prototype,"modulus",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"e",converter:_r})],e.prototype,"publicExponent",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"d",converter:_r})],e.prototype,"privateExponent",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"p",converter:_r})],e.prototype,"prime1",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"q",converter:_r})],e.prototype,"prime2",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"dp",converter:_r})],e.prototype,"exponent1",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"dq",converter:_r})],e.prototype,"exponent2",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"qi",converter:_r})],e.prototype,"coefficient",void 0);l([st({type:tt.Any,optional:true})],e.prototype,"otherPrimeInfos",void 0);return e}();var Ur=function(){var e=function(){function e(){this.modulus=new ArrayBuffer(0);this.publicExponent=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer,converter:Er}),Lt({name:"n",converter:_r})],e.prototype,"modulus",void 0);l([st({type:tt.Integer,converter:Er}),Lt({name:"e",converter:_r})],e.prototype,"publicExponent",void 0);return e}();var Or=function(){var e=function(){function e(e){this.value=new ArrayBuffer(0);if(e){this.value=e}}e.prototype.toJSON=function(){var e=new Uint8Array(this.value);if(e[0]!==4){throw new Pt("Wrong ECPoint. Current version supports only Uncompressed (0x04) point")}e=new Uint8Array(this.value.slice(1));var t=e.length/2;var r=0;var n={x:c.ToBase64Url(e.buffer.slice(r,r+t)),y:c.ToBase64Url(e.buffer.slice(r+t,r+t+t))};return n};e.prototype.fromJSON=function(e){if(!("x"in e)){throw new Error("x: Missing required property")}if(!("y"in e)){throw new Error("y: Missing required property")}var t=c.FromBase64Url(e.x);var r=c.FromBase64Url(e.y);var n=Nr(new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r));this.value=new Uint8Array(n).buffer;return this};return e}();l([st({type:tt.OctetString})],e.prototype,"value",void 0);e=l([ut({type:et.Choice})],e);return e}();var Hr=function(){var e=function(){function e(){this.version=1;this.privateKey=new ArrayBuffer(0)}e.prototype.fromJSON=function(e){if(!("d"in e)){throw new Error("d: Missing required property")}this.privateKey=c.FromBase64Url(e.d);if("x"in e){var t=new Or;t.fromJSON(e);this.publicKey=lt.toASN(t).valueBlock.valueHex}return this};e.prototype.toJSON=function(){var e={};e.d=c.ToBase64Url(this.privateKey);if(this.publicKey){Object.assign(e,new Or(this.publicKey).toJSON())}return e};return e}();l([st({type:tt.Integer,converter:Ke})],e.prototype,"version",void 0);l([st({type:tt.OctetString})],e.prototype,"privateKey",void 0);l([st({context:0,type:tt.Any,optional:true})],e.prototype,"parameters",void 0);l([st({context:1,type:tt.BitString,optional:true})],e.prototype,"publicKey",void 0);return e}();var Lr={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return t[0]===0?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);r.set(t,1);return new ye({valueHex:r})}return new ye({valueHex:e})}};var Pr=function(){var e=function(){function e(){this.r=new ArrayBuffer(0);this.s=new ArrayBuffer(0)}return e}();l([st({type:tt.Integer,converter:Lr})],e.prototype,"r",void 0);l([st({type:tt.Integer,converter:Lr})],e.prototype,"s",void 0);return e}();var Ir=function(){function e(){}Object.defineProperty(e,"enabled",{get:function(){return typeof self!=="undefined"&&self.PV_WEBCRYPTO_LINER_LOG},enumerable:true,configurable:true});e.log=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.enabled){console.log.apply(console,e)}};e.error=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.enabled){console.error.apply(console,e)}};e.info=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.enabled){console.info.apply(console,e)}};e.warn=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.enabled){console.warn.apply(console,e)}};e.trace=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.enabled){console.trace.apply(console,e)}};return e}();var Tr=function(e){__extends(t,e);function t(t,r,n,i){var o=e.call(this)||this;o.extractable=r;o.type=n;o.usages=i;o.algorithm=Object.assign({},t);return o}return t}(rr);function Rr(e,t){return e.name.toUpperCase()===t.toUpperCase()}var Dr=function(e){__extends(t,e);function t(t,r,n,i){var o=e.call(this,t,r,"secret",n)||this;o.raw=i;return o}t.prototype.toJSON=function(){var e={kty:"oct",alg:this.getJwkAlgorithm(),k:c.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages};return e};t.prototype.getJwkAlgorithm=function(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return"A"+this.algorithm.length+"CBC";case"AES-CTR":return"A"+this.algorithm.length+"CTR";case"AES-GCM":return"A"+this.algorithm.length+"GCM";case"AES-ECB":return"A"+this.algorithm.length+"ECB";default:throw new It("Unsupported algorithm name")}};return t}(Tr);var jr=function(){var r=function(){function r(){}r.checkCryptoKey=function(e){if(!(e instanceof Dr)){throw new TypeError("key: Is not AesCryptoKey")}};r.generateKey=function(t,r,n){return h(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){i=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8));return[2,new Dr(t,r,n,i)]}))}))};r.encrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,f.toUint8Array(r),true)]}))}))};r.decrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,f.toUint8Array(r),false)]}))}))};r.exportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(e){case"jwk":return[2,t.toJSON()];case"raw":return[2,t.raw.buffer];default:throw new Rt("format: Must be 'jwk' or 'raw'")}return[2]}))}))};r.importKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var e,o;return __generator(this,(function(a){if(jt(t)){e=c.FromBase64Url(t.k)}else{e=f.toArrayBuffer(t)}switch(e.byteLength<<3){case 128:case 192:case 256:break;default:throw new Rt("keyData: Is wrong key length")}o=new Dr({name:r.name,length:e.byteLength<<3},n,i,new Uint8Array(e));return[2,o]}))}))};r.cipher=function(e,n,i,o){return h(this,void 0,void 0,(function(){var a,u,s,s,c,l;return __generator(this,(function(h){a=o?"encrypt":"decrypt";if(Rr(e,r.AesCBC)){s=f.toUint8Array(e.iv);u=t.AES_CBC[a](i,n.raw,undefined,s)}else if(Rr(e,r.AesGCM)){s=f.toUint8Array(e.iv);c=void 0;if(e.additionalData){c=f.toArrayBuffer(e.additionalData)}l=(e.tagLength||128)/8;u=t.AES_GCM[a](i,n.raw,s,c,l)}else if(Rr(e,r.AesECB)){u=t.AES_ECB[a](i,n.raw,true)}else{throw new Rt("algorithm: Is not recognized")}return[2,f.toArrayBuffer(u)]}))}))};return r}();r.AesCBC="AES-CBC";r.AesECB="AES-ECB";r.AesGCM="AES-GCM";return r}();var Vr=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.generateKey(e,t,r)]}))}))};t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.encrypt(e,t,r)]}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.decrypt(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,jr.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,jr.importKey(e,t,r,n,i)]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);jr.checkCryptoKey(t)};return t}(Mt);var Jr=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.generateKey(e,t,r)]}))}))};t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.encrypt(e,t,r)]}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.decrypt(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,jr.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,jr.importKey(e,t,r,n,i)]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);jr.checkCryptoKey(t)};return t}(zt);var Mr=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.generateKey(e,t,r)]}))}))};t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.encrypt(e,t,r)]}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.decrypt(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,jr.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,jr.importKey(e,t,r,n,i)]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);jr.checkCryptoKey(t)};return t}(Gt);var Fr=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.onEncrypt=function(e,r,n){return h(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){i=new t.AES_CTR(r.raw,f.toUint8Array(e.counter)).encrypt(f.toUint8Array(n));return[2,f.toArrayBuffer(i)]}))}))};r.prototype.onDecrypt=function(e,r,n){return h(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){i=new t.AES_CTR(r.raw,f.toUint8Array(e.counter)).decrypt(f.toUint8Array(n));return[2,f.toArrayBuffer(i)]}))}))};r.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,jr.generateKey(e,t,r)]}))}))};r.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,jr.exportKey(e,t)]}))}))};r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,jr.importKey(e,t,r,n,i)]}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);jr.checkCryptoKey(t)};return r}(Ft);var zr=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Method not implemented.")}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Method not implemented.")}))}))};t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Method not implemented.")}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Method not implemented.")}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Method not implemented.")}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);jr.checkCryptoKey(t)};return t}(qt);var Gr=function(e){__extends(t,e);function t(t,r,n,i,o){var a=e.call(this,t,r,n,i)||this;a.data=o;return a}return t}(Tr);var qr=function(){var t=function(){function t(){}t.checkCryptoKey=function(e){if(!(e instanceof Gr)){throw new TypeError("key: Is not RsaCryptoKey")}};t.generateKey=function(t,r,n){return h(this,void 0,void 0,(function(){var i,o,a,u,s,c,f;var l=this;return __generator(this,(function(h){switch(h.label){case 0:i={name:"RSA-PSS",hash:"SHA-256",publicExponent:t.publicExponent,modulusLength:t.modulusLength};return[4,e.nativeSubtle.generateKey(i,true,["sign","verify"])];case 1:o=h.sent();a=new Yi;return[4,a.subtle.exportKey("pkcs8",o.privateKey)];case 2:u=h.sent();return[4,a.subtle.importKey("pkcs8",u,t,r,n.filter((function(e){return l.privateUsages.includes(e)})))];case 3:s=h.sent();return[4,a.subtle.exportKey("spki",o.publicKey)];case 4:c=h.sent();return[4,a.subtle.importKey("spki",c,t,true,n.filter((function(e){return l.publicUsages.includes(e)})))];case 5:f=h.sent();return[2,{privateKey:s,publicKey:f}]}}))}))};t.exportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(e){case"pkcs8":return[2,this.exportPkcs8Key(t)];case"spki":return[2,this.exportSpkiKey(t)];case"jwk":return[2,this.exportJwkKey(t)];default:throw new Rt("format: Must be 'jwk', 'pkcs8' or 'spki'")}return[2]}))}))};t.importKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var o,a;return __generator(this,(function(u){switch(e){case"pkcs8":o=this.importPkcs8Key(t);break;case"spki":o=this.importSpkiKey(t);break;case"jwk":o=this.importJwkKey(t);break;default:throw new Rt("format: Must be 'jwk', 'pkcs8' or 'spki'")}a=new Gr(Object.assign({publicExponent:o[1][1]===1?o[1].slice(1):o[1].slice(3),modulusLength:o[0].byteLength<<3},r),n,o.length===2?"public":"private",i,o);return[2,a]}))}))};t.randomNonZeroValues=function(t){t=e.nativeCrypto.getRandomValues(t);return t.map((function(t){while(!t){t=e.nativeCrypto.getRandomValues(new Uint8Array(1))[0]}return t}))};t.exportPkcs8Key=function(e){var t=new Ar;t.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1";t.privateKeyAlgorithm.parameters=null;t.privateKey=lt.serialize(this.exportAsmKey(e.data));return lt.serialize(t)};t.importPkcs8Key=function(e){var t=ft.parse(e,Ar);var r=ft.parse(t.privateKey,Kr);return this.importAsmKey(r)};t.importSpkiKey=function(e){var t=ft.parse(e,Sr);var r=ft.parse(t.publicKey,Ur);return this.importAsmKey(r)};t.exportSpkiKey=function(e){var t=new Ur;t.modulus=e.data[0].buffer;t.publicExponent=e.data[1][1]===1?e.data[1].buffer.slice(1):e.data[1].buffer.slice(3);var r=new Sr;r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1";r.publicKeyAlgorithm.parameters=null;r.publicKey=lt.serialize(t);return lt.serialize(r)};t.importJwkKey=function(e){var t;if(e.d){t=Ot.fromJSON(e,{targetSchema:Kr})}else{t=Ot.fromJSON(e,{targetSchema:Ur})}return this.importAsmKey(t)};t.exportJwkKey=function(e){var t=this.exportAsmKey(e.data);var r=Ut.toJSON(t);r.ext=true;r.key_ops=e.usages;r.kty="RSA";r.alg=this.getJwkAlgorithm(e.algorithm);return r};t.getJwkAlgorithm=function(e){switch(e.name.toUpperCase()){case"RSA-OAEP":var t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP"+(t!=="1"?"-"+t:"");case"RSASSA-PKCS1-V1_5":return"RS"+/(\d+)$/.exec(e.hash.name)[1];case"RSA-PSS":return"PS"+/(\d+)$/.exec(e.hash.name)[1];case"RSAES-PKCS1-V1_5":return"PS1";default:throw new Rt("algorithm: Is not recognized")}};t.exportAsmKey=function(e){var t;if(e.length>2){var r=new Kr;r.privateExponent=e[2].buffer;r.prime1=e[3].buffer;r.prime2=e[4].buffer;r.exponent1=e[5].buffer;r.exponent2=e[6].buffer;r.coefficient=e[7].buffer;t=r}else{t=new Ur}t.modulus=e[0].buffer;t.publicExponent=e[1][1]===1?e[1].buffer.slice(1):e[1].buffer.slice(3);return t};t.importAsmKey=function(e){var t=new Uint8Array(4-e.publicExponent.byteLength);var r=[new Uint8Array(e.modulus),Nr(t,new Uint8Array(e.publicExponent))];if(e instanceof Kr){r.push(new Uint8Array(e.privateExponent));r.push(new Uint8Array(e.prime1));r.push(new Uint8Array(e.prime2));r.push(new Uint8Array(e.exponent1));r.push(new Uint8Array(e.exponent2));r.push(new Uint8Array(e.coefficient))}return r};return t}();t.RsaSsa="RSASSA-PKCS1-v1_5";t.RsaPss="RSA-PSS";t.RsaOaep="RSA-OAEP";t.privateUsages=["sign","decrypt","unwrapKey"];t.publicUsages=["verify","encrypt","wrapKey"];return t}();var Wr=function(){function e(){}e.getDigest=function(e){switch(e){case"SHA-1":return new t.Sha1;case"SHA-256":return new t.Sha256;case"SHA-512":return new t.Sha512;default:throw new It("keyAlgorithm.hash: Is not recognized")}};e.digest=function(e,t){return h(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(i){r=this.getDigest(e.name);n=r.process(f.toUint8Array(t)).finish().result;return[2,f.toArrayBuffer(n)]}))}))};return e}();var Zr=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,qr.generateKey(e,t,r)]}))}))};r.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,qr.exportKey(e,t)]}))}))};r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,qr.importKey(e,t,r,n,i)]}))}))};r.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,r)]}))}))};r.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,r)]}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);qr.checkCryptoKey(t)};r.prototype.cipher=function(e,r,n){var i=Wr.getDigest(r.algorithm.hash.name);var o;if(e.label){o=f.toUint8Array(e.label)}var a=new t.RSA_OAEP(r.data,i,o);var u;var s=f.toUint8Array(n);if(r.type==="public"){u=a.encrypt(s)}else{u=a.decrypt(s)}return f.toArrayBuffer(u)};return r}(Yt);var $r=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,qr.generateKey(e,t,r)]}))}))};r.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,qr.exportKey(e,t)]}))}))};r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,qr.importKey(e,t,r,n,i)]}))}))};r.prototype.onSign=function(e,r,n){return h(this,void 0,void 0,(function(){var i,o;return __generator(this,(function(a){i=new t.RSA_PSS(r.data,Wr.getDigest(r.algorithm.hash.name),e.saltLength);o=i.sign(f.toUint8Array(n));return[2,f.toArrayBuffer(o)]}))}))};r.prototype.onVerify=function(e,r,n,i){return h(this,void 0,void 0,(function(){var o;return __generator(this,(function(a){o=new t.RSA_PSS(r.data,Wr.getDigest(r.algorithm.hash.name),e.saltLength);try{o.verify(f.toUint8Array(n),f.toUint8Array(i))}catch(u){return[2,false]}return[2,true]}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);qr.checkCryptoKey(t)};return r}(Xt);var Xr=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,qr.generateKey(e,t,r)]}))}))};r.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,qr.exportKey(e,t)]}))}))};r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,qr.importKey(e,t,r,n,i)]}))}))};r.prototype.onSign=function(e,r,n){return h(this,void 0,void 0,(function(){var e,i;return __generator(this,(function(o){e=new t.RSA_PKCS1_v1_5(r.data,Wr.getDigest(r.algorithm.hash.name));i=e.sign(f.toUint8Array(n));return[2,f.toArrayBuffer(i)]}))}))};r.prototype.onVerify=function(e,r,n,i){return h(this,void 0,void 0,(function(){var e;return __generator(this,(function(o){e=new t.RSA_PKCS1_v1_5(r.data,Wr.getDigest(r.algorithm.hash.name));try{e.verify(f.toUint8Array(n),f.toUint8Array(i))}catch(a){return[2,false]}return[2,true]}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);qr.checkCryptoKey(t)};return r}($t);var Yr=function(e){__extends(r,e);function r(){var t=e.apply(this,arguments)||this;t.name="RSAES-PKCS1-v1_5";t.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]};t.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"];return t}r.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,qr.generateKey(e,t,r)]}))}))};r.prototype.checkGenerateKeyParams=function(e){this.checkRequiredProperty(e,"publicExponent");if(!(e.publicExponent&&e.publicExponent instanceof Uint8Array)){throw new TypeError("publicExponent: Missing or not a Uint8Array")}var t=c.ToBase64(e.publicExponent);if(!(t==="Aw=="||t==="AQAB")){throw new TypeError("publicExponent: Must be [3] or [1,0,1]")}this.checkRequiredProperty(e,"modulusLength");switch(e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}};r.prototype.onDecrypt=function(e,r,n){return h(this,void 0,void 0,(function(){var e,i,o;return __generator(this,(function(a){e=new t.RSA(r.data).decrypt(new t.BigNumber(f.toUint8Array(n))).result;i=r.algorithm.modulusLength>>3;if(n.byteLength!==i){throw new Pt("Decryption error. Encrypted message size doesn't match to key length")}o=0;if(e[o++]||e[o++]!==2){throw new Pt("Decryption error")}do{if(e[o++]===0){break}}while(o<e.length);if(o<11){throw new Pt("Decryption error. PS is less than 8 octets.")}if(o===e.length){throw new Pt("Decryption error. There is no octet with hexadecimal value 0x00 to separate PS from M")}return[2,e.buffer.slice(o)]}))}))};r.prototype.onEncrypt=function(e,r,n){return h(this,void 0,void 0,(function(){var e,i,o,a,u;return __generator(this,(function(s){e=r.algorithm.modulusLength>>3;if(n.byteLength>e-11){throw new Pt("Message too long")}i=e-n.byteLength-3;o=qr.randomNonZeroValues(new Uint8Array(i));a=new Uint8Array(e);a[0]=0;a[1]=2;a.set(o,2);a[2+i]=0;a.set(new Uint8Array(n),3+i);u=new t.RSA(r.data).encrypt(new t.BigNumber(a)).result;return[2,f.toArrayBuffer(u)]}))}))};r.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,qr.exportKey(e,t)]}))}))};r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var o;return __generator(this,(function(a){switch(a.label){case 0:return[4,qr.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i)];case 1:o=a.sent();return[2,o]}}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);qr.checkCryptoKey(t)};r.prototype.prepareSignData=function(e,t){return h(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){r=new Yi;return[2,r.subtle.digest(e.hash,t)]}))}))};return r}(Vt);var Qr={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10"};function en(e){var t=Qr[e];if(!t){throw new Rt("Cannot convert WebCrypto named curve '"+e+"' to OID")}return t}var tn=function(e){__extends(t,e);function t(t,r,n,i,o){var a=e.call(this,t,r,n,i)||this;a.data=o;return a}return t}(Tr);var rn=function(){var e=function(){function e(){}e.checkLib=function(){if(typeof r==="undefined"){throw new Rt("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}};e.generateKey=function(e,t,r){return h(this,void 0,void 0,(function(){var n,i,o,a;var u=this;return __generator(this,(function(s){this.checkLib();n=this.initEcKey(e.namedCurve);i=n.genKeyPair();i.getPublic();o=new tn(Object.assign({},e),t,"private",r.filter((function(e){return~u.privateUsages.indexOf(e)})),i);a=new tn(Object.assign({},e),true,"public",r.filter((function(e){return~u.publicUsages.indexOf(e)})),i);return[2,{privateKey:o,publicKey:a}]}))}))};e.checkCryptoKey=function(e){if(!(e instanceof tn)){throw new TypeError("key: Is not EcCryptoKey")}};e.concat=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=new Uint8Array(e.map((function(e){return e.length})).reduce((function(e,t){return e+t})));var n=0;e.forEach((function(e,t){for(var i=0;i<e.length;i++){r[n+i]=e[i]}n+=e.length}));return r};e.exportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){this.checkLib();switch(e){case"pkcs8":return[2,this.exportPkcs8Key(t)];case"spki":return[2,this.exportSpkiKey(t)];case"jwk":return[2,this.exportJwkKey(t)];case"raw":return[2,new Uint8Array(t.data.getPublic("der")).buffer];default:throw new Rt("format: Must be 'jwk', 'raw, 'pkcs8' or 'spki'")}return[2]}))}))};e.importKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var o,a;return __generator(this,(function(u){this.checkLib();switch(e){case"pkcs8":o=this.importPkcs8Key(t,r.namedCurve);break;case"spki":o=this.importSpkiKey(t,r.namedCurve);break;case"raw":o=this.importEcKey(new Or(t),r.namedCurve);break;case"jwk":o=this.importJwkKey(t);break;default:throw new Rt("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'")}a=new tn(Object.assign({},r),n,o.priv?"private":"public",i,o);return[2,a]}))}))};e.getNamedCurve=function(e){var t=e.toUpperCase();var r="";if(["P-256","P-384","P-521"].indexOf(t)>-1){r=t.replace("-","").toLowerCase()}else if(t==="K-256"){r="secp256k1"}else{throw new Rt("Unsupported named curve '"+e+"'")}return r};e.initEcKey=function(e){return r.ec(this.getNamedCurve(e))};e.exportPkcs8Key=function(e){var t=new Ar;t.privateKeyAlgorithm.algorithm=this.ASN_ALGORITHM;t.privateKeyAlgorithm.parameters=lt.serialize(new kr(en(e.algorithm.namedCurve)));t.privateKey=lt.serialize(this.exportEcKey(e));return lt.serialize(t)};e.importPkcs8Key=function(e,t){var r=ft.parse(e,Ar);var n=ft.parse(r.privateKey,Hr);return this.importEcKey(n,t)};e.importSpkiKey=function(e,t){var r=ft.parse(e,Sr);var n=new Or(r.publicKey);return this.importEcKey(n,t)};e.exportSpkiKey=function(e){var t=new Or(new Uint8Array(e.data.getPublic("der")).buffer);var r=new Sr;r.publicKeyAlgorithm.algorithm=this.ASN_ALGORITHM;r.publicKeyAlgorithm.parameters=lt.serialize(new kr(en(e.algorithm.namedCurve)));r.publicKey=t.value;return lt.serialize(r)};e.importJwkKey=function(e){var t;if(e.d){t=Ot.fromJSON(e,{targetSchema:Hr})}else{t=Ot.fromJSON(e,{targetSchema:Or})}return this.importEcKey(t,e.crv)};e.exportJwkKey=function(e){var t=this.exportEcKey(e);var r=Ut.toJSON(t);r.ext=true;r.key_ops=e.usages;r.crv=e.algorithm.namedCurve;r.kty="EC";return r};e.exportEcKey=function(e){if(e.type==="private"){var t=new Hr;var r=new Uint8Array(e.data.getPrivate("der").toArray());var n=new Uint8Array(this.getPointSize(e.algorithm.namedCurve)-r.length);t.privateKey=Nr(n,r);t.publicKey=new Uint8Array(e.data.getPublic("der"));return t}else if(e.data.pub){return new Or(new Uint8Array(e.data.getPublic("der")).buffer)}else{throw new Error("Cannot get private or public key")}};e.importEcKey=function(e,t){var r=this.initEcKey(t);if(e instanceof Or){return r.keyFromPublic(new Uint8Array(e.value))}return r.keyFromPrivate(new Uint8Array(e.privateKey))};e.getPointSize=function(e){switch(e){case"P-256":case"K-256":return 32;case"P-384":return 48;case"P-521":return 66}throw new Error("namedCurve: Is not recognized")};return e}();e.privateUsages=["sign","deriveKey","deriveBits"];e.publicUsages=["verify"];e.ASN_ALGORITHM="1.2.840.10045.2.1";return e}();var nn=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,rn.generateKey(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,rn.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,rn.importKey(e,t,r,n,i)]}))}))};t.prototype.onDeriveBits=function(e,t,r){return h(this,void 0,void 0,(function(){var n,i,o,a;return __generator(this,(function(u){rn.checkLib();n=t.data.derive(e.public.data.getPublic());i=new Uint8Array(n.toArray());o=i.length;o=o>32?o>48?66:48:32;if(i.length<o){i=rn.concat(new Uint8Array(o-i.length),i)}a=i.slice(0,r/8).buffer;return[2,a]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);rn.checkCryptoKey(t)};return t}(nr);function on(e){var t=new Uint8Array(e);var r=[];for(var n=0;n<t.length;n++){r.push(t[n])}return r}function an(e,t){if(e.length%2){e="0"+e}var r=new Uint8Array(e.length/2);for(var n=0;n<e.length;n++){var i=e.slice(n,++n+1);r[(n-1)/2]=parseInt(i,16)}if(t){var o=r.length;o=o>32?o>48?66:48:32;if(r.length<o){r=rn.concat(new Uint8Array(o-r.length),r)}}return r}function un(e,t){var r="";for(var n=0;n<e.length;n++){var i=e[n].toString(16);r+=i.length%2?"0"+i:i}if(t){var o=e.length;o=o>32?o>48?66:48:32;if(r.length/2<o){r=new Array(o*2-r.length+1).join("0")+r}}return r}var sn=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,rn.generateKey(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,rn.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,rn.importKey(e,t,r,n,i)]}))}))};t.prototype.onSign=function(e,t,r){return h(this,void 0,void 0,(function(){var n,i,o,a,u;return __generator(this,(function(s){switch(s.label){case 0:rn.checkLib();n=new Yi;return[4,n.subtle.digest(e.hash,r)];case 1:o=s.sent();i=on(o);return[4,t.data.sign(i)];case 2:a=s.sent();u=un(a.r.toArray(),true)+un(a.s.toArray(),true);return[2,an(u).buffer]}}))}))};t.prototype.onVerify=function(e,t,r,n){return h(this,void 0,void 0,(function(){var i,o,a,u;return __generator(this,(function(s){switch(s.label){case 0:rn.checkLib();i=new Yi;o={r:new Uint8Array(r.slice(0,r.byteLength/2)),s:new Uint8Array(r.slice(r.byteLength/2))};return[4,i.subtle.digest(e.hash,n)];case 1:a=s.sent();u=on(a);return[2,t.data.verify(u,o)]}}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);rn.checkCryptoKey(t)};return t}(er);var cn=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="SHA-1";t.usages=[];return t}t.prototype.onDigest=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,Wr.digest(e,t)]}))}))};return t}(Vt);var fn=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="SHA-256";return t}return t}(cn);var ln=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.name="SHA-512";return t}return t}(cn);var hn=function(e){__extends(t,e);function t(t,r,n,i){var o=e.call(this,t,r,"secret",n)||this;o.raw=i;return o}return t}(Tr);var vn=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,new hn(r,n,i,f.toUint8Array(t))]}))}))};r.prototype.onDeriveBits=function(e,r,n){return h(this,void 0,void 0,(function(){var i,o,a;return __generator(this,(function(u){o=f.toUint8Array(e.salt);a=r.raw;switch(e.hash.name.toUpperCase()){case"SHA-1":i=t.Pbkdf2HmacSha1(a,o,e.iterations,n>>3);break;case"SHA-256":i=t.Pbkdf2HmacSha256(a,o,e.iterations,n>>3);break;case"SHA-512":i=t.Pbkdf2HmacSha512(a,o,e.iterations,n>>3);break;default:throw new Rt("algorithm.hash: '"+e.hash.name+"' hash algorithm is not supported")}return[2,f.toArrayBuffer(i)]}))}))};r.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);if(!(t instanceof hn)){throw new TypeError("key: Is not PbkdfCryptoKey")}};return r}(or);var pn=function e(t,r){var n=t[0+r]<<24|t[1+r]<<16|t[2+r]<<8|t[3+r];return n>>>0};var yn=function e(t,r,n){t[0+n]=r>>>24;t[1+n]=r>>>16&255;t[2+n]=r>>>8&255;t[3+n]=r&255};var gn=function e(t,r,n,i){var o=0;var a=0;for(var u=6;u>=0;u-=2){for(var s=0;s<=24;s+=8){o<<=1;o|=r>>>s+u&1}for(var s=0;s<=24;s+=8){o<<=1;o|=t>>>s+u&1}}for(var u=6;u>=0;u-=2){for(var s=1;s<=25;s+=8){a<<=1;a|=r>>>s+u&1}for(var s=1;s<=25;s+=8){a<<=1;a|=t>>>s+u&1}}n[i+0]=o>>>0;n[i+1]=a>>>0};var dn=function e(t,r,n,i){var o=0;var a=0;for(var u=0;u<4;u++){for(var s=24;s>=0;s-=8){o<<=1;o|=r>>>s+u&1;o<<=1;o|=t>>>s+u&1}}for(var u=4;u<8;u++){for(var s=24;s>=0;s-=8){a<<=1;a|=r>>>s+u&1;a<<=1;a|=t>>>s+u&1}}n[i+0]=o>>>0;n[i+1]=a>>>0};var mn=function e(t,r,n,i){var o=0;var a=0;for(var u=7;u>=5;u--){for(var s=0;s<=24;s+=8){o<<=1;o|=r>>s+u&1}for(var s=0;s<=24;s+=8){o<<=1;o|=t>>s+u&1}}for(var s=0;s<=24;s+=8){o<<=1;o|=r>>s+u&1}for(var u=1;u<=3;u++){for(var s=0;s<=24;s+=8){a<<=1;a|=r>>s+u&1}for(var s=0;s<=24;s+=8){a<<=1;a|=t>>s+u&1}}for(var s=0;s<=24;s+=8){a<<=1;a|=t>>s+u&1}n[i+0]=o>>>0;n[i+1]=a>>>0};var wn=function e(t,r){return t<<r&268435455|t>>>28-r};var bn=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];var kn=function e(t,r,n,i){var o=0;var a=0;var u=bn.length>>>1;for(var s=0;s<u;s++){o<<=1;o|=t>>>bn[s]&1}for(var s=u;s<bn.length;s++){a<<=1;a|=r>>>bn[s]&1}n[i+0]=o>>>0;n[i+1]=a>>>0};var Bn=function e(t,r,n){var i=0;var o=0;i=(t&1)<<5|t>>>27;for(var a=23;a>=15;a-=4){i<<=6;i|=t>>>a&63}for(var a=11;a>=3;a-=4){o|=t>>>a&63;o<<=6}o|=(t&31)<<1|t>>>31;r[n+0]=i>>>0;r[n+1]=o>>>0};var An=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];var Sn=function e(t,r){var n=0;for(var i=0;i<4;i++){var o=t>>>18-i*6&63;var a=An[i*64+o];n<<=4;n|=a}for(var i=0;i<4;i++){var o=r>>>18-i*6&63;var a=An[4*64+i*64+o];n<<=4;n|=a}return n>>>0};var _n=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];var xn=function e(t){var r=0;for(var n=0;n<_n.length;n++){r<<=1;r|=t>>>_n[n]&1}return r>>>0};var Cn=function e(t,r,n){var i=t.toString(2);while(i.length<r)i="0"+i;var o=[];for(var a=0;a<r;a+=n)o.push(i.slice(a,a+n));return o.join(" ")};var Nn={readUInt32BE:pn,writeUInt32BE:yn,ip:gn,rip:dn,pc1:mn,r28shl:wn,pc2:kn,expand:Bn,substitute:Sn,permute:xn,padSplit:Cn};var En=Kn;function Kn(e,t){if(!e)throw new Error(t||"Assertion failed")}Kn.equal=function e(t,r,n){if(t!=r)throw new Error(n||"Assertion failed: "+t+" != "+r)};function Un(e){this.options=e;this.type=this.options.type;this.blockSize=8;this._init();this.buffer=new Array(this.blockSize);this.bufferOff=0}var On=Un;Un.prototype._init=function e(){};Un.prototype.update=function e(t){if(t.length===0)return[];if(this.type==="decrypt")return this._updateDecrypt(t);else return this._updateEncrypt(t)};Un.prototype._buffer=function e(t,r){var n=Math.min(this.buffer.length-this.bufferOff,t.length-r);for(var i=0;i<n;i++)this.buffer[this.bufferOff+i]=t[r+i];this.bufferOff+=n;return n};Un.prototype._flushBuffer=function e(t,r){this._update(this.buffer,0,t,r);this.bufferOff=0;return this.blockSize};Un.prototype._updateEncrypt=function e(t){var r=0;var n=0;var i=(this.bufferOff+t.length)/this.blockSize|0;var o=new Array(i*this.blockSize);if(this.bufferOff!==0){r+=this._buffer(t,r);if(this.bufferOff===this.buffer.length)n+=this._flushBuffer(o,n)}var a=t.length-(t.length-r)%this.blockSize;for(;r<a;r+=this.blockSize){this._update(t,r,o,n);n+=this.blockSize}for(;r<t.length;r++,this.bufferOff++)this.buffer[this.bufferOff]=t[r];return o};Un.prototype._updateDecrypt=function e(t){var r=0;var n=0;var i=Math.ceil((this.bufferOff+t.length)/this.blockSize)-1;var o=new Array(i*this.blockSize);for(;i>0;i--){r+=this._buffer(t,r);n+=this._flushBuffer(o,n)}r+=this._buffer(t,r);return o};Un.prototype.final=function e(t){var r;if(t)r=this.update(t);var n;if(this.type==="encrypt")n=this._finalEncrypt();else n=this._finalDecrypt();if(r)return r.concat(n);else return n};Un.prototype._pad=function e(t,r){if(r===0)return false;while(r<t.length)t[r++]=0;return true};Un.prototype._finalEncrypt=function e(){if(!this._pad(this.buffer,this.bufferOff))return[];var t=new Array(this.blockSize);this._update(this.buffer,0,t,0);return t};Un.prototype._unpad=function e(t){return t};Un.prototype._finalDecrypt=function e(){En.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var t=new Array(this.blockSize);this._flushBuffer(t,0);return this._unpad(t)};var Hn;if(typeof Object.create==="function"){Hn=function e(t,r){t.super_=r;t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{Hn=function e(t,r){t.super_=r;var n=function(){};n.prototype=r.prototype;t.prototype=new n;t.prototype.constructor=t}}var Ln=Hn;var Pn=/%[sdj%]/g;function In(e){if(!ri(e)){var t=[];for(var r=0;r<arguments.length;r++){t.push(Vn(arguments[r]))}return t.join(" ")}var r=1;var n=arguments;var i=n.length;var o=String(e).replace(Pn,(function(e){if(e==="%%")return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}));for(var a=n[r];r<i;a=n[++r]){if(Qn(a)||!ai(a)){o+=" "+a}else{o+=" "+Vn(a)}}return o}function Tn(e,t){if(ii(global.process)){return function(){return Tn(e,t).apply(this,arguments)}}var r=false;function n(){if(!r){{console.error(t)}r=true}return e.apply(this,arguments)}return n}var Rn={};var Dn;function jn(e){if(ii(Dn))Dn="";e=e.toUpperCase();if(!Rn[e]){if(new RegExp("\\b"+e+"\\b","i").test(Dn)){var t=0;Rn[e]=function(){var r=In.apply(null,arguments);console.error("%s %d: %s",e,t,r)}}else{Rn[e]=function(){}}}return Rn[e]}function Vn(e,t){var r={seen:[],stylize:Mn};if(arguments.length>=3)r.depth=arguments[2];if(arguments.length>=4)r.colors=arguments[3];if(Yn(t)){r.showHidden=t}else if(t){di(r,t)}if(ii(r.showHidden))r.showHidden=false;if(ii(r.depth))r.depth=2;if(ii(r.colors))r.colors=false;if(ii(r.customInspect))r.customInspect=true;if(r.colors)r.stylize=Jn;return zn(r,e,r.depth)}Vn.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};Vn.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function Jn(e,t){var r=Vn.styles[t];if(r){return"["+Vn.colors[r][0]+"m"+e+"["+Vn.colors[r][1]+"m"}else{return e}}function Mn(e,t){return e}function Fn(e){var t={};e.forEach((function(e,r){t[e]=true}));return t}function zn(e,t,r){if(e.customInspect&&t&&ci(t.inspect)&&t.inspect!==Vn&&!(t.constructor&&t.constructor.prototype===t)){var n=t.inspect(r,e);if(!ri(n)){n=zn(e,n,r)}return n}var i=Gn(e,t);if(i){return i}var o=Object.keys(t);var a=Fn(o);if(e.showHidden){o=Object.getOwnPropertyNames(t)}if(si(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0)){return qn(t)}if(o.length===0){if(ci(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(oi(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}if(ui(t)){return e.stylize(Date.prototype.toString.call(t),"date")}if(si(t)){return qn(t)}}var s="",c=false,f=["{","}"];if(Xn(t)){c=true;f=["[","]"]}if(ci(t)){var l=t.name?": "+t.name:"";s=" [Function"+l+"]"}if(oi(t)){s=" "+RegExp.prototype.toString.call(t)}if(ui(t)){s=" "+Date.prototype.toUTCString.call(t)}if(si(t)){s=" "+qn(t)}if(o.length===0&&(!c||t.length==0)){return f[0]+s+f[1]}if(r<0){if(oi(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}else{return e.stylize("[Object]","special")}}e.seen.push(t);var h;if(c){h=Wn(e,t,r,a,o)}else{h=o.map((function(n){return Zn(e,t,r,a,n,c)}))}e.seen.pop();return $n(h,s,f)}function Gn(e,t){if(ii(t))return e.stylize("undefined","undefined");if(ri(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(ti(t))return e.stylize(""+t,"number");if(Yn(t))return e.stylize(""+t,"boolean");if(Qn(t))return e.stylize("null","null")}function qn(e){return"["+Error.prototype.toString.call(e)+"]"}function Wn(e,t,r,n,i){var o=[];for(var a=0,u=t.length;a<u;++a){if(mi(t,String(a))){o.push(Zn(e,t,r,n,String(a),true))}else{o.push("")}}i.forEach((function(i){if(!i.match(/^\d+$/)){o.push(Zn(e,t,r,n,i,true))}}));return o}function Zn(e,t,r,n,i,o){var a,u,s;s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]};if(s.get){if(s.set){u=e.stylize("[Getter/Setter]","special")}else{u=e.stylize("[Getter]","special")}}else{if(s.set){u=e.stylize("[Setter]","special")}}if(!mi(n,i)){a="["+i+"]"}if(!u){if(e.seen.indexOf(s.value)<0){if(Qn(r)){u=zn(e,s.value,null)}else{u=zn(e,s.value,r-1)}if(u.indexOf("\n")>-1){if(o){u=u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2)}else{u="\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")}}}else{u=e.stylize("[Circular]","special")}}if(ii(a)){if(o&&i.match(/^\d+$/)){return u}a=JSON.stringify(""+i);if(a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){a=a.substr(1,a.length-2);a=e.stylize(a,"name")}else{a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");a=e.stylize(a,"string")}}return a+": "+u}function $n(e,t,r){var n=e.reduce((function(e,t){if(t.indexOf("\n")>=0);return e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(n>60){return r[0]+(t===""?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]}return r[0]+t+" "+e.join(", ")+" "+r[1]}function Xn(e){return Array.isArray(e)}function Yn(e){return typeof e==="boolean"}function Qn(e){return e===null}function ei(e){return e==null}function ti(e){return typeof e==="number"}function ri(e){return typeof e==="string"}function ni(e){return typeof e==="symbol"}function ii(e){return e===void 0}function oi(e){return ai(e)&&hi(e)==="[object RegExp]"}function ai(e){return typeof e==="object"&&e!==null}function ui(e){return ai(e)&&hi(e)==="[object Date]"}function si(e){return ai(e)&&(hi(e)==="[object Error]"||e instanceof Error)}function ci(e){return typeof e==="function"}function fi(e){return e===null||typeof e==="boolean"||typeof e==="number"||typeof e==="string"||typeof e==="symbol"||typeof e==="undefined"}function li(e){return Buffer.isBuffer(e)}function hi(e){return Object.prototype.toString.call(e)}function vi(e){return e<10?"0"+e.toString(10):e.toString(10)}var pi=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function yi(){var e=new Date;var t=[vi(e.getHours()),vi(e.getMinutes()),vi(e.getSeconds())].join(":");return[e.getDate(),pi[e.getMonth()],t].join(" ")}function gi(){console.log("%s - %s",yi(),In.apply(null,arguments))}function di(e,t){if(!t||!ai(t))return e;var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}function mi(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var wi={inherits:Ln,_extend:di,log:gi,isBuffer:li,isPrimitive:fi,isFunction:ci,isError:si,isDate:ui,isObject:ai,isRegExp:oi,isUndefined:ii,isSymbol:ni,isString:ri,isNumber:ti,isNullOrUndefined:ei,isNull:Qn,isBoolean:Yn,isArray:Xn,inspect:Vn,deprecate:Tn,format:In,debuglog:jn};var bi=p((function(e){if(typeof Object.create==="function"){e.exports=function e(t,r){if(r){t.super_=r;t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}}else{e.exports=function e(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype;t.prototype=new n;t.prototype.constructor=t}}}}));var ki=p((function(e){try{var t=wi;if(typeof t.inherits!=="function")throw"";e.exports=t.inherits}catch(r){e.exports=bi}}));function Bi(){this.tmp=new Array(2);this.keys=null}function Ai(e){On.call(this,e);var t=new Bi;this._desState=t;this.deriveKeys(t,e.key)}ki(Ai,On);var Si=Ai;Ai.create=function e(t){return new Ai(t)};var _i=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];Ai.prototype.deriveKeys=function e(t,r){t.keys=new Array(16*2);En.equal(r.length,this.blockSize,"Invalid key length");var n=Nn.readUInt32BE(r,0);var i=Nn.readUInt32BE(r,4);Nn.pc1(n,i,t.tmp,0);n=t.tmp[0];i=t.tmp[1];for(var o=0;o<t.keys.length;o+=2){var a=_i[o>>>1];n=Nn.r28shl(n,a);i=Nn.r28shl(i,a);Nn.pc2(n,i,t.keys,o)}};Ai.prototype._update=function e(t,r,n,i){var o=this._desState;var a=Nn.readUInt32BE(t,r);var u=Nn.readUInt32BE(t,r+4);Nn.ip(a,u,o.tmp,0);a=o.tmp[0];u=o.tmp[1];if(this.type==="encrypt")this._encrypt(o,a,u,o.tmp,0);else this._decrypt(o,a,u,o.tmp,0);a=o.tmp[0];u=o.tmp[1];Nn.writeUInt32BE(n,a,i);Nn.writeUInt32BE(n,u,i+4)};Ai.prototype._pad=function e(t,r){var n=t.length-r;for(var i=r;i<t.length;i++)t[i]=n;return true};Ai.prototype._unpad=function e(t){var r=t[t.length-1];for(var n=t.length-r;n<t.length;n++)En.equal(t[n],r);return t.slice(0,t.length-r)};Ai.prototype._encrypt=function e(t,r,n,i,o){var a=r;var u=n;for(var s=0;s<t.keys.length;s+=2){var c=t.keys[s];var f=t.keys[s+1];Nn.expand(u,t.tmp,0);c^=t.tmp[0];f^=t.tmp[1];var l=Nn.substitute(c,f);var h=Nn.permute(l);var v=u;u=(a^h)>>>0;a=v}Nn.rip(u,a,i,o)};Ai.prototype._decrypt=function e(t,r,n,i,o){var a=n;var u=r;for(var s=t.keys.length-2;s>=0;s-=2){var c=t.keys[s];var f=t.keys[s+1];Nn.expand(a,t.tmp,0);c^=t.tmp[0];f^=t.tmp[1];var l=Nn.substitute(c,f);var h=Nn.permute(l);var v=a;a=(u^h)>>>0;u=v}Nn.rip(a,u,i,o)};var xi={};function Ci(e){En.equal(e.length,8,"Invalid IV length");this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}function Ni(e){function t(t){e.call(this,t);this._cbcInit()}ki(t,e);var r=Object.keys(xi);for(var n=0;n<r.length;n++){var i=r[n];t.prototype[i]=xi[i]}t.create=function e(r){return new t(r)};return t}var Ei=Ni;xi._cbcInit=function e(){var t=new Ci(this.options.iv);this._cbcState=t};xi._update=function e(t,r,n,i){var o=this._cbcState;var a=this.constructor.super_.prototype;var u=o.iv;if(this.type==="encrypt"){for(var s=0;s<this.blockSize;s++)u[s]^=t[r+s];a._update.call(this,u,0,n,i);for(var s=0;s<this.blockSize;s++)u[s]=n[i+s]}else{a._update.call(this,t,r,n,i);for(var s=0;s<this.blockSize;s++)n[i+s]^=u[s];for(var s=0;s<this.blockSize;s++)u[s]=t[r+s]}};var Ki={instantiate:Ei};function Ui(e,t){En.equal(t.length,24,"Invalid key length");var r=t.slice(0,8);var n=t.slice(8,16);var i=t.slice(16,24);if(e==="encrypt"){this.ciphers=[Si.create({type:"encrypt",key:r}),Si.create({type:"decrypt",key:n}),Si.create({type:"encrypt",key:i})]}else{this.ciphers=[Si.create({type:"decrypt",key:i}),Si.create({type:"encrypt",key:n}),Si.create({type:"decrypt",key:r})]}}function Oi(e){On.call(this,e);var t=new Ui(this.type,this.options.key);this._edeState=t}ki(Oi,On);var Hi=Oi;Oi.create=function e(t){return new Oi(t)};Oi.prototype._update=function e(t,r,n,i){var o=this._edeState;o.ciphers[0]._update(t,r,n,i);o.ciphers[1]._update(n,i,n,i);o.ciphers[2]._update(n,i,n,i)};Oi.prototype._pad=Si.prototype._pad;Oi.prototype._unpad=Si.prototype._unpad;var Li=Nn;var Pi=On;var Ii=Si;var Ti=Ki;var Ri=Hi;var Di={utils:Li,Cipher:Pi,DES:Ii,CBC:Ti,EDE:Ri};var ji=Object.freeze({__proto__:null,default:Di,__moduleExports:Di,utils:Li,Cipher:Pi,DES:Ii,CBC:Ti,EDE:Ri});var Vi=function(e){__extends(t,e);function t(t,r,n,i){var o=e.call(this,t,r,"secret",n)||this;o.raw=i;return o}t.prototype.toJSON=function(){var e={kty:"oct",alg:this.getJwkAlgorithm(),k:c.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages};return e};t.prototype.getJwkAlgorithm=function(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new It("Unsupported algorithm name")}};return t}(Tr);var Ji=function(){function t(){}t.checkLib=function(){if(typeof ji==="undefined"){throw new Rt("Cannot implement DES mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/des.js' script to your project")}};t.checkCryptoKey=function(e){if(!(e instanceof Vi)){throw new TypeError("key: Is not DesCryptoKey")}};t.generateKey=function(t,r,n){return h(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){this.checkLib();i=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8));return[2,new Vi(t,r,n,i)]}))}))};t.exportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){this.checkLib();switch(e){case"jwk":return[2,t.toJSON()];case"raw":return[2,t.raw.buffer];default:throw new Rt("format: Must be 'jwk' or 'raw'")}return[2]}))}))};t.importKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var e,o;return __generator(this,(function(a){this.checkLib();if(jt(t)){e=c.FromBase64Url(t.k)}else{e=f.toArrayBuffer(t)}if(r.name==="DES-CBC"&&e.byteLength!==8||r.name==="DES-EDE3-CBC"&&e.byteLength!==24){throw new Rt("keyData: Is wrong key length")}o=new Vi({name:r.name,length:e.byteLength<<3},n,i,new Uint8Array(e));return[2,o]}))}))};t.encrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,r,true)]}))}))};t.decrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.cipher(e,t,r,false)]}))}))};t.cipher=function(e,t,r,n){return h(this,void 0,void 0,(function(){var i,o,a,u;return __generator(this,(function(s){this.checkLib();i=n?"encrypt":"decrypt";a=f.toUint8Array(e.iv);switch(e.name.toUpperCase()){case"DES-CBC":o=Ti.instantiate(Ii).create({key:t.raw,type:i,iv:a});break;case"DES-EDE3-CBC":o=Ti.instantiate(Ri).create({key:t.raw,type:i,iv:a});break;default:throw new Rt("algorithm: Is not recognized")}u=o.update(new Uint8Array(r)).concat(o.final());return[2,new Uint8Array(u).buffer]}))}))};return t}();var Mi=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.keySizeBits=64;t.ivSize=8;t.name="DES-CBC";return t}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.generateKey(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,Ji.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,Ji.importKey(e,t,r,n,i)]}))}))};t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.encrypt(e,t,r)]}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.decrypt(e,t,r)]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);Ji.checkCryptoKey(t)};return t}(Wt);var Fi=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.keySizeBits=192;t.ivSize=8;t.name="DES-EDE3-CBC";return t}t.prototype.onGenerateKey=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.generateKey(e,t,r)]}))}))};t.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){return __generator(this,(function(r){return[2,Ji.exportKey(e,t)]}))}))};t.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){return __generator(this,(function(o){return[2,Ji.importKey(e,t,r,n,i)]}))}))};t.prototype.onEncrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.encrypt(e,t,r)]}))}))};t.prototype.onDecrypt=function(e,t,r){return h(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,Ji.decrypt(e,t,r)]}))}))};t.prototype.checkCryptoKey=function(t,r){e.prototype.checkCryptoKey.call(this,t,r);Ji.checkCryptoKey(t)};return t}(Wt);var zi=function(){var e=function(e){__extends(t,e);function t(t,r,n,i){if(t===void 0){t={name:"HMAC"}}if(r===void 0){r=false}if(n===void 0){n=[]}if(i===void 0){i=new Uint8Array(0)}var o=e.call(this,t,r,"secret",n)||this;o.kty="oct";o.data=i;return o}Object.defineProperty(t.prototype,"alg",{get:function(){var e=this.algorithm.hash.name.toUpperCase();return"HS"+e.replace("SHA-","")},set:function(e){},enumerable:true,configurable:true});return t}(Tr);l([Lt({name:"ext",type:mt.Boolean,optional:true})],e.prototype,"extractable",void 0);l([Lt({name:"key_ops",type:mt.String,repeated:true,optional:true})],e.prototype,"usages",void 0);l([Lt({name:"k",converter:_r})],e.prototype,"data",void 0);l([Lt({type:mt.String})],e.prototype,"kty",void 0);l([Lt({type:mt.String})],e.prototype,"alg",null);return e}();var Gi=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}n.prototype.onGenerateKey=function(t,r,n){return h(this,void 0,void 0,(function(){var i,o,a;return __generator(this,(function(u){i=t.length||this.getDefaultLength(t.hash.name);o=e.nativeCrypto.getRandomValues(new Uint8Array(i>>3));a=new zi(t,r,n,o);return[2,a]}))}))};n.prototype.onSign=function(e,r,n){return h(this,void 0,void 0,(function(){var e,i;return __generator(this,(function(o){switch(r.algorithm.hash.name.toUpperCase()){case"SHA-1":e=t.HmacSha1;break;case"SHA-256":e=t.HmacSha256;break;case"SHA-512":e=t.HmacSha512;break;default:throw new Rt("key.algorithm.hash: Is not recognized")}i=new e(r.data).process(f.toUint8Array(n)).finish().result;return[2,f.toArrayBuffer(i)]}))}))};n.prototype.onVerify=function(e,t,r,n){return h(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.onSign(e,t,n)];case 1:i=o.sent();return[2,c.ToHex(i)===c.ToHex(r)]}}))}))};n.prototype.onImportKey=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var o;return __generator(this,(function(a){switch(e.toLowerCase()){case"jwk":o=Ot.fromJSON(t,{targetSchema:zi});break;case"raw":if(!f.isBufferSource(t)){throw new TypeError("keyData: Is not ArrayBuffer or ArrayBufferView")}o=new zi(r,n,i,f.toUint8Array(t));break;default:throw new Rt("format: Must be 'jwk' or 'raw'")}o.algorithm={hash:{name:r.hash.name},name:this.name,length:o.data.length<<3};o.extractable=n;o.usages=i;return[2,o]}))}))};n.prototype.onExportKey=function(e,t){return h(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(e.toLowerCase()){case"jwk":r=Ut.toJSON(t);return[2,r];case"raw":return[2,new Uint8Array(t.data).buffer];default:throw new Rt("format: Must be 'jwk' or 'raw'")}return[2]}))}))};n.prototype.checkCryptoKey=function(e,t){r.prototype.checkCryptoKey.call(this,e,t);if(!(e instanceof zi)){throw new TypeError("key: Is not HMAC CryptoKey")}};return n}(ir);var qi=function(e,t,r){if(!t.has(e)){throw new TypeError("attempted to set private field on non-instance")}t.set(e,r);return r};var Wi=function(e,t){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t.get(e)};var Zi;var $i=function(e){__extends(t,e);function t(t,r,n,i,o){var a=e.call(this,t,r,n,i)||this;Zi.set(a,void 0);qi(a,Zi,o);return a}t.prototype.getNative=function(){return Wi(this,Zi)};return t}(Tr);Zi=new WeakMap;var Xi=function(){var t=function(t){__extends(r,t);function r(){var e=t.call(this)||this;e.browserInfo=Cr();e.providers.set(new Vr);e.providers.set(new Fr);e.providers.set(new Jr);e.providers.set(new Mr);e.providers.set(new zr);e.providers.set(new Mi);e.providers.set(new Fi);e.providers.set(new Xr);e.providers.set(new $r);e.providers.set(new Zr);e.providers.set(new Yr);e.providers.set(new sn);e.providers.set(new nn);e.providers.set(new cn);e.providers.set(new fn);e.providers.set(new ln);e.providers.set(new vn);e.providers.set(new Gi);return e}r.isAnotherKey=function(e){if(typeof e==="object"&&typeof e.type==="string"&&typeof e.extractable==="boolean"&&typeof e.algorithm==="object"){return!(e instanceof Tr)}return false};r.prototype.digest=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["digest"],e))]}))}))};r.prototype.importKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){this.fixFirefoxEcImportPkcs8(e);return[2,this.wrapNative.apply(this,__spreadArrays(["importKey"],e))]}))}))};r.prototype.exportKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.fixFirefoxEcExportPkcs8(e)];case 1:t=r.sent();if(t)return[3,3];return[4,this.wrapNative.apply(this,__spreadArrays(["exportKey"],e))];case 2:t=r.sent();r.label=3;case 3:return[2,t]}}))}))};r.prototype.generateKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["generateKey"],e))]}))}))};r.prototype.sign=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["sign"],e))]}))}))};r.prototype.verify=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["verify"],e))]}))}))};r.prototype.encrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["encrypt"],e))]}))}))};r.prototype.decrypt=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["decrypt"],e))]}))}))};r.prototype.wrapKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["wrapKey"],e))]}))}))};r.prototype.unwrapKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["unwrapKey"],e))]}))}))};r.prototype.deriveBits=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["deriveBits"],e))]}))}))};r.prototype.deriveKey=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return h(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.wrapNative.apply(this,__spreadArrays(["deriveKey"],e))]}))}))};r.prototype.wrapNative=function(n){var i=[];for(var o=1;o<arguments.length;o++){i[o-1]=arguments[o]}var a=function(e){return t.prototype[e]};return h(this,void 0,void 0,(function(){var t,o,u,s,f,o,l,s,f,o,h,s,o,v,p,y,g,d,m,g,w,b;return __generator(this,(function(k){switch(k.label){case 0:if(~["generateKey","unwrapKey","deriveKey","importKey"].indexOf(n)){this.fixAlgorithmName(i)}k.label=1;case 1:k.trys.push([1,4,,5]);if(!(n!=="digest"||!i.some((function(e){return e instanceof Tr}))))return[3,3];t=this.fixNativeArguments(n,i);Ir.info("Call native '"+n+"' method",t);return[4,e.nativeSubtle[n].apply(e.nativeSubtle,t)];case 2:o=k.sent();return[2,this.fixNativeResult(n,i,o)];case 3:return[3,5];case 4:u=k.sent();Ir.warn("Error on native '"+n+"' calling. "+u.message,u);return[3,5];case 5:if(!(n==="wrapKey"))return[3,10];k.label=6;case 6:k.trys.push([6,9,,10]);Ir.info("Trying to wrap key by using native functions",i);return[4,this.exportKey(i[0],i[1])];case 7:s=k.sent();f=i[0]==="jwk"?c.FromUtf8String(JSON.stringify(s)):s;return[4,this.encrypt(i[3],i[2],f)];case 8:o=k.sent();return[2,o];case 9:l=k.sent();Ir.warn("Cannot wrap key by native functions. "+l.message,l);return[3,10];case 10:if(!(n==="unwrapKey"))return[3,15];k.label=11;case 11:k.trys.push([11,14,,15]);Ir.info("Trying to unwrap key by using native functions",i);return[4,this.decrypt(i[3],i[2],i[1])];case 12:s=k.sent();f=i[0]==="jwk"?JSON.parse(c.ToUtf8String(s)):s;return[4,this.importKey(i[0],f,i[4],i[5],i[6])];case 13:o=k.sent();return[2,o];case 14:h=k.sent();Ir.warn("Cannot unwrap key by native functions. "+h.message,h);return[3,15];case 15:if(!(n==="deriveKey"))return[3,20];k.label=16;case 16:k.trys.push([16,19,,20]);Ir.info("Trying to derive key by using native functions",i);return[4,this.deriveBits(i[0],i[1],i[2].length)];case 17:s=k.sent();return[4,this.importKey("raw",s,i[2],i[3],i[4])];case 18:o=k.sent();return[2,o];case 19:v=k.sent();Ir.warn("Cannot derive key by native functions. "+v.message,v);return[3,20];case 20:if(!(n==="deriveBits"||n==="deriveKey"))return[3,24];p=0,y=i;k.label=21;case 21:if(!(p<y.length))return[3,24];g=y[p];if(!(typeof g==="object"&&g.public&&r.isAnotherKey(g.public)))return[3,23];d=g;return[4,this.castKey(g.public)];case 22:d.public=k.sent();k.label=23;case 23:p++;return[3,21];case 24:m=0;k.label=25;case 25:if(!(m<i.length))return[3,28];g=i[m];if(!r.isAnotherKey(g))return[3,27];w=i;b=m;return[4,this.castKey(g)];case 26:w[b]=k.sent();k.label=27;case 27:m++;return[3,25];case 28:return[2,a(n).apply(this,i)]}}))}))};r.prototype.fixNativeArguments=function(e,t){var r,n,i,o,a,u,s,l;var h=__spreadArrays(t);if(e==="importKey"){if(this.browserInfo.name===xr.IE&&((n=(r=h[0])===null||r===void 0?void 0:r.toLowerCase)===null||n===void 0?void 0:n.call(r))==="jwk"&&!f.isBufferSource(h[1])){h[1]=c.FromUtf8String(JSON.stringify(h[1]))}}if(this.browserInfo.name===xr.IE&&t[1]instanceof $i){switch(e){case"sign":case"verify":case"encrypt":case"decrypt":h[0]=Object.assign(Object.assign({},this.prepareAlgorithm(h[0])),{hash:(a=(o=(i=h[1])===null||i===void 0?void 0:i.algorithm)===null||o===void 0?void 0:o.hash)===null||a===void 0?void 0:a.name});break;case"wrapKey":case"unwrapKey":h[4]=Object.assign(Object.assign({},this.prepareAlgorithm(h[4])),{hash:(l=(s=(u=h[3])===null||u===void 0?void 0:u.algorithm)===null||s===void 0?void 0:s.hash)===null||l===void 0?void 0:l.name});break}}for(var v=0;v<h.length;v++){var p=h[v];if(p instanceof $i){h[v]=p.getNative()}}return h};r.prototype.fixNativeResult=function(e,t,r){var n,i;if(this.browserInfo.name===xr.IE){if(e==="exportKey"){if(((i=(n=t[0])===null||n===void 0?void 0:n.toLowerCase)===null||i===void 0?void 0:i.call(n))==="jwk"&&r instanceof ArrayBuffer){return JSON.parse(c.ToUtf8String(r))}}if("privateKey"in r){var o=["sign","decrypt","unwrapKey","deriveKey","deriveBits"];var a=["verify","encrypt","wrapKey"];return{privateKey:this.wrapNativeKey(r.privateKey,t[0],t[1],t[2].filter((function(e){return o.includes(e)}))),publicKey:this.wrapNativeKey(r.publicKey,t[0],t[1],t[2].filter((function(e){return a.includes(e)})))}}else if("extractable"in r){var u=void 0;var s=void 0;switch(e){case"importKey":u=t[2];s=t[4];break;case"unwrapKey":u=t[4];s=t[6];break;case"generateKey":u=t[0];s=t[2];break;default:throw new Rt("Cannot wrap native key. Unsupported method in use")}return this.wrapNativeKey(r,u,r.extractable,s)}}return r};r.prototype.wrapNativeKey=function(e,t,r,n){if(this.browserInfo.name===xr.IE){var i=["RSASSA-PKCS1-v1_5","RSA-PSS","RSA-OAEP","AES-CBC","AES-CTR","AES-KW","HMAC"];var o=i.map((function(e){return e.toLowerCase()})).indexOf(e.algorithm.name.toLowerCase());if(o!==-1){var a=this.prepareAlgorithm(t);var u=Object.assign(Object.assign({},e.algorithm),{name:i[o]});if(sr.isHashedAlgorithm(a)){u.hash={name:a.hash.name.toUpperCase()}}Ir.info("Wrapping "+i[o]+" crypto key to WrappedNativeCryptoKey");return new $i(u,r,e.type,n,e)}}return e};r.prototype.castKey=function(e){return h(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:Ir.info("Cast native CryptoKey to linter key.",e);if(!e.extractable){throw new Error("Cannot cast unextractable crypto key")}t=this.getProvider(e.algorithm.name);return[4,this.exportKey("jwk",e)];case 1:r=n.sent();return[2,t.importKey("jwk",r,e.algorithm,true,e.usages)]}}))}))};r.prototype.fixAlgorithmName=function(e){if(this.browserInfo.name===xr.Edge){for(var t=0;t<e.length;t++){var r=e[0];if(typeof r==="string"){for(var n=0,i=this.providers.algorithms;n<i.length;n++){var o=i[n];if(o.toLowerCase()===r.toLowerCase()){e[t]=o;break}}}else if(typeof r==="object"&&typeof r.name==="string"){for(var a=0,u=this.providers.algorithms;a<u.length;a++){var o=u[a];if(o.toLowerCase()===r.name.toLowerCase()){r.name=o}if(typeof r.hash==="string"&&o.toLowerCase()===r.hash.toLowerCase()||typeof r.hash==="object"&&typeof r.hash.name==="string"&&o.toLowerCase()===r.hash.name.toLowerCase()){r.hash={name:o}}}}}}};r.prototype.fixFirefoxEcImportPkcs8=function(e){var t=this.prepareAlgorithm(e[2]);var r=t.name.toUpperCase();if(this.browserInfo.name===xr.Firefox&&e[0]==="pkcs8"&&~["ECDSA","ECDH"].indexOf(r)&&~["P-256","P-384","P-521"].indexOf(t.namedCurve)){if(!f.isBufferSource(e[1])){throw new TypeError("data: Is not ArrayBuffer or ArrayBufferView")}var n=f.toArrayBuffer(e[1]);var i=ft.parse(n,Ar);var o=ft.parse(i.privateKey,Hr);var a=Ut.toJSON(o);a.ext=true;a.key_ops=e[4];a.crv=t.namedCurve;a.kty="EC";e[0]="jwk";e[1]=a}};r.prototype.fixFirefoxEcExportPkcs8=function(e){return h(this,void 0,void 0,(function(){var t,r,n,i;return __generator(this,(function(o){switch(o.label){case 0:o.trys.push([0,3,,4]);if(!(this.browserInfo.name===xr.Firefox&&e[0]==="pkcs8"&&~["ECDSA","ECDH"].indexOf(e[1].algorithm.name)&&~["P-256","P-384","P-521"].indexOf(e[1].algorithm.namedCurve)))return[3,2];return[4,this.exportKey("jwk",e[1])];case 1:t=o.sent();r=Ot.fromJSON(t,{targetSchema:Hr});n=new Ar;n.privateKeyAlgorithm.algorithm=rn.ASN_ALGORITHM;n.privateKeyAlgorithm.parameters=lt.serialize(new kr(en(e[1].algorithm.namedCurve)));n.privateKey=lt.serialize(r);return[2,lt.serialize(n)];case 2:return[3,4];case 3:i=o.sent();Ir.error(i);return[2,null];case 4:return[2]}}))}))};return r}(sr);t.methods=["digest","importKey","exportKey","sign","verify","generateKey","encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"];return t}();var Yi=function(t){__extends(r,t);function r(){var e=t.apply(this,arguments)||this;e.subtle=new Xi;return e}Object.defineProperty(r.prototype,"nativeCrypto",{get:function(){return e.nativeCrypto},enumerable:true,configurable:true});r.prototype.getRandomValues=function(t){return e.nativeCrypto.getRandomValues(t)};return r}(ar);function Qi(e,t){var r=e[t];e[t]=function(){var n=arguments;return new Promise((function(i,o){var a=r.apply(e,n);a.oncomplete=function(e){i(e.target.result)};a.onerror=function(e){o("Error on running '"+t+"' function")}}))}}if(typeof self!=="undefined"&&self["msCrypto"]){Qi(e.nativeSubtle,"generateKey");Qi(e.nativeSubtle,"digest");Qi(e.nativeSubtle,"sign");Qi(e.nativeSubtle,"verify");Qi(e.nativeSubtle,"encrypt");Qi(e.nativeSubtle,"decrypt");Qi(e.nativeSubtle,"importKey");Qi(e.nativeSubtle,"exportKey");Qi(e.nativeSubtle,"wrapKey");Qi(e.nativeSubtle,"unwrapKey");Qi(e.nativeSubtle,"deriveKey");Qi(e.nativeSubtle,"deriveBits")}if(!Math.imul){Math.imul=function e(t,r){var n=t>>>16&65535;var i=t&65535;var o=r>>>16&65535;var a=r&65535;return i*a+(n*a+i*o<<16>>>0)|0}}var eo=self;if(e.nativeCrypto){Object.freeze(e.nativeCrypto.getRandomValues)}try{delete self.crypto;eo.crypto=new Yi;Object.freeze(eo.crypto)}catch(no){Ir.error(no)}var to=eo.crypto;e.Crypto=Yi;e.CryptoKey=Tr;e.crypto=to;e.setCrypto=u;return e}({},self.asmCrypto,self.elliptic)}}}));